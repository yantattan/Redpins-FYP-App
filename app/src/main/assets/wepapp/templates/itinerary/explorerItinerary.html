{% extends "base.html" %}
{% block title %}Redpins Buffer - Explorer{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" />
<script src="https://cdn.onemap.sg/leaflet/onemap-leaflet.js"></script>
<script type="text/javascript" src="https://rawgit.com/jieter/Leaflet.encoded/master/Polyline.encoded.js"></script>


<div class="device" id="reloadingbg" style="display: none;">
    <img src="/static/images/logo.gif" alt="logo" class="relogogif">
</div>

<div class="main-div device" id="exploreritinerary">
    <!-- header -->
    <div class="explorerheader">
        <svg width="12" height="20" onclick="window.open('/','_self')">
            <path
            d="M10.2642 0C10.8582 0.203504 11.2215 0.68581 11.6052 1.12894C11.9081 1.47897 11.8687 2.05183 11.5761 2.4156C11.5052 2.50072 11.4295 2.58174 11.3494 2.65828C8.94914 5.0464 6.54751 7.43334 4.14452 9.81909C4.0819 9.87251 4.01519 9.92099 3.94498 9.96409C4.03554 10.0582 4.08722 10.1167 4.14145 10.1676C6.56048 12.5737 8.9795 14.9796 11.3985 17.3854C11.8298 17.8148 11.9613 18.3439 11.6385 18.7738C11.3346 19.1709 10.9778 19.5251 10.5779 19.8264C10.2074 20.1093 9.70807 20.0259 9.34174 19.7247C9.28648 19.6794 9.23276 19.6311 9.18211 19.5807L0.412125 10.8636C-0.0248138 10.4296 -0.119978 9.92084 0.153748 9.45024C0.222198 9.33957 0.304744 9.23817 0.399334 9.14854C3.33272 6.23165 6.26697 3.31661 9.20206 0.403448C9.37602 0.231995 9.61905 0.132787 9.8324 0H10.2642Z"
            fill="#2B2B2B" />
        </svg>
        <h1>Explorer Plan</h1>
        <div class="cardedit">
            <svg width="21" height="5" viewBox="0 0 21 5" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="18.1367" cy="2.63721" r="2" transform="rotate(90 18.1367 2.63721)" fill="#2B2B2B" />
            <circle cx="2.13672" cy="2.63721" r="2" transform="rotate(90 2.13672 2.63721)" fill="#2B2B2B" />
            <circle cx="10.1367" cy="2.63721" r="2" transform="rotate(90 10.1367 2.63721)" fill="#2B2B2B" />
            </svg>
        </div>
    </div>

    {% if itinerary != None %}
    <div class="device" id="firstSelection" style="position: absolute; z-index:20; background-color: white; display: none;">
    {% else %}
    <div class="device" id="firstSelection" style="position: absolute; z-index:20; background-color: white;">
    {% endif %}
        <!-- header -->
        <div class="explorerheader">
            <svg width="12" height="20"onclick="window.open('explore.html','_self')">
            <path
                d="M10.2642 0C10.8582 0.203504 11.2215 0.68581 11.6052 1.12894C11.9081 1.47897 11.8687 2.05183 11.5761 2.4156C11.5052 2.50072 11.4295 2.58174 11.3494 2.65828C8.94914 5.0464 6.54751 7.43334 4.14452 9.81909C4.0819 9.87251 4.01519 9.92099 3.94498 9.96409C4.03554 10.0582 4.08722 10.1167 4.14145 10.1676C6.56048 12.5737 8.9795 14.9796 11.3985 17.3854C11.8298 17.8148 11.9613 18.3439 11.6385 18.7738C11.3346 19.1709 10.9778 19.5251 10.5779 19.8264C10.2074 20.1093 9.70807 20.0259 9.34174 19.7247C9.28648 19.6794 9.23276 19.6311 9.18211 19.5807L0.412125 10.8636C-0.0248138 10.4296 -0.119978 9.92084 0.153748 9.45024C0.222198 9.33957 0.304744 9.23817 0.399334 9.14854C3.33272 6.23165 6.26697 3.31661 9.20206 0.403448C9.37602 0.231995 9.61905 0.132787 9.8324 0H10.2642Z"
                fill="#2B2B2B" />
            </svg>
            <h1>Get Exploring!</h1>
            &nbsp
        </div>
    
        <section class="explorerinput">
            {% if itinerary != None %}
            <div>
                <h1>Start Location</h1>
                <input id="start-location" type="text" class="Username" value="{{itinerary.getPlaces()[0]['Name']}}" onclick="openSearch(this);" onchange="checkFirstPage();" placeholder="Where are you?" readonly>
                <div class="dropdown-menu-search" style="display: none;">
                </div>
                {% for attr in itinerary.getPlaces()[0] %}
                    {% if itinerary.getPlaces()[-1][attr] != None %}<span id="start-location-{{attr | lower}}" hidden>{{itinerary.getPlaces()[0][attr]}}</span>{% endif %}
                {% endfor %}
            </div>
            
            <div>
                <h1>End Location</h1>
                <input id="end-location" type="text" class="Username" value="{{itinerary.getPlaces()[-1]['Name']}}" onclick="openSearch(this);" onchange="checkFirstPage();" placeholder="Where to end the trip?" readonly>
                <div class="dropdown-menu-search" style="display: none;">
                </div>
                {% for attr in itinerary.getPlaces()[0] %}
                    {% if itinerary.getPlaces()[-1][attr] != None %}<span id="end-location-{{attr | lower}}" hidden>{{itinerary.getPlaces()[0][attr]}}</span>{% endif %}
                {% endfor %}
            </div>
    
            <h1>Start & End Time</h1>
            <div class="startend">
            <input id="start-time" type="time" class="Username" value="{{itinerary.getStartTime()}}" onkeyup="checkFirstPage();" placeholder="Start">
            <input id="end-time" type="time" class="Username" value="{{itinerary.getEndTime()}}" onkeyup="checkFirstPage();" placeholder="End">
            </div>

            {% else %}
            {% set attributes = ["name", "address", "latlng"] %}
            <div>
                <h1>Start Location</h1>
                <input id="start-location" type="text" class="Username" value="Your Location" onclick="openSearch(this)" onchange="checkFirstPage();" placeholder="Where are you?" readonly>
                <div class="dropdown-menu-search" style="display: none;">
                </div>
                <span id="start-location-name" hidden>Your Location</span>
                <span id="start-location-address" hidden>Current Location</span>
                <span id="start-location-latlng" hidden></span>
            </div>
            
            <div>
                <h1>End Location</h1>
                <input id="end-location" type="text" class="Username" onclick="openSearch(this);" onchange="checkFirstPage();" placeholder="Where to end the trip?" readonly>
                <div class="dropdown-menu-search" style="display: none;">
                </div>
                {% for attr in attributes %}
                <span id="end-location-{{attr}}" hidden></span>
                {% endfor %}
            </div>
    
            <h1>Start & End Time</h1>
            <div class="startend">
            <input id="start-time" type="time" class="Username" onkeyup="checkFirstPage();" placeholder="Start">
            <input id="end-time" type="time" class="Username" onkeyup="checkFirstPage();" placeholder="End">
            </div>
            {% endif %}

    
            <h1>Preferred Mode of Transport</h1>
            <div class="transportmodecon">
                {% if itinerary != None %}
                {% if itinerary.getTransportMode() == 'pt' %}
                <div class="train transportmode addColor" onclick="selectRadio('trans-publicTransport', this)">
                    <svg width="50" height="50" fill="none">
                        <rect x="0.5" y="0.5" width="49" height="49" rx="4.5" stroke="#BBBBBB" />
                        <path
                            d="M27.1925 17.4651C27.6102 17.4651 28.0185 17.3342 28.3658 17.0889C28.7131 16.8435 28.9838 16.4949 29.1436 16.0869C29.3034 15.679 29.3453 15.2301 29.2638 14.797C29.1823 14.3639 28.9812 13.9661 28.6858 13.6539C28.3905 13.3417 28.0142 13.129 27.6045 13.0429C27.1949 12.9568 26.7703 13.001 26.3844 13.1699C25.9985 13.3389 25.6687 13.6251 25.4366 13.9922C25.2046 14.3594 25.0807 14.791 25.0807 15.2326C25.0824 15.8241 25.3054 16.391 25.7011 16.8093C26.0968 17.2276 26.633 17.4634 27.1925 17.4651V17.4651ZM23.3913 32.9814L24.4472 28.0698L26.6646 30.3023V37H28.7764V28.6279L26.559 26.3954L27.1925 23.0465C27.917 23.9217 28.8098 24.6234 29.8113 25.1046C30.8128 25.5859 31.8999 25.8356 33 25.8372V23.6047C32.0872 23.6193 31.187 23.3794 30.3899 22.909C29.5928 22.4387 28.927 21.7546 28.4596 20.9256L27.4037 19.1395C27.2166 18.8097 26.9542 18.5348 26.6406 18.3398C26.3271 18.1448 25.9723 18.036 25.6087 18.0233C25.2919 18.0233 25.0807 18.1349 24.764 18.1349L19.2733 20.5907V25.8372H21.3851V22.0419L23.2857 21.2605L21.5963 30.3023L16.4224 29.186L16 31.4186L23.3913 32.9814Z"
                            fill="white" />
                    </svg>
                </div>
                {% else %}
                <div class="train transportmode" onclick="selectRadio('trans-publicTransport', this)">
                    <svg width="50" height="50" fill="none">
                        <rect x="0.5" y="0.5" width="49" height="49" rx="4.5" stroke="#BBBBBB" />
                        <path
                            d="M27.1925 17.4651C27.6102 17.4651 28.0185 17.3342 28.3658 17.0889C28.7131 16.8435 28.9838 16.4949 29.1436 16.0869C29.3034 15.679 29.3453 15.2301 29.2638 14.797C29.1823 14.3639 28.9812 13.9661 28.6858 13.6539C28.3905 13.3417 28.0142 13.129 27.6045 13.0429C27.1949 12.9568 26.7703 13.001 26.3844 13.1699C25.9985 13.3389 25.6687 13.6251 25.4366 13.9922C25.2046 14.3594 25.0807 14.791 25.0807 15.2326C25.0824 15.8241 25.3054 16.391 25.7011 16.8093C26.0968 17.2276 26.633 17.4634 27.1925 17.4651V17.4651ZM23.3913 32.9814L24.4472 28.0698L26.6646 30.3023V37H28.7764V28.6279L26.559 26.3954L27.1925 23.0465C27.917 23.9217 28.8098 24.6234 29.8113 25.1046C30.8128 25.5859 31.8999 25.8356 33 25.8372V23.6047C32.0872 23.6193 31.187 23.3794 30.3899 22.909C29.5928 22.4387 28.927 21.7546 28.4596 20.9256L27.4037 19.1395C27.2166 18.8097 26.9542 18.5348 26.6406 18.3398C26.3271 18.1448 25.9723 18.036 25.6087 18.0233C25.2919 18.0233 25.0807 18.1349 24.764 18.1349L19.2733 20.5907V25.8372H21.3851V22.0419L23.2857 21.2605L21.5963 30.3023L16.4224 29.186L16 31.4186L23.3913 32.9814Z"
                            fill="#BBBBBB" />
                    </svg>
                </div>
                {% endif %}

                {% if itinerary.getTransportMode() == 'walk' %}
                <div class="walk transportmode addColor" onclick="selectRadio('trans-walk', this)">
                    <svg width="50" height="50" fill="none">
                        <rect x="0.5" y="0.5" width="49" height="49" rx="4.5" stroke="#BBBBBB" />
                        <path
                            d="M28.1219 18.9024C28.5079 18.9024 28.8851 18.788 29.206 18.5736C29.5269 18.3592 29.777 18.0545 29.9246 17.6979C30.0723 17.3414 30.111 16.9491 30.0357 16.5706C29.9604 16.1921 29.7746 15.8444 29.5017 15.5715C29.2288 15.2986 28.8811 15.1128 28.5026 15.0375C28.1241 14.9622 27.7318 15.0008 27.3752 15.1485C27.0187 15.2962 26.714 15.5463 26.4996 15.8672C26.2852 16.1881 26.1707 16.5653 26.1707 16.9512C26.1723 17.4682 26.3783 17.9636 26.7439 18.3292C27.1095 18.6948 27.6049 18.9009 28.1219 18.9024V18.9024ZM17.878 25.2439C16.5843 25.2439 15.3436 25.7578 14.4287 26.6726C13.5139 27.5875 13 28.8282 13 30.1219C13 31.4157 13.5139 32.6564 14.4287 33.5712C15.3436 34.4861 16.5843 35 17.878 35C19.1718 35 20.4125 34.4861 21.3273 33.5712C22.2422 32.6564 22.7561 31.4157 22.7561 30.1219C22.7561 28.8282 22.2422 27.5875 21.3273 26.6726C20.4125 25.7578 19.1718 25.2439 17.878 25.2439ZM17.878 33.5366C16.9724 33.5366 16.1039 33.1768 15.4635 32.5365C14.8232 31.8961 14.4634 31.0276 14.4634 30.1219C14.4634 29.2163 14.8232 28.3478 15.4635 27.7074C16.1039 27.0671 16.9724 26.7073 17.878 26.7073C18.7837 26.7073 19.6522 27.0671 20.2926 27.7074C20.9329 28.3478 21.2927 29.2163 21.2927 30.1219C21.2927 31.0276 20.9329 31.8961 20.2926 32.5365C19.6522 33.1768 18.7837 33.5366 17.878 33.5366ZM23.5366 23.7805L25.878 21.439L26.6585 22.2195C27.3061 22.8799 28.081 23.402 28.9362 23.7541C29.7915 24.1063 30.7093 24.2812 31.6341 24.2683V22.3171C30.9803 22.3227 30.332 22.1959 29.7284 21.9444C29.1248 21.6929 28.5784 21.3219 28.1219 20.8537L26.2683 19C25.835 18.624 25.281 18.4163 24.7073 18.4146C24.4496 18.3975 24.1915 18.4417 23.9541 18.5434C23.7168 18.6452 23.5068 18.8016 23.3415 19L20.6098 21.7317C20.4266 21.9093 20.2805 22.1214 20.18 22.3559C20.0795 22.5904 20.0266 22.8425 20.0244 23.0976C20.0073 23.3553 20.0514 23.6133 20.1532 23.8507C20.2549 24.0881 20.4114 24.2981 20.6098 24.4634L23.7317 27.1951V32.0732H25.6829V26.0244L23.5366 23.7805ZM31.5366 25.2439C30.5718 25.2439 29.6287 25.53 28.8265 26.066C28.0243 26.602 27.3991 27.3639 27.0299 28.2552C26.6606 29.1465 26.564 30.1274 26.7523 31.0736C26.9405 32.0199 27.4051 32.889 28.0873 33.5712C28.7695 34.2535 29.6387 34.718 30.5849 34.9063C31.5312 35.0945 32.512 34.9979 33.4033 34.6287C34.2947 34.2595 35.0565 33.6342 35.5925 32.832C36.1285 32.0299 36.4146 31.0867 36.4146 30.1219C36.421 29.4796 36.2992 28.8424 36.0563 28.2477C35.8134 27.653 35.4544 27.1127 35.0001 26.6584C34.5459 26.2042 34.0056 25.8451 33.4109 25.6022C32.8161 25.3593 32.179 25.2375 31.5366 25.2439V25.2439ZM31.5366 33.5366C30.8612 33.5366 30.201 33.3363 29.6395 32.9611C29.078 32.5859 28.6403 32.0526 28.3819 31.4287C28.1234 30.8047 28.0558 30.1182 28.1876 29.4558C28.3193 28.7934 28.6445 28.185 29.1221 27.7074C29.5996 27.2299 30.208 26.9047 30.8704 26.7729C31.5328 26.6412 32.2194 26.7088 32.8433 26.9672C33.4672 27.2257 34.0005 27.6633 34.3757 28.2249C34.7509 28.7864 34.9512 29.4466 34.9512 30.1219C34.9403 31.0242 34.5771 31.8864 33.9391 32.5244C33.301 33.1624 32.4388 33.5257 31.5366 33.5366V33.5366Z"
                            fill="white" />
                    </svg>
                </div>
                {% else %}
                <div class="walk transportmode" onclick="selectRadio('trans-walk', this)">
                    <svg width="50" height="50" fill="none">
                        <rect x="0.5" y="0.5" width="49" height="49" rx="4.5" stroke="#BBBBBB" />
                        <path
                            d="M28.1219 18.9024C28.5079 18.9024 28.8851 18.788 29.206 18.5736C29.5269 18.3592 29.777 18.0545 29.9246 17.6979C30.0723 17.3414 30.111 16.9491 30.0357 16.5706C29.9604 16.1921 29.7746 15.8444 29.5017 15.5715C29.2288 15.2986 28.8811 15.1128 28.5026 15.0375C28.1241 14.9622 27.7318 15.0008 27.3752 15.1485C27.0187 15.2962 26.714 15.5463 26.4996 15.8672C26.2852 16.1881 26.1707 16.5653 26.1707 16.9512C26.1723 17.4682 26.3783 17.9636 26.7439 18.3292C27.1095 18.6948 27.6049 18.9009 28.1219 18.9024V18.9024ZM17.878 25.2439C16.5843 25.2439 15.3436 25.7578 14.4287 26.6726C13.5139 27.5875 13 28.8282 13 30.1219C13 31.4157 13.5139 32.6564 14.4287 33.5712C15.3436 34.4861 16.5843 35 17.878 35C19.1718 35 20.4125 34.4861 21.3273 33.5712C22.2422 32.6564 22.7561 31.4157 22.7561 30.1219C22.7561 28.8282 22.2422 27.5875 21.3273 26.6726C20.4125 25.7578 19.1718 25.2439 17.878 25.2439ZM17.878 33.5366C16.9724 33.5366 16.1039 33.1768 15.4635 32.5365C14.8232 31.8961 14.4634 31.0276 14.4634 30.1219C14.4634 29.2163 14.8232 28.3478 15.4635 27.7074C16.1039 27.0671 16.9724 26.7073 17.878 26.7073C18.7837 26.7073 19.6522 27.0671 20.2926 27.7074C20.9329 28.3478 21.2927 29.2163 21.2927 30.1219C21.2927 31.0276 20.9329 31.8961 20.2926 32.5365C19.6522 33.1768 18.7837 33.5366 17.878 33.5366ZM23.5366 23.7805L25.878 21.439L26.6585 22.2195C27.3061 22.8799 28.081 23.402 28.9362 23.7541C29.7915 24.1063 30.7093 24.2812 31.6341 24.2683V22.3171C30.9803 22.3227 30.332 22.1959 29.7284 21.9444C29.1248 21.6929 28.5784 21.3219 28.1219 20.8537L26.2683 19C25.835 18.624 25.281 18.4163 24.7073 18.4146C24.4496 18.3975 24.1915 18.4417 23.9541 18.5434C23.7168 18.6452 23.5068 18.8016 23.3415 19L20.6098 21.7317C20.4266 21.9093 20.2805 22.1214 20.18 22.3559C20.0795 22.5904 20.0266 22.8425 20.0244 23.0976C20.0073 23.3553 20.0514 23.6133 20.1532 23.8507C20.2549 24.0881 20.4114 24.2981 20.6098 24.4634L23.7317 27.1951V32.0732H25.6829V26.0244L23.5366 23.7805ZM31.5366 25.2439C30.5718 25.2439 29.6287 25.53 28.8265 26.066C28.0243 26.602 27.3991 27.3639 27.0299 28.2552C26.6606 29.1465 26.564 30.1274 26.7523 31.0736C26.9405 32.0199 27.4051 32.889 28.0873 33.5712C28.7695 34.2535 29.6387 34.718 30.5849 34.9063C31.5312 35.0945 32.512 34.9979 33.4033 34.6287C34.2947 34.2595 35.0565 33.6342 35.5925 32.832C36.1285 32.0299 36.4146 31.0867 36.4146 30.1219C36.421 29.4796 36.2992 28.8424 36.0563 28.2477C35.8134 27.653 35.4544 27.1127 35.0001 26.6584C34.5459 26.2042 34.0056 25.8451 33.4109 25.6022C32.8161 25.3593 32.179 25.2375 31.5366 25.2439V25.2439ZM31.5366 33.5366C30.8612 33.5366 30.201 33.3363 29.6395 32.9611C29.078 32.5859 28.6403 32.0526 28.3819 31.4287C28.1234 30.8047 28.0558 30.1182 28.1876 29.4558C28.3193 28.7934 28.6445 28.185 29.1221 27.7074C29.5996 27.2299 30.208 26.9047 30.8704 26.7729C31.5328 26.6412 32.2194 26.7088 32.8433 26.9672C33.4672 27.2257 34.0005 27.6633 34.3757 28.2249C34.7509 28.7864 34.9512 29.4466 34.9512 30.1219C34.9403 31.0242 34.5771 31.8864 33.9391 32.5244C33.301 33.1624 32.4388 33.5257 31.5366 33.5366V33.5366Z"
                            fill="#BBBBBB" />
                    </svg>
                </div>
                {% endif %}
                
                {% if itinerary.getTransportMode() == 'cycle' %}
                <div class="cycle transportmode addColor" onclick="selectRadio('trans-cycle', this)">
                    <svg width="50" height="50" fill="none">
                        <rect x="0.5" y="0.5" width="49" height="49" rx="4.5" stroke="#BBBBBB" />
                        <path
                            d="M33.4578 16.2625C33.334 15.8928 33.1 15.5722 32.7886 15.3457C32.4773 15.1192 32.1043 14.9983 31.7222 15H18.2778C17.896 14.9994 17.5235 15.1208 17.2124 15.3471C16.9012 15.5734 16.6669 15.8935 16.5422 16.2625L14 23.75V33.75C14 34.0815 14.1288 34.3995 14.358 34.6339C14.5872 34.8683 14.8981 35 15.2222 35H16.4444C16.7686 35 17.0795 34.8683 17.3087 34.6339C17.5379 34.3995 17.6667 34.0815 17.6667 33.75V32.5H32.3333V33.75C32.3333 34.0815 32.4621 34.3995 32.6913 34.6339C32.9205 34.8683 33.2314 35 33.5556 35H34.7778C35.1019 35 35.4128 34.8683 35.642 34.6339C35.8712 34.3995 36 34.0815 36 33.75V23.75L33.4578 16.2625ZM18.2778 28.75C17.9152 28.75 17.5607 28.64 17.2592 28.434C16.9577 28.228 16.7228 27.9351 16.584 27.5925C16.4452 27.2499 16.4089 26.8729 16.4797 26.5092C16.5504 26.1455 16.725 25.8114 16.9814 25.5492C17.2378 25.287 17.5645 25.1084 17.9201 25.036C18.2757 24.9637 18.6444 25.0008 18.9794 25.1427C19.3144 25.2846 19.6007 25.525 19.8021 25.8333C20.0036 26.1417 20.1111 26.5042 20.1111 26.875C20.1111 27.3723 19.918 27.8492 19.5741 28.2008C19.2303 28.5525 18.764 28.75 18.2778 28.75ZM31.7222 28.75C31.3596 28.75 31.0052 28.64 30.7037 28.434C30.4022 28.228 30.1672 27.9351 30.0284 27.5925C29.8897 27.2499 29.8534 26.8729 29.9241 26.5092C29.9949 26.1455 30.1695 25.8114 30.4259 25.5492C30.6823 25.287 31.0089 25.1084 31.3646 25.036C31.7202 24.9637 32.0888 25.0008 32.4238 25.1427C32.7588 25.2846 33.0451 25.525 33.2466 25.8333C33.448 26.1417 33.5556 26.5042 33.5556 26.875C33.5556 27.3723 33.3624 27.8492 33.0186 28.2008C32.6748 28.5525 32.2085 28.75 31.7222 28.75ZM16.4444 22.5L18.2778 16.875H31.7222L33.5556 22.5H16.4444Z"
                            fill="white" />
                    </svg>
                </div>
                {% else %}
                <div class="cycle transportmode" onclick="selectRadio('trans-cycle', this)">
                    <svg width="50" height="50" fill="none">
                        <rect x="0.5" y="0.5" width="49" height="49" rx="4.5" stroke="#BBBBBB" />
                        <path
                            d="M33.4578 16.2625C33.334 15.8928 33.1 15.5722 32.7886 15.3457C32.4773 15.1192 32.1043 14.9983 31.7222 15H18.2778C17.896 14.9994 17.5235 15.1208 17.2124 15.3471C16.9012 15.5734 16.6669 15.8935 16.5422 16.2625L14 23.75V33.75C14 34.0815 14.1288 34.3995 14.358 34.6339C14.5872 34.8683 14.8981 35 15.2222 35H16.4444C16.7686 35 17.0795 34.8683 17.3087 34.6339C17.5379 34.3995 17.6667 34.0815 17.6667 33.75V32.5H32.3333V33.75C32.3333 34.0815 32.4621 34.3995 32.6913 34.6339C32.9205 34.8683 33.2314 35 33.5556 35H34.7778C35.1019 35 35.4128 34.8683 35.642 34.6339C35.8712 34.3995 36 34.0815 36 33.75V23.75L33.4578 16.2625ZM18.2778 28.75C17.9152 28.75 17.5607 28.64 17.2592 28.434C16.9577 28.228 16.7228 27.9351 16.584 27.5925C16.4452 27.2499 16.4089 26.8729 16.4797 26.5092C16.5504 26.1455 16.725 25.8114 16.9814 25.5492C17.2378 25.287 17.5645 25.1084 17.9201 25.036C18.2757 24.9637 18.6444 25.0008 18.9794 25.1427C19.3144 25.2846 19.6007 25.525 19.8021 25.8333C20.0036 26.1417 20.1111 26.5042 20.1111 26.875C20.1111 27.3723 19.918 27.8492 19.5741 28.2008C19.2303 28.5525 18.764 28.75 18.2778 28.75ZM31.7222 28.75C31.3596 28.75 31.0052 28.64 30.7037 28.434C30.4022 28.228 30.1672 27.9351 30.0284 27.5925C29.8897 27.2499 29.8534 26.8729 29.9241 26.5092C29.9949 26.1455 30.1695 25.8114 30.4259 25.5492C30.6823 25.287 31.0089 25.1084 31.3646 25.036C31.7202 24.9637 32.0888 25.0008 32.4238 25.1427C32.7588 25.2846 33.0451 25.525 33.2466 25.8333C33.448 26.1417 33.5556 26.5042 33.5556 26.875C33.5556 27.3723 33.3624 27.8492 33.0186 28.2008C32.6748 28.5525 32.2085 28.75 31.7222 28.75ZM16.4444 22.5L18.2778 16.875H31.7222L33.5556 22.5H16.4444Z"
                            fill="#BBBBBB" />
                    </svg>
                </div>
                {% endif %}
                
                {% if itinerary.getTransportMode() == 'drive' %}
                <div class="car transportmode addColor" onclick="selectRadio('trans-drive', this)">
                    <svg width="50" height="50" fill="none">
                        <rect x="0.5" y="0.5" width="49" height="49" rx="4.5" stroke="#BBBBBB" />
                        <path
                            d="M15 30.125C15 31.2853 15.4609 32.3981 16.2814 33.2186C17.1019 34.0391 18.2147 34.5 19.375 34.5L17.5 36.375V37H32.5V36.375L30.625 34.5C31.7853 34.5 32.8981 34.0391 33.7186 33.2186C34.5391 32.3981 35 31.2853 35 30.125V17C35 12.625 30.525 12 25 12C19.475 12 15 12.625 15 17V30.125ZM25 32C24.5055 32 24.0222 31.8534 23.6111 31.5787C23.2 31.304 22.8795 30.9135 22.6903 30.4567C22.5011 29.9999 22.4516 29.4972 22.548 29.0123C22.6445 28.5273 22.8826 28.0819 23.2322 27.7322C23.5819 27.3826 24.0273 27.1445 24.5123 27.048C24.9972 26.9516 25.4999 27.0011 25.9567 27.1903C26.4135 27.3795 26.804 27.7 27.0787 28.1111C27.3534 28.5222 27.5 29.0055 27.5 29.5C27.498 30.1624 27.234 30.7972 26.7656 31.2656C26.2972 31.734 25.6624 31.998 25 32ZM32.5 23.25H17.5V17H32.5V23.25Z"
                            fill="white" />
                    </svg>
                </div>
                {% else %}
                <div class="car transportmode" onclick="selectRadio('trans-drive', this)">
                    <svg width="50" height="50" fill="none">
                        <rect x="0.5" y="0.5" width="49" height="49" rx="4.5" stroke="#BBBBBB" />
                        <path
                            d="M15 30.125C15 31.2853 15.4609 32.3981 16.2814 33.2186C17.1019 34.0391 18.2147 34.5 19.375 34.5L17.5 36.375V37H32.5V36.375L30.625 34.5C31.7853 34.5 32.8981 34.0391 33.7186 33.2186C34.5391 32.3981 35 31.2853 35 30.125V17C35 12.625 30.525 12 25 12C19.475 12 15 12.625 15 17V30.125ZM25 32C24.5055 32 24.0222 31.8534 23.6111 31.5787C23.2 31.304 22.8795 30.9135 22.6903 30.4567C22.5011 29.9999 22.4516 29.4972 22.548 29.0123C22.6445 28.5273 22.8826 28.0819 23.2322 27.7322C23.5819 27.3826 24.0273 27.1445 24.5123 27.048C24.9972 26.9516 25.4999 27.0011 25.9567 27.1903C26.4135 27.3795 26.804 27.7 27.0787 28.1111C27.3534 28.5222 27.5 29.0055 27.5 29.5C27.498 30.1624 27.234 30.7972 26.7656 31.2656C26.2972 31.734 25.6624 31.998 25 32ZM32.5 23.25H17.5V17H32.5V23.25Z"
                            fill="#BBBBBB" />
                    </svg>
                </div>
                {% endif %}
                
                {% if itinerary.getTransportMode() == 'pt' %}
                <div class="bus transportmode addColor" onclick="selectRadio('trans-publicTransport', this)">
                    <svg width="50" height="50" fill="none">
                        <rect x="0.5" y="0.5" width="49" height="49" rx="4.5" stroke="#BBBBBB" />
                        <path
                            d="M15 30.125C15 31.2853 15.4609 32.3981 16.2814 33.2186C17.1019 34.0391 18.2147 34.5 19.375 34.5L17.5 36.375V37H32.5V36.375L30.625 34.5C31.7853 34.5 32.8981 34.0391 33.7186 33.2186C34.5391 32.3981 35 31.2853 35 30.125V17C35 12.625 30.525 12 25 12C19.475 12 15 12.625 15 17V30.125ZM25 32C24.5055 32 24.0222 31.8534 23.6111 31.5787C23.2 31.304 22.8795 30.9135 22.6903 30.4567C22.5011 29.9999 22.4516 29.4972 22.548 29.0123C22.6445 28.5273 22.8826 28.0819 23.2322 27.7322C23.5819 27.3826 24.0273 27.1445 24.5123 27.048C24.9972 26.9516 25.4999 27.0011 25.9567 27.1903C26.4135 27.3795 26.804 27.7 27.0787 28.1111C27.3534 28.5222 27.5 29.0055 27.5 29.5C27.498 30.1624 27.234 30.7972 26.7656 31.2656C26.2972 31.734 25.6624 31.998 25 32ZM32.5 23.25H17.5V17H32.5V23.25Z"
                            fill="white" />
                    </svg>
                </div>
                {% else %}
                <div class="bus transportmode" onclick="selectRadio('trans-publicTransport', this)">
                    <svg width="50" height="50" fill="none">
                        <rect x="0.5" y="0.5" width="49" height="49" rx="4.5" stroke="#BBBBBB" />
                        <path
                            d="M15 30.125C15 31.2853 15.4609 32.3981 16.2814 33.2186C17.1019 34.0391 18.2147 34.5 19.375 34.5L17.5 36.375V37H32.5V36.375L30.625 34.5C31.7853 34.5 32.8981 34.0391 33.7186 33.2186C34.5391 32.3981 35 31.2853 35 30.125V17C35 12.625 30.525 12 25 12C19.475 12 15 12.625 15 17V30.125ZM25 32C24.5055 32 24.0222 31.8534 23.6111 31.5787C23.2 31.304 22.8795 30.9135 22.6903 30.4567C22.5011 29.9999 22.4516 29.4972 22.548 29.0123C22.6445 28.5273 22.8826 28.0819 23.2322 27.7322C23.5819 27.3826 24.0273 27.1445 24.5123 27.048C24.9972 26.9516 25.4999 27.0011 25.9567 27.1903C26.4135 27.3795 26.804 27.7 27.0787 28.1111C27.3534 28.5222 27.5 29.0055 27.5 29.5C27.498 30.1624 27.234 30.7972 26.7656 31.2656C26.2972 31.734 25.6624 31.998 25 32ZM32.5 23.25H17.5V17H32.5V23.25Z"
                            fill="#BBBBBB" />
                    </svg>
                </div>
                {% endif %}

                {% else %}
                <div class="train transportmode addColor" onclick="selectRadio('trans-publicTransport', this)">
                    <svg width="50" height="50" fill="none">
                        <rect x="0.5" y="0.5" width="49" height="49" rx="4.5" stroke="#BBBBBB" />
                        <path
                            d="M27.1925 17.4651C27.6102 17.4651 28.0185 17.3342 28.3658 17.0889C28.7131 16.8435 28.9838 16.4949 29.1436 16.0869C29.3034 15.679 29.3453 15.2301 29.2638 14.797C29.1823 14.3639 28.9812 13.9661 28.6858 13.6539C28.3905 13.3417 28.0142 13.129 27.6045 13.0429C27.1949 12.9568 26.7703 13.001 26.3844 13.1699C25.9985 13.3389 25.6687 13.6251 25.4366 13.9922C25.2046 14.3594 25.0807 14.791 25.0807 15.2326C25.0824 15.8241 25.3054 16.391 25.7011 16.8093C26.0968 17.2276 26.633 17.4634 27.1925 17.4651V17.4651ZM23.3913 32.9814L24.4472 28.0698L26.6646 30.3023V37H28.7764V28.6279L26.559 26.3954L27.1925 23.0465C27.917 23.9217 28.8098 24.6234 29.8113 25.1046C30.8128 25.5859 31.8999 25.8356 33 25.8372V23.6047C32.0872 23.6193 31.187 23.3794 30.3899 22.909C29.5928 22.4387 28.927 21.7546 28.4596 20.9256L27.4037 19.1395C27.2166 18.8097 26.9542 18.5348 26.6406 18.3398C26.3271 18.1448 25.9723 18.036 25.6087 18.0233C25.2919 18.0233 25.0807 18.1349 24.764 18.1349L19.2733 20.5907V25.8372H21.3851V22.0419L23.2857 21.2605L21.5963 30.3023L16.4224 29.186L16 31.4186L23.3913 32.9814Z"
                            fill="white" />
                    </svg>
                </div>

                <div class="walk transportmode" onclick="selectRadio('trans-walk', this)">
                    <svg width="50" height="50" fill="none">
                        <rect x="0.5" y="0.5" width="49" height="49" rx="4.5" stroke="#BBBBBB" />
                        <path
                            d="M28.1219 18.9024C28.5079 18.9024 28.8851 18.788 29.206 18.5736C29.5269 18.3592 29.777 18.0545 29.9246 17.6979C30.0723 17.3414 30.111 16.9491 30.0357 16.5706C29.9604 16.1921 29.7746 15.8444 29.5017 15.5715C29.2288 15.2986 28.8811 15.1128 28.5026 15.0375C28.1241 14.9622 27.7318 15.0008 27.3752 15.1485C27.0187 15.2962 26.714 15.5463 26.4996 15.8672C26.2852 16.1881 26.1707 16.5653 26.1707 16.9512C26.1723 17.4682 26.3783 17.9636 26.7439 18.3292C27.1095 18.6948 27.6049 18.9009 28.1219 18.9024V18.9024ZM17.878 25.2439C16.5843 25.2439 15.3436 25.7578 14.4287 26.6726C13.5139 27.5875 13 28.8282 13 30.1219C13 31.4157 13.5139 32.6564 14.4287 33.5712C15.3436 34.4861 16.5843 35 17.878 35C19.1718 35 20.4125 34.4861 21.3273 33.5712C22.2422 32.6564 22.7561 31.4157 22.7561 30.1219C22.7561 28.8282 22.2422 27.5875 21.3273 26.6726C20.4125 25.7578 19.1718 25.2439 17.878 25.2439ZM17.878 33.5366C16.9724 33.5366 16.1039 33.1768 15.4635 32.5365C14.8232 31.8961 14.4634 31.0276 14.4634 30.1219C14.4634 29.2163 14.8232 28.3478 15.4635 27.7074C16.1039 27.0671 16.9724 26.7073 17.878 26.7073C18.7837 26.7073 19.6522 27.0671 20.2926 27.7074C20.9329 28.3478 21.2927 29.2163 21.2927 30.1219C21.2927 31.0276 20.9329 31.8961 20.2926 32.5365C19.6522 33.1768 18.7837 33.5366 17.878 33.5366ZM23.5366 23.7805L25.878 21.439L26.6585 22.2195C27.3061 22.8799 28.081 23.402 28.9362 23.7541C29.7915 24.1063 30.7093 24.2812 31.6341 24.2683V22.3171C30.9803 22.3227 30.332 22.1959 29.7284 21.9444C29.1248 21.6929 28.5784 21.3219 28.1219 20.8537L26.2683 19C25.835 18.624 25.281 18.4163 24.7073 18.4146C24.4496 18.3975 24.1915 18.4417 23.9541 18.5434C23.7168 18.6452 23.5068 18.8016 23.3415 19L20.6098 21.7317C20.4266 21.9093 20.2805 22.1214 20.18 22.3559C20.0795 22.5904 20.0266 22.8425 20.0244 23.0976C20.0073 23.3553 20.0514 23.6133 20.1532 23.8507C20.2549 24.0881 20.4114 24.2981 20.6098 24.4634L23.7317 27.1951V32.0732H25.6829V26.0244L23.5366 23.7805ZM31.5366 25.2439C30.5718 25.2439 29.6287 25.53 28.8265 26.066C28.0243 26.602 27.3991 27.3639 27.0299 28.2552C26.6606 29.1465 26.564 30.1274 26.7523 31.0736C26.9405 32.0199 27.4051 32.889 28.0873 33.5712C28.7695 34.2535 29.6387 34.718 30.5849 34.9063C31.5312 35.0945 32.512 34.9979 33.4033 34.6287C34.2947 34.2595 35.0565 33.6342 35.5925 32.832C36.1285 32.0299 36.4146 31.0867 36.4146 30.1219C36.421 29.4796 36.2992 28.8424 36.0563 28.2477C35.8134 27.653 35.4544 27.1127 35.0001 26.6584C34.5459 26.2042 34.0056 25.8451 33.4109 25.6022C32.8161 25.3593 32.179 25.2375 31.5366 25.2439V25.2439ZM31.5366 33.5366C30.8612 33.5366 30.201 33.3363 29.6395 32.9611C29.078 32.5859 28.6403 32.0526 28.3819 31.4287C28.1234 30.8047 28.0558 30.1182 28.1876 29.4558C28.3193 28.7934 28.6445 28.185 29.1221 27.7074C29.5996 27.2299 30.208 26.9047 30.8704 26.7729C31.5328 26.6412 32.2194 26.7088 32.8433 26.9672C33.4672 27.2257 34.0005 27.6633 34.3757 28.2249C34.7509 28.7864 34.9512 29.4466 34.9512 30.1219C34.9403 31.0242 34.5771 31.8864 33.9391 32.5244C33.301 33.1624 32.4388 33.5257 31.5366 33.5366V33.5366Z"
                            fill="#BBBBBB" />
                    </svg>
                </div>
        
                <div class="cycle transportmode" onclick="selectRadio('trans-cycle', this)">
                    <svg width="50" height="50" fill="none">
                        <rect x="0.5" y="0.5" width="49" height="49" rx="4.5" stroke="#BBBBBB" />
                        <path
                            d="M33.4578 16.2625C33.334 15.8928 33.1 15.5722 32.7886 15.3457C32.4773 15.1192 32.1043 14.9983 31.7222 15H18.2778C17.896 14.9994 17.5235 15.1208 17.2124 15.3471C16.9012 15.5734 16.6669 15.8935 16.5422 16.2625L14 23.75V33.75C14 34.0815 14.1288 34.3995 14.358 34.6339C14.5872 34.8683 14.8981 35 15.2222 35H16.4444C16.7686 35 17.0795 34.8683 17.3087 34.6339C17.5379 34.3995 17.6667 34.0815 17.6667 33.75V32.5H32.3333V33.75C32.3333 34.0815 32.4621 34.3995 32.6913 34.6339C32.9205 34.8683 33.2314 35 33.5556 35H34.7778C35.1019 35 35.4128 34.8683 35.642 34.6339C35.8712 34.3995 36 34.0815 36 33.75V23.75L33.4578 16.2625ZM18.2778 28.75C17.9152 28.75 17.5607 28.64 17.2592 28.434C16.9577 28.228 16.7228 27.9351 16.584 27.5925C16.4452 27.2499 16.4089 26.8729 16.4797 26.5092C16.5504 26.1455 16.725 25.8114 16.9814 25.5492C17.2378 25.287 17.5645 25.1084 17.9201 25.036C18.2757 24.9637 18.6444 25.0008 18.9794 25.1427C19.3144 25.2846 19.6007 25.525 19.8021 25.8333C20.0036 26.1417 20.1111 26.5042 20.1111 26.875C20.1111 27.3723 19.918 27.8492 19.5741 28.2008C19.2303 28.5525 18.764 28.75 18.2778 28.75ZM31.7222 28.75C31.3596 28.75 31.0052 28.64 30.7037 28.434C30.4022 28.228 30.1672 27.9351 30.0284 27.5925C29.8897 27.2499 29.8534 26.8729 29.9241 26.5092C29.9949 26.1455 30.1695 25.8114 30.4259 25.5492C30.6823 25.287 31.0089 25.1084 31.3646 25.036C31.7202 24.9637 32.0888 25.0008 32.4238 25.1427C32.7588 25.2846 33.0451 25.525 33.2466 25.8333C33.448 26.1417 33.5556 26.5042 33.5556 26.875C33.5556 27.3723 33.3624 27.8492 33.0186 28.2008C32.6748 28.5525 32.2085 28.75 31.7222 28.75ZM16.4444 22.5L18.2778 16.875H31.7222L33.5556 22.5H16.4444Z"
                            fill="#BBBBBB" />
                    </svg>
                </div>
        
                <div class="car transportmode" onclick="selectRadio('trans-drive', this)">
                    <svg width="50" height="50" fill="none">
                        <rect x="0.5" y="0.5" width="49" height="49" rx="4.5" stroke="#BBBBBB" />
                        <path
                            d="M15 30.125C15 31.2853 15.4609 32.3981 16.2814 33.2186C17.1019 34.0391 18.2147 34.5 19.375 34.5L17.5 36.375V37H32.5V36.375L30.625 34.5C31.7853 34.5 32.8981 34.0391 33.7186 33.2186C34.5391 32.3981 35 31.2853 35 30.125V17C35 12.625 30.525 12 25 12C19.475 12 15 12.625 15 17V30.125ZM25 32C24.5055 32 24.0222 31.8534 23.6111 31.5787C23.2 31.304 22.8795 30.9135 22.6903 30.4567C22.5011 29.9999 22.4516 29.4972 22.548 29.0123C22.6445 28.5273 22.8826 28.0819 23.2322 27.7322C23.5819 27.3826 24.0273 27.1445 24.5123 27.048C24.9972 26.9516 25.4999 27.0011 25.9567 27.1903C26.4135 27.3795 26.804 27.7 27.0787 28.1111C27.3534 28.5222 27.5 29.0055 27.5 29.5C27.498 30.1624 27.234 30.7972 26.7656 31.2656C26.2972 31.734 25.6624 31.998 25 32ZM32.5 23.25H17.5V17H32.5V23.25Z"
                            fill="#BBBBBB" />
                    </svg>
                </div>
        
                <div class="bus transportmode" onclick="selectRadio('trans-publicTransport', this)">
                    <svg width="50" height="50" fill="none">
                        <rect x="0.5" y="0.5" width="49" height="49" rx="4.5" stroke="#BBBBBB" />
                        <path
                            d="M15 30.125C15 31.2853 15.4609 32.3981 16.2814 33.2186C17.1019 34.0391 18.2147 34.5 19.375 34.5L17.5 36.375V37H32.5V36.375L30.625 34.5C31.7853 34.5 32.8981 34.0391 33.7186 33.2186C34.5391 32.3981 35 31.2853 35 30.125V17C35 12.625 30.525 12 25 12C19.475 12 15 12.625 15 17V30.125ZM25 32C24.5055 32 24.0222 31.8534 23.6111 31.5787C23.2 31.304 22.8795 30.9135 22.6903 30.4567C22.5011 29.9999 22.4516 29.4972 22.548 29.0123C22.6445 28.5273 22.8826 28.0819 23.2322 27.7322C23.5819 27.3826 24.0273 27.1445 24.5123 27.048C24.9972 26.9516 25.4999 27.0011 25.9567 27.1903C26.4135 27.3795 26.804 27.7 27.0787 28.1111C27.3534 28.5222 27.5 29.0055 27.5 29.5C27.498 30.1624 27.234 30.7972 26.7656 31.2656C26.2972 31.734 25.6624 31.998 25 32ZM32.5 23.25H17.5V17H32.5V23.25Z"
                            fill="#BBBBBB" />
                    </svg>
                </div>
                {% endif %}
            </div>

            <div class="transportModeRadio" onclick="checkFirstPage();" hidden>
                <label for="trans-walk">Walk</label>
                {% if itinerary != None %}
                    {% if itinerary.getTransportMode() == "walk" %} <input type="radio" name="transportMode" id="trans-walk" value="walk" checked>
                    {% else %} <input type="radio" name="transportMode" id="trans-walk" value="walk"> {% endif %}
                    <label for="trans-publicTransport">Public Transport</label>
                    {% if itinerary.getTransportMode() == "pt" %} <input type="radio" name="transportMode" id="trans-publicTransport" value="pt" checked>
                    {% else %} <input type="radio" name="transportMode" id="trans-publicTransport" value="pt">{% endif %}
                    <label for="trans-drive">Drive</label>
                    {% if itinerary.getTransportMode() == "drive" %} <input type="radio" name="transportMode" id="trans-drive" value="drive" checked>
                    {% else %} <input type="radio" name="transportMode" id="trans-drive" value="drive">{% endif %}
                    <label for="trans-cycle">Cycle</label>
                    {% if itinerary.getTransportMode() == "cycle" %} <input type="radio" name="transportMode" id="trans-cycle" value="cycle" checked>
                    {% else %} <input type="radio" name="transportMode" id="trans-cycle" value="cycle">{% endif %}
                {% else %}
                <input type="radio" name="transportMode" id="trans-walk" value="walk">
                <label for="trans-publicTransport">Public Transport</label>
                <input type="radio" name="transportMode" id="trans-publicTransport" value="pt" checked>
                <label for="trans-drive">Drive</label>
                <input type="radio" name="transportMode" id="trans-drive" value="drive">
                <label for="trans-cycle">Cycle</label>
                <input type="radio" name="transportMode" id="trans-cycle" value="cycle">
                {% endif %}
            </div>

            <div class="explorerbanner">
                <img src="../../static/images/buffcar.png" alt="">
        
              </div>
        </section>
    
        <section class="bottom">
            <div class="maincta-disabled" id="firstPageNext">
            <h1>Create Trip!</h1>
            </div>
        </section>
    </div>
    
    {% if itinerary != None %}
    <div class="explorertripitinerary" id="planPage" style="background-color: white;">
    {% else %}
    <div class="explorertripitinerary" id="planPage" style="background-color: white; display: none;">
    {% endif %}
        <section class="req-info" hidden>
            {% if itinerary != None %}
            <div id="startTime-text">Start time: {{itinerary.getStartTime()}}</div>
            <div id="endTime-text">End time: {{itinerary.getEndTime()}}</div>
            <div id="time-left">Duration left: <span>{{itinerary.getTimeLeft()| int}}</span></div>
        
            <div id="transport-text">Transport mode: {% if itinerary.getTransportMode() == "pt" %}Public Transport{% else %}{{itinerary.getTransportMode()}}{% endif %}</div>
            <div>Category: Eateries</div>
            {% else %}
            <div id="startTime-text">Start time: </div>
            <div id="endTime-text">End time: </div>
            <div id="time-left">Duration left: <span></span></div>
        
            <div id="transport-text">Transport mode: </div>
            <div>Category: Eateries</div>

            <div id="start">Start location: </div>
            {% endif %}
        </section>

        <div id="recommendation-listings" style="overflow-y: scroll;">
            {% if itinerary != None %}
                {% for i in range(itinerary.getPlaces()| length) %}
                {% if i==0 %}
                <div class="plan-selection">
                    <div class="explorerstart">
                        <div class="explorerstartpoint">
                            <svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                d="M0.888672 15.5C0.888672 12.5333 1.76841 9.63319 3.41663 7.16645C5.06485 4.69972 7.40753 2.77713 10.1484 1.64181C12.8893 0.506499 15.9053 0.209449 18.815 0.788228C21.7247 1.36701 24.3975 2.79562 26.4953 4.8934C28.5931 6.99119 30.0217 9.66394 30.6004 12.5737C31.1792 15.4834 30.8822 18.4994 29.7469 21.2403C28.6115 23.9811 26.689 26.3238 24.2222 27.972C21.7555 29.6203 18.8554 30.5 15.8887 30.5C13.9188 30.5 11.9683 30.112 10.1484 29.3582C8.32853 28.6044 6.67495 27.4995 5.28207 26.1066C2.46902 23.2936 0.888672 19.4783 0.888672 15.5ZM15.8887 24.5C17.6687 24.5 19.4088 23.9722 20.8888 22.9832C22.3688 21.9943 23.5224 20.5887 24.2036 18.9442C24.8848 17.2996 25.063 15.49 24.7157 13.7442C24.3685 11.9984 23.5113 10.3947 22.2526 9.13604C20.994 7.87737 19.3903 7.0202 17.6445 6.67294C15.8987 6.32567 14.0891 6.5039 12.4445 7.18509C10.8 7.86628 9.39438 9.01983 8.40544 10.4999C7.41651 11.9799 6.88867 13.72 6.88867 15.5C6.88867 17.887 7.83688 20.1761 9.52471 21.864C11.2125 23.5518 13.5017 24.5 15.8887 24.5Z"
                                fill="#06A122" />
                            </svg>
                            <h1 class="plan-name">{{itinerary.getPlaces()[i].Name}}</h1>
                            <p class="plan-address" hidden>{{itinerary.getPlaces()[i].Address}}</p>
                            <p class="plan-latlng" hidden>{{itinerary.getPlaces()[i].Latlng}}</p>
                        </div>

                        <div class="explorerstarttime">
                            <h1 class="plan-timing"></h1>
                        </div>
                    </div>
                </div>
                {% elif i==itinerary.getPlaces()| length - 1 %}
                <div class="plan-selection">
                    <hr>
                    <!-- explorerdirections -->
                    <div class="explorerdirections">
                        <div class="explorertransport">
                        </div>

                        <!-- explorertravelduration -->
                        <div class="explorertravelduration">
                        <h1><span class="plan-travel-duration">{{itinerary.getPlaces()[i].TotalDuration|int}}</span>min</h1>
                        <h2 onclick="showExpandedRoute">Details <svg width="9" height="5" viewBox="0 0 9 5" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M0.78125 0.657445C0.862652 0.406133 1.05557 0.252445 1.23283 0.0900984C1.37284 -0.0380473 1.60198 -0.0213795 1.74749 0.102437C1.78154 0.132408 1.81395 0.164424 1.84456 0.198329C2.79981 1.21383 3.75459 2.2299 4.70889 3.24655C4.73025 3.27304 4.74965 3.30127 4.76688 3.33097C4.80453 3.29266 4.82794 3.27079 4.84829 3.24785C5.81073 2.22441 6.7731 1.20098 7.7354 0.177549C7.90716 -0.00492803 8.11881 -0.0605592 8.29077 0.0760284C8.44962 0.204574 8.59127 0.355537 8.71182 0.524754C8.82497 0.681473 8.79159 0.89274 8.67112 1.04773C8.65301 1.0711 8.63367 1.09383 8.61352 1.11526L5.12668 4.82564C4.95309 5.0105 4.74959 5.05076 4.56134 4.93495C4.51708 4.90599 4.47652 4.87107 4.44067 4.83105C3.27391 3.59 2.1079 2.34859 0.942629 1.10682C0.874048 1.03322 0.834365 0.930405 0.78125 0.84014L0.78125 0.657445Z"
                                fill="#E4002B" />
                            </svg>
                        </h2>
                        </div>
                    </div>
                    <hr>

                    <div class="plannerevent btn-addPlan" onclick="openRecommendTab(parseInt('{{i+1}}'));">
                        <div class="eventdetails">
                            <div class="eventinfo">
                            <h2 class="inactiveinput">Add an Itinerary</h2>
                            </div>
                        </div>
                
                        <div class="eventedit">
                        <!-- addlocation -->
                        <svg class="addlocation" width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="2.22656" y="2" width="26" height="26" rx="5" fill="white" />
                            <path
                            d="M26.8842 3.66314e-06H3.56402C2.67887 3.66314e-06 1.82997 0.351656 1.20408 0.977601C0.578186 1.60355 0.226563 2.45251 0.226562 3.33773V26.6647C0.226563 27.5499 0.578186 28.3989 1.20408 29.0248C1.82997 29.6508 2.67887 30.0024 3.56402 30.0024H26.8891C27.7743 30.0024 28.6231 29.6508 29.249 29.0248C29.8749 28.3989 30.2266 27.5499 30.2266 26.6647V3.33773C30.2266 2.899 30.1401 2.46457 29.972 2.05929C29.804 1.65402 29.5577 1.28585 29.2473 0.975851C28.9369 0.66585 28.5684 0.420098 28.1629 0.252652C27.7574 0.0852068 27.3229 -0.000646311 26.8842 3.66314e-06ZM23.5467 16.6627H16.8879V23.327H13.5504V16.6627H6.89034V13.3249H13.5541V6.66433H16.8916V13.3287H23.5517L23.5467 16.6627Z"
                            fill="#2B2B2B" />
                        </svg>
                        </div>
                    </div>
                    <hr>

                    <div class="explorerend">
                        <div class="explorerendpoint">
                            <svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                d="M0.333984 15.9771C0.333984 13.0103 1.21372 10.1102 2.86194 7.6435C4.51016 5.17677 6.85284 3.25418 9.59373 2.11886C12.3346 0.98355 15.3506 0.6865 18.2603 1.26528C21.17 1.84406 23.8428 3.27267 25.9406 5.37046C28.0384 7.46824 29.467 10.141 30.0458 13.0507C30.6245 15.9604 30.3275 18.9764 29.1922 21.7173C28.0569 24.4582 26.1343 26.8009 23.6675 28.4491C21.2008 30.0973 18.3007 30.9771 15.334 30.9771C13.3642 30.9771 11.4136 30.5891 9.59373 29.8352C7.77385 29.0814 6.12026 27.9765 4.72738 26.5837C1.91434 23.7706 0.333984 19.9553 0.333984 15.9771ZM15.334 24.9771C17.114 24.9771 18.8541 24.4492 20.3341 23.4603C21.8142 22.4713 22.9677 21.0657 23.6489 19.4212C24.3301 17.7767 24.5083 15.9671 24.161 14.2212C23.8138 12.4754 22.9566 10.8718 21.6979 9.6131C20.4393 8.35442 18.8356 7.49726 17.0898 7.14999C15.344 6.80272 13.5344 6.98095 11.8898 7.66214C10.2453 8.34333 8.83969 9.49688 7.85076 10.9769C6.86182 12.457 6.33398 14.197 6.33398 15.9771C6.33398 18.364 7.28219 20.6532 8.97002 22.341C10.6578 24.0288 12.947 24.9771 15.334 24.9771Z"
                                fill="#E4002B" />
                            </svg>
                            <h1 class="plan-name">{{itinerary.getPlaces()[i].Name}}</h1>
                            <p class="plan-address" hidden>{{itinerary.getPlaces()[i].Address}}</p>
                            <p class="plan-latlng" hidden>{{itinerary.getPlaces()[i].Latlng}}</p>
                            <p class="plan-total-duration" hidden>{{itinerary.getPlaces()[i].TotalDuration|int}}</p>
                        </div>
                        <div class="explorerendtime">
                            <h1 class="plan-timing"></h1>
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="plan-selection">
                    <hr>
                    <!-- explorerdirections -->
                    <div class="explorerdirections">
                        <div class="explorertransport">
                        </div>

                        <!-- explorertravelduration -->
                        <div class="explorertravelduration">
                        <h1><span class="plan-travel-duration">{{itinerary.getPlaces()[i].TravelDuration|int}}</span>min</a>
                        <a data-toggle="collapse" href="#details-{{i+1}}"><h2>Details<svg width="9" height="5" viewBox="0 0 9 5" fill="none" xmlns="http://www.w3.org/2000/svg"></svg>
                            <path
                                d="M0.78125 0.657445C0.862652 0.406133 1.05557 0.252445 1.23283 0.0900984C1.37284 -0.0380473 1.60198 -0.0213795 1.74749 0.102437C1.78154 0.132408 1.81395 0.164424 1.84456 0.198329C2.79981 1.21383 3.75459 2.2299 4.70889 3.24655C4.73025 3.27304 4.74965 3.30127 4.76688 3.33097C4.80453 3.29266 4.82794 3.27079 4.84829 3.24785C5.81073 2.22441 6.7731 1.20098 7.7354 0.177549C7.90716 -0.00492803 8.11881 -0.0605592 8.29077 0.0760284C8.44962 0.204574 8.59127 0.355537 8.71182 0.524754C8.82497 0.681473 8.79159 0.89274 8.67112 1.04773C8.65301 1.0711 8.63367 1.09383 8.61352 1.11526L5.12668 4.82564C4.95309 5.0105 4.74959 5.05076 4.56134 4.93495C4.51708 4.90599 4.47652 4.87107 4.44067 4.83105C3.27391 3.59 2.1079 2.34859 0.942629 1.10682C0.874048 1.03322 0.834365 0.930405 0.78125 0.84014L0.78125 0.657445Z"
                                fill="#E4002B" />
                            </svg>
                        </h2></a>
                        </div>
                    </div>

                    <!-- showExpandedRoute -->
                    <div class="showexpandedroute collapse" id="details-{{i+1}}">
                        
                        <div class="detailedwalking">
                        
                        <svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                            d="M0.0078125 10C0.0078125 8.02219 0.594302 6.08879 1.69312 4.4443C2.79193 2.79981 4.35372 1.51809 6.18098 0.761209C8.00824 0.00433284 10.0189 -0.1937 11.9587 0.192152C13.8985 0.578004 15.6804 1.53041 17.0789 2.92894C18.4774 4.32746 19.4298 6.10929 19.8157 8.0491C20.2015 9.98891 20.0035 11.9996 19.2466 13.8268C18.4897 15.6541 17.208 17.2159 15.5635 18.3147C13.919 19.4135 11.9856 20 10.0078 20C8.69459 20 7.39423 19.7413 6.18098 19.2388C4.96772 18.7362 3.86533 17.9997 2.93674 17.0711C1.06138 15.1957 0.0078125 12.6522 0.0078125 10ZM10.0078 16C11.1945 16 12.3545 15.6481 13.3412 14.9888C14.3279 14.3295 15.097 13.3925 15.5511 12.2961C16.0052 11.1997 16.124 9.99335 15.8925 8.82946C15.661 7.66558 15.0896 6.59648 14.2504 5.75736C13.4113 4.91825 12.3422 4.3468 11.1784 4.11529C10.0145 3.88378 8.80807 4.0026 7.71171 4.45673C6.61535 4.91085 5.67828 5.67989 5.01899 6.66658C4.35971 7.65328 4.00781 8.81332 4.00781 10C4.00781 11.5913 4.63995 13.1174 5.76517 14.2426C6.89039 15.3679 8.41651 16 10.0078 16Z"
                            fill="#BBBBBB" />
                        </svg>

                        
                        <svg width="14" height="20" viewBox="0 0 14 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                            d="M8.79073 3.72093C9.12694 3.72093 9.4556 3.61182 9.73514 3.40739C10.0147 3.20296 10.2326 2.91239 10.3612 2.57244C10.4899 2.23248 10.5236 1.8584 10.458 1.49751C10.3924 1.13661 10.2305 0.805109 9.99274 0.544918C9.75501 0.284728 9.45211 0.107536 9.12236 0.0357492C8.79262 -0.0360373 8.45082 0.000806104 8.14021 0.14162C7.82959 0.282435 7.5641 0.520895 7.37731 0.826847C7.19053 1.1328 7.09083 1.4925 7.09083 1.86047C7.09217 2.35344 7.2717 2.8258 7.5902 3.17439C7.90871 3.52297 8.3403 3.71946 8.79073 3.72093ZM5.73091 16.6512L6.58086 12.5581L8.36575 14.4186V20H10.0657V13.0233L8.28076 11.1628L8.79073 8.37209C9.3739 9.10142 10.0926 9.68613 10.8987 10.0872C11.7049 10.4882 12.5799 10.6964 13.4655 10.6977V8.83721C12.7307 8.84941 12.0061 8.64946 11.3644 8.25751C10.7228 7.86557 10.1869 7.29547 9.81067 6.60465L8.96072 5.11628C8.81006 4.84145 8.59888 4.61233 8.34647 4.44983C8.09407 4.28733 7.80848 4.19664 7.5158 4.18605C7.26082 4.18605 7.09083 4.27907 6.83584 4.27907L2.4161 6.32558V10.6977H4.116V7.53489L5.64591 6.88372L4.28599 14.4186L0.12123 13.4884L-0.21875 15.3488L5.73091 16.6512Z"
                            fill="#707070" />
                        </svg>

                        <h1>7 mins (550 m)</h1>
                        </div>

                        
                        <svg class="walkingdots" width="5" height="41" viewBox="0 0 5 41" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="2.00781" cy="2" r="2" fill="#2B2B2B" />
                        <circle cx="2.00781" cy="39" r="2" fill="#2B2B2B" />
                        <circle cx="2.00781" cy="19" r="2" fill="#2B2B2B" />
                        </svg>

                        
                        <div class="detailedtransportation">
                        <div class="stationname">
                            
                            <svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M0.0078125 10C0.0078125 8.02219 0.594302 6.08879 1.69312 4.4443C2.79193 2.79981 4.35372 1.51809 6.18098 0.761209C8.00824 0.00433284 10.0189 -0.1937 11.9587 0.192152C13.8985 0.578004 15.6804 1.53041 17.0789 2.92894C18.4774 4.32746 19.4298 6.10929 19.8157 8.0491C20.2015 9.98891 20.0035 11.9996 19.2466 13.8268C18.4897 15.6541 17.208 17.2159 15.5635 18.3147C13.919 19.4135 11.9856 20 10.0078 20C8.69459 20 7.39423 19.7413 6.18098 19.2388C4.96772 18.7362 3.86533 17.9997 2.93674 17.0711C1.06138 15.1957 0.0078125 12.6522 0.0078125 10ZM10.0078 16C11.1945 16 12.3545 15.6481 13.3412 14.9888C14.3279 14.3295 15.097 13.3925 15.5511 12.2961C16.0052 11.1997 16.124 9.99335 15.8925 8.82946C15.661 7.66558 15.0896 6.59648 14.2504 5.75736C13.4113 4.91825 12.3422 4.3468 11.1784 4.11529C10.0145 3.88378 8.80807 4.0026 7.71171 4.45673C6.61535 4.91085 5.67828 5.67989 5.01899 6.66658C4.35971 7.65328 4.00781 8.81332 4.00781 10C4.00781 11.5913 4.63995 13.1174 5.76517 14.2426C6.89039 15.3679 8.41651 16 10.0078 16Z"
                                fill="#BBBBBB" />
                            </svg>

                            
                            <svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M0.929688 10.875C0.929688 11.5712 1.20261 12.2389 1.68842 12.7312C2.17422 13.2234 2.83312 13.5 3.52015 13.5L2.40995 14.625V15H11.2915V14.625L10.1813 13.5C10.8684 13.5 11.5273 13.2234 12.0131 12.7312C12.4989 12.2389 12.7718 11.5712 12.7718 10.875V3C12.7718 0.375 10.1221 0 6.85074 0C3.57936 0 0.929688 0.375 0.929688 3V10.875ZM6.85074 12C6.55797 12 6.27178 11.912 6.02835 11.7472C5.78492 11.5824 5.59519 11.3481 5.48316 11.074C5.37112 10.7999 5.3418 10.4983 5.39892 10.2074C5.45604 9.91639 5.59702 9.64912 5.80404 9.43934C6.01105 9.22956 6.27481 9.0867 6.56195 9.02882C6.8491 8.97094 7.14673 9.00065 7.41721 9.11418C7.68769 9.22771 7.91888 9.41997 8.08153 9.66665C8.24419 9.91332 8.331 10.2033 8.331 10.5C8.32983 10.8975 8.1735 11.2783 7.89615 11.5593C7.6188 11.8404 7.24297 11.9988 6.85074 12ZM11.2915 6.75H2.40995V3H11.2915V6.75Z"
                                fill="#707070" />
                            </svg>

                            <h1>Yio Chu Kang</h1>
                        </div>

                        </div>
                    </div>
                    <hr>

                    <div class="plannerevent btn-addPlan" onclick="openRecommendTab(parseInt('{{i+1}}'));">
                        <div class="eventdetails">
                            <div class="eventinfo">
                            <h2 class="inactiveinput">Add an Itinerary</h2>
                            </div>
                        </div>
                
                        <div class="eventedit">
                        <!-- addlocation -->
                        <svg class="addlocation" width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="2.22656" y="2" width="26" height="26" rx="5" fill="white" />
                            <path
                            d="M26.8842 3.66314e-06H3.56402C2.67887 3.66314e-06 1.82997 0.351656 1.20408 0.977601C0.578186 1.60355 0.226563 2.45251 0.226562 3.33773V26.6647C0.226563 27.5499 0.578186 28.3989 1.20408 29.0248C1.82997 29.6508 2.67887 30.0024 3.56402 30.0024H26.8891C27.7743 30.0024 28.6231 29.6508 29.249 29.0248C29.8749 28.3989 30.2266 27.5499 30.2266 26.6647V3.33773C30.2266 2.899 30.1401 2.46457 29.972 2.05929C29.804 1.65402 29.5577 1.28585 29.2473 0.975851C28.9369 0.66585 28.5684 0.420098 28.1629 0.252652C27.7574 0.0852068 27.3229 -0.000646311 26.8842 3.66314e-06ZM23.5467 16.6627H16.8879V23.327H13.5504V16.6627H6.89034V13.3249H13.5541V6.66433H16.8916V13.3287H23.5517L23.5467 16.6627Z"
                            fill="#2B2B2B" />
                        </svg>
                        </div>
                    </div>
                    <hr>

                    <div class="explorerevent">
                        <div class="eventdetails">
                            <div class="eventimg plan-img" style="background-image: url('{{itinerary.getPlaces()[i].Image}}');">
                                <span hidden>{{itinerary.getPlaces()[i].Img}}</span>
                            </div>
                
                            <div class="eventinfo">
                                <h1 class="eventname plan-name">{{itinerary.getPlaces()[i].Name}}</h1>
                                <h2 class="eventtype plan-category">{{itinerary.getPlaces()[i].Category}}</h2>
                                <p class="plan-address" hidden>{{itinerary.getPlaces()[i].Address}}</p>
                                <p class="plan-activity-duration" hidden><span>{{itinerary.getPlaces()[i].ActivityDuration}}</span> min</p>
                                <p class="plan-total-duration" hidden><span>{{itinerary.getPlaces()[i].TotalDuration|int}}</span> min</p>
                                <p class="plan-timing" hidden></p>
                                <p class="plan-latlng" hidden>{{itinerary.getPlaces()[i].Latlng}}</p>
                            </div>
                        </div>
                
                        <div class="eventedit">
                            <svg class="editevent plan-edit" width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg"
                            onclick="editCard(this, parseInt('{{i+1}}'));">
                            <path
                                d="M0.333984 16.3335V20.5H4.49963L16.7872 8.21241L12.6208 4.04593L0.333984 16.3335ZM20.0091 4.9905C20.1121 4.88775 20.1938 4.76571 20.2495 4.63135C20.3053 4.49699 20.334 4.35295 20.334 4.20748C20.334 4.06202 20.3053 3.91798 20.2495 3.78362C20.1938 3.64926 20.1121 3.52721 20.0091 3.42447L17.4095 0.82485C17.3068 0.721875 17.1847 0.640178 17.0504 0.584435C16.916 0.528693 16.772 0.5 16.6265 0.5C16.481 0.5 16.337 0.528693 16.2026 0.584435C16.0683 0.640178 15.9462 0.721875 15.8435 0.82485L13.8101 2.8574L17.9725 7.02387L20.0058 4.9905H20.0091Z"
                                fill="#2B2B2B" />
                            </svg>
                
                            <svg class="deleteevent plan-delete" width="17" height="21" viewBox="0 0 17 21" fill="none" xmlns="http://www.w3.org/2000/svg"
                            onclick="delCard(this, parseInt('{{i+1}}'));">
                            <path
                                d="M2.01977 18.2776C2.02236 18.8662 2.26154 19.43 2.68522 19.8462C3.1089 20.2625 3.68278 20.4974 4.28195 20.5H13.3297C13.9289 20.4974 14.5028 20.2625 14.9264 19.8462C15.3501 19.43 15.5893 18.8662 15.5919 18.2776V4.94391H2.01977V18.2776ZM16.722 1.61122H12.7637L11.6326 0.5H5.9781L4.84701 1.61122H0.888672V3.83366H16.722V1.61122Z"
                                fill="#E4002B" />
                            </svg>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                {% endfor %}
            {% endif %}
        </div>
        <br>

        <!-- viewonmap -->
        <div class="viewonmap" onclick="openMapView();">
            <svg width="51" height="50" viewBox="0 0 51 50" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="0.888672" width="50" height="50" rx="5" fill="#2B2B2B" />
            <path
                d="M14.0286 37.4989C13.5494 37.3388 13.3875 36.9977 13.3887 36.5057C13.3978 31.8787 13.3942 27.2517 13.3942 22.6247C13.3942 22.0306 13.5311 21.8228 14.0714 21.6064C16.3617 20.6896 18.6526 19.7733 20.9434 18.8571H20.9459C21.0693 18.807 21.2032 18.8993 21.2032 19.0319V19.0417C21.2032 24.1894 21.202 29.3366 21.2081 34.4843C21.2081 34.6873 21.1445 34.7777 20.9599 34.8505C18.787 35.7117 16.6172 36.5808 14.4473 37.4494C14.4192 37.4604 14.396 37.4824 14.3703 37.4995H14.0286V37.4989Z"
                fill="white" />
            <path
                d="M37.8765 19.9487C37.2017 21.602 36.1015 23.025 35.0227 24.4571C34.5581 25.0732 34.0484 25.6557 33.5472 26.2437C33.1823 26.6722 32.6658 26.6813 32.3021 26.2645C30.9116 24.6679 29.6042 23.0091 28.5565 21.1613C28.1225 20.3967 27.7399 19.607 27.551 18.7409C27.3255 17.7079 27.4954 16.7128 27.9251 15.7697C28.6892 14.0925 29.9892 13.0467 31.7838 12.628C34.3045 12.0406 37.0898 13.5302 37.9847 15.9598C38.0152 16.0435 38.0434 16.1279 38.0696 16.2128C38.4437 17.4396 38.3618 18.7611 37.8771 19.9487H37.8765ZM32.9078 20.3154C34.1835 20.324 35.2543 19.2574 35.2568 17.9762C35.2592 16.7061 34.2177 15.6548 32.9366 15.6328C31.667 15.6114 30.5907 16.6725 30.5754 17.9597C30.5601 19.2323 31.6243 20.3062 32.9078 20.3154Z"
                fill="white" />
            <path
                d="M30.5742 37.1345V27.3525C30.5742 27.111 30.8762 27.0022 31.0302 27.1874L31.0345 27.1923C31.4098 27.644 31.8682 27.9674 32.4519 28.0762C33.3296 28.24 34.082 27.9869 34.6749 27.325C35.6945 26.1856 36.6498 24.9931 37.5086 23.7267C37.6437 23.528 37.7769 23.3282 37.9102 23.1283C38.052 22.9156 38.3832 23.0158 38.3832 23.2713V33.9256C38.3832 33.9653 38.3784 34.0044 38.3649 34.0417C38.2543 34.3547 38.0159 34.5295 37.706 34.6517C36.137 35.2703 34.5716 35.898 33.0069 36.527C32.3132 36.8057 31.6225 37.0905 30.9306 37.3741C30.7606 37.4438 30.5742 37.3185 30.5742 37.1351V37.1345Z"
                fill="white" />
            <path
                d="M22.766 19.0019C22.766 18.8846 22.8846 18.8045 22.9934 18.8479C23.1578 18.9133 23.3124 18.9744 23.4671 19.0362C24.3717 19.3974 25.2769 19.7562 26.1785 20.1235C26.2738 20.1626 26.3887 20.2378 26.4248 20.3246C27.0391 21.8154 27.9021 23.1601 28.8434 24.4577C28.9553 24.6118 29.0158 24.797 29.0158 24.987C29.0109 28.9655 29.0121 32.944 29.0121 36.9225V36.997C29.0121 37.1144 28.8935 37.1975 28.7841 37.1541H28.7823C26.8459 36.3791 24.9108 35.601 22.972 34.8327C22.8094 34.7685 22.7611 34.6872 22.7617 34.5167C22.7666 29.3451 22.7654 24.1735 22.7654 19.0019H22.766Z"
                fill="white" />
            </svg>
    
        </div>

        <!-- bottom -->
        <section class="bottom">
            <div class="refresh" onclick="recommendExplorer();">
            <svg width="69" height="51" viewBox="0 0 69 51" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="0.554688" y="0.5" width="68" height="50" rx="5" fill="#BBBBBB" />
                <path
                d="M41.6358 18.4403C40.0786 16.878 38.0486 15.8745 35.8618 15.5859C33.6751 15.2974 31.4543 15.7401 29.5452 16.845C27.6362 17.9499 26.146 19.6551 25.3068 21.6951C24.4675 23.7351 24.3263 25.9953 24.905 28.1239C25.4838 30.2525 26.7501 32.13 28.5067 33.464C30.2633 34.7981 32.4117 35.5138 34.6174 35.4998C36.823 35.4858 38.9622 34.7428 40.7017 33.3866C42.4413 32.0303 43.6836 30.1369 44.2353 28.0012H41.6358C41.1769 29.2965 40.3709 30.4408 39.3057 31.3089C38.2405 32.177 36.9572 32.7356 35.596 32.9235C34.2348 33.1115 32.8482 32.9216 31.5876 32.3746C30.3271 31.8277 29.2411 30.9447 28.4485 29.8222C27.6558 28.6996 27.187 27.3808 27.0932 26.0098C26.9994 24.6388 27.2843 23.2684 27.9168 22.0484C28.5492 20.8284 29.5048 19.8057 30.6791 19.0922C31.8535 18.3787 33.2014 18.0017 34.5755 18.0026C35.5582 18.0041 36.5309 18.2016 37.4364 18.5835C38.3419 18.9655 39.1622 19.5242 39.8492 20.2271L35.8254 24.2512H44.5725V15.5033L41.6358 18.4403Z"
                fill="white" />
            </svg>
            </div>
            <form method="POST">
                <input id="itinerary-id" name="id" value="{% if itinerary != None %}{{itinerary.getId()}}{% endif %}" hidden readonly>
                <div class="maincta starttrip" onclick="document.querySelector('form').submit();">
                    <h1>Review Trip!</h1>
                </div>
            </form>
        </section>
    </div>

    <!-- Recommendation tab -->
    <div class="device" id="recommendationTab" style="position: absolute; z-index:10; background-color: white; display: none; bottom: -200vh;">
        <!-- header -->
        <div class="explorerheader">
            <svg width="12" height="20" onclick="closeRecommendTab();">
            <path
                d="M10.2642 0C10.8582 0.203504 11.2215 0.68581 11.6052 1.12894C11.9081 1.47897 11.8687 2.05183 11.5761 2.4156C11.5052 2.50072 11.4295 2.58174 11.3494 2.65828C8.94914 5.0464 6.54751 7.43334 4.14452 9.81909C4.0819 9.87251 4.01519 9.92099 3.94498 9.96409C4.03554 10.0582 4.08722 10.1167 4.14145 10.1676C6.56048 12.5737 8.9795 14.9796 11.3985 17.3854C11.8298 17.8148 11.9613 18.3439 11.6385 18.7738C11.3346 19.1709 10.9778 19.5251 10.5779 19.8264C10.2074 20.1093 9.70807 20.0259 9.34174 19.7247C9.28648 19.6794 9.23276 19.6311 9.18211 19.5807L0.412125 10.8636C-0.0248138 10.4296 -0.119978 9.92084 0.153748 9.45024C0.222198 9.33957 0.304744 9.23817 0.399334 9.14854C3.33272 6.23165 6.26697 3.31661 9.20206 0.403448C9.37602 0.231995 9.61905 0.132787 9.8324 0H10.2642Z"
                fill="#2B2B2B" />
            </svg>
            <h1>Edit Plan</h1>
            <svg onclick="document.getElementById('recommendSearch').style.display = 'block';" width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
                d="M0.773438 8.20312V9.29688C0.829688 9.68802 0.867708 10.0828 0.944792 10.4703C1.69479 14.225 4.80156 17.0578 8.6276 17.45C10.6422 17.6568 12.5146 17.2036 14.2292 16.1182C14.3974 16.0115 14.5609 15.8979 14.7516 15.7708C14.8031 15.8349 14.8427 15.8958 14.8938 15.9458C16.0599 17.0984 17.2307 18.2464 18.3917 19.4042C18.6635 19.675 18.9448 19.913 19.3281 20H19.7188C19.8984 19.9188 20.0901 19.8562 20.2547 19.7521C20.5469 19.5672 20.6839 19.2682 20.7734 18.9453V18.5156C20.6651 18.1245 20.3984 17.8469 20.1198 17.5703C18.974 16.4339 17.8354 15.2896 16.6943 14.1484C16.6406 14.0948 16.5896 14.0385 16.5438 13.9901C16.5568 13.9573 16.5599 13.9443 16.5667 13.9339C16.5995 13.8854 16.6339 13.838 16.6677 13.7901C17.9063 12.0109 18.4297 10.0365 18.2224 7.88333C18.0396 5.98698 17.3 4.31823 16.0214 2.90365C14.6906 1.43229 13.0453 0.507812 11.0891 0.152083C10.7391 0.0885417 10.3839 0.05 10.0312 0C9.69271 0 9.35417 0 9.01562 0C8.96563 0.0109375 8.91563 0.0291667 8.8651 0.0322917C7.66771 0.114063 6.53125 0.426042 5.4776 0.997396C3.00156 2.34062 1.47344 4.39531 0.924479 7.16458C0.85677 7.50729 0.822917 7.85729 0.773438 8.20312ZM3.27344 8.75052C3.27344 5.30208 6.0724 2.50104 9.51979 2.50156C12.9656 2.50156 15.7698 5.30469 15.7698 8.74948C15.7698 12.1937 12.9646 14.999 9.52083 14.9984C6.0724 14.9979 3.27396 12.1995 3.27344 8.75052Z"
                fill="#2B2B2B" />
            </svg>
        </div>

        <section id="recommendPage" class="homecontent">
            <div class="categories">
                <div id="selectedCat" hidden>Eateries</div>
                <ul id="categories">
                    {% for cat in catInfo %}
                    <li>
                        <div class="categoriesbutton">
                            <svg>
                            </svg>
                        </div>
                        <p>{{cat}}</p>
                    </li>
                    {% endfor %}
                    {% for i in range(8 - catInfo|length) %}
                    <li>
                        <div class="categoriesbutton">
                            <svg>
                            </svg>
                        </div>
                        <p>Lorem</p>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            
            <div id="recommendcon">
                <div class="sectionheader manyheadertags">
                    <div>
                        <h1>Recommended For You</h1>
                        <h2>Specially tailored for you!</h2>
                    </div>
            
                    <div class="view">
                        <h3>View All</h3>
                    </div>
                </div>
        
                <div id="recommend-main" class="plan-choices-list maincardcon attractionscon">
                </div>
            
                <!-- Places Near You -->
                <div class="sectionheader manyheadertags">
                    <div>
                        <h1>Places Near You</h1>
                        <h2>We thought you might like...</h2>
                    </div>
            
                    <div class="view">
                        <h3>View All</h3>
                    </div>
                </div>
        
                <div id="recommend-ratings" class="plan-choices-list maincardcon attractionscon">
                </div>
        
                <!-- Recommended By Us -->
                <div class="sectionheader manyheadertags">
                    <div>
                        <h1>Recommended By Us</h1>
                        <h2>We thought you might like...</h2>
                    </div>
            
                    <div class="view">
                        <h3>View All</h3>
                    </div>
                </div>
        
                <div id="recommend-partners" class="plan-choices-list maincardcon attractionscon">
                </div>
            </div>
        </section>

        <!-- <section id="recommendSearch" class="device" style="position:absolute; z-index: 12; display: none; background-color: white;">
            <div id="search">
                <div class="searchheader">
                  <svg onclick="document.getElementById('recommendSearch').style.display = 'none';" width="12" height="20" viewBox="0 0 12 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M10.2642 0C10.8582 0.203504 11.2215 0.68581 11.6052 1.12894C11.9081 1.47897 11.8687 2.05183 11.5761 2.4156C11.5052 2.50072 11.4295 2.58174 11.3494 2.65828C8.94914 5.0464 6.54751 7.43334 4.14452 9.81909C4.0819 9.87251 4.01519 9.92099 3.94498 9.96409C4.03554 10.0582 4.08722 10.1167 4.14145 10.1676C6.56048 12.5737 8.9795 14.9796 11.3985 17.3854C11.8298 17.8148 11.9613 18.3439 11.6385 18.7738C11.3346 19.1709 10.9778 19.5251 10.5779 19.8264C10.2074 20.1093 9.70807 20.0259 9.34174 19.7247C9.28648 19.6794 9.23276 19.6311 9.18211 19.5807L0.412125 10.8636C-0.0248138 10.4296 -0.119978 9.92084 0.153748 9.45024C0.222198 9.33957 0.304744 9.23817 0.399334 9.14854C3.33272 6.23165 6.26697 3.31661 9.20206 0.403448C9.37602 0.231995 9.61905 0.132787 9.8324 0H10.2642Z"
                      fill="#2B2B2B" />
                  </svg>
            
                  <h1>Search</h1>
            
            
                  <svg onclick="window.open('saved.html','_self')" width="15" height="20" viewBox="0 0 15 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M12.8569 0H2.14312C1.57629 0.00205569 1.03339 0.237205 0.633538 0.653854C0.233688 1.0705 0.00954761 1.63462 0.0102946 2.22244L0 20L7.5 16.6663L15 20V2.22244C14.9975 1.6338 14.771 1.06999 14.3696 0.653759C13.9682 0.237523 13.4245 0.00255379 12.8569 0V0Z"
                      fill="#2B2B2B" />
                  </svg>
                </div>
            
                <input type="text" id="recSearchBar" class="Username" value="" onkeyup="recSearch();" placeholder="Search Activities, Restaurants, Cafes" autocomplete="off">
            
                <div id="recSearch-results" class="searchcardscon">
                    <div style="position: relative; right: 5px;" class="sectionheader recentheader">
                        <h1>Recent Searches</h1>
                        <h3>Clear</h3>
                    </div>
                    <div id="recSearch-results-recent">
                        {% for i in range(recentSearches|length) %}
                        <div class="recentcards searchcard">
                            <div class="cardimg" style="background-image: url('{{recentInfo[i].Image_url}}');">
                            </div>
                    
                            <div class="cardinfo">
                                <h1 class="recentname">{{recentSearches[i].getPlaceName()}}</h1>
                                <div class="recenttype">
                                    <h3 class="recentcat">{{recentSearches[i].getCategory()}}</h3>
                                    <div class="rating">
                                        {% for rating in range(recentInfo[i]["Rating"]|round) %}
                                        <svg width="12" height="12" fill="none">
                                            <rect x="0.5" y="0.5" width="11" height="11" rx="1.5" stroke="#E4002B" />
                                        </svg>
                                        {% endfor %}
                                        {% for rating in range(5 - recentInfo[i]["Rating"]|round) %}
                                        <svg width="12" height="12" fill="none">
                                            <rect x="0.5" y="0.5" width="11" height="11" rx="1.5" stroke="#C4C4C4" />
                                        </svg>
                                        {% endfor %}
                                        <p class="ratingvalue">{{recentInfo[i]["Review_no"]}}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div style="position: relative; right: 5px;" class="sectionheader resultsheader" style="display: none;">
                        <h1>Results</h1>
                    </div>
                    <div id="recSearch-results-results" style="display: none;">

                    </div>
                </div>
            
            </div>
        </section> -->
    </div>
    
    <!-- Search Page -->
    <div class="device" id="searchTab" style="position: absolute; z-index:25; background-color: white; display: none; bottom: -200vh;">
        <div class="searchheader">
            <svg onclick="document.getElementById('recommendSearch').style.display = 'none';" width="12" height="20" viewBox="0 0 12 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M10.2642 0C10.8582 0.203504 11.2215 0.68581 11.6052 1.12894C11.9081 1.47897 11.8687 2.05183 11.5761 2.4156C11.5052 2.50072 11.4295 2.58174 11.3494 2.65828C8.94914 5.0464 6.54751 7.43334 4.14452 9.81909C4.0819 9.87251 4.01519 9.92099 3.94498 9.96409C4.03554 10.0582 4.08722 10.1167 4.14145 10.1676C6.56048 12.5737 8.9795 14.9796 11.3985 17.3854C11.8298 17.8148 11.9613 18.3439 11.6385 18.7738C11.3346 19.1709 10.9778 19.5251 10.5779 19.8264C10.2074 20.1093 9.70807 20.0259 9.34174 19.7247C9.28648 19.6794 9.23276 19.6311 9.18211 19.5807L0.412125 10.8636C-0.0248138 10.4296 -0.119978 9.92084 0.153748 9.45024C0.222198 9.33957 0.304744 9.23817 0.399334 9.14854C3.33272 6.23165 6.26697 3.31661 9.20206 0.403448C9.37602 0.231995 9.61905 0.132787 9.8324 0H10.2642Z"
                fill="#2B2B2B" />
            </svg>
      
            <h1>Set Location</h1>

            <svg width="15" height="20" viewBox="0 0 15 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M12.569 0H2.14312C1.57629 0.00205569 1.03339 0.237205 0.633538 0.653854C0.233688 1.0705 0.00954761 1.63462 0.0102946 2.22244L0 20L7.5 16.6663L15 20V2.22244C14.9975 1.6338 14.771 1.06999 14.3696 0.653759C13.9682 0.237523 13.4245 0.00255379 12.8569 0V0Z"
                  fill="#2B2B2B" />
            </svg>
        </div>

        <input type="text" class="Username" placeholder="Search location" id="searchBar" onkeyup="pauseSearch();" autocomplete="off">
        <div id="searchPage" hidden>1</div>
        <div id="search-btnId" hidden></div>
        <div id="search-divOrder" hidden></div>
        <div class="dropdown-item" id="start" onclick="addSE(this);">
            <p style="font-size: 14px; margin-bottom: 3px; font-weight: bold;">Your Location</p>
            <p style="font-size: 11px; max-width: 100%; overflow: auto; margin-bottom: 3px; display: none;">Current Location</p>
            <p id="start-latlng" hidden></p>
        </div>
        <div id="search-results">
        </div>
    </div>

    <!-- Map View -->
    <div class="device" id="mapView" style="position: absolute; z-index: 0; display: none;">
        <div id='mapdiv' style='height:100vh;'></div>

        <svg style="z-index: 5;" class="back" width="12" height="21" viewBox="0 0 12 21" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path onclick="dismissMapView();"
                d="M10.3111 0.5C10.9051 0.703504 11.2684 1.18581 11.6521 1.62894C11.955 1.97897 11.9156 2.55183 11.6229 2.9156C11.5521 3.00072 11.4764 3.08174 11.3963 3.15828C8.99602 5.5464 6.59439 7.93334 4.1914 10.3191C4.12878 10.3725 4.06206 10.421 3.99186 10.4641C4.08242 10.5582 4.13409 10.6167 4.18833 10.6676C6.60735 13.0737 9.02637 15.4796 11.4454 17.8854C11.8767 18.3148 12.0082 18.8439 11.6854 19.2738C11.3815 19.6709 11.0247 20.0251 10.6247 20.3264C10.2543 20.6093 9.75495 20.5259 9.38861 20.2247C9.33336 20.1794 9.27963 20.1311 9.22898 20.0807L0.459 11.3636C0.0220612 10.9296 -0.0731035 10.4208 0.200623 9.95024C0.269073 9.83957 0.351619 9.73817 0.446209 9.64854C3.3796 6.73165 6.31384 3.81661 9.24894 0.903448C9.42289 0.731995 9.66592 0.632787 9.87927 0.5H10.3111Z"
                fill="#FFFFFF" />
        </svg>
        
        
        <div class="mapbuttons" style="z-index: 5;">
            <div class="qrcodescanner" onclick="window.open('/qr-scanner','_self')">
                <img src="../../static/images/qrscanner.png" alt="">
            </div>
    
            <div class="currentlocation">
                <img src="../../static/images/currentlocation.png" alt="">
            </div>
        </div>
        
        <section>
            <div class="mapdetailscon" id="map-selection">

            </div>
        </section>
    </div>

</div>

{% endblock %}

{% block scripts %}
{{super()}}
<script>
    const apiKey = "{{apiKey}}";
    var post;
    var skipped = [0];
    var allowanceLeft = parseInt(document.querySelector("#time-left").querySelector("span").innerText);
    var originalDuration = allowanceLeft;
    var pendingChooseList = {};
    const currentTime = new Date();

    var requests = [];

    /*function initFunctions() {
        $("#recommend-btn").on("click", f() {
            recommend(1);
        })
        $("#next-recommend-btn").on("click", function() {
            recommend(pageNum);
            pageNum += 1;
        })
    }*/

    function checkFirstPage() {
        var firstSelection = document.getElementById("firstSelection");
        var allInps = firstSelection.getElementsByTagName("input");
        var radioChecked = firstSelection.querySelector('input[type="radio"]:checked');

        var nextBtn = document.getElementById("firstPageNext");
        var valid = true;
        for (var i=0; i<allInps.length; i++) {
            if (allInps[i].value.trim() == "") {
                valid = false;
                break;
            }
        }

        if (valid && radioChecked) {
            nextBtn.setAttribute("onclick", "dismissFirst();")
            nextBtn.classList.remove("maincta-disabled");
            nextBtn.classList.add("maincta");
        }
        else {
            nextBtn.removeAttribute("onclick");
            nextBtn.classList.remove("maincta");
            nextBtn.classList.add("maincta-disabled");
        }
    }

    function selectRadio(id, btn) {
        var allBtns = btn.closest(".transportmodecon").getElementsByClassName("transportmode");
        for (var i=0; i<allBtns.length; i++) {
            allBtns[i].classList.remove("addColor");
            allBtns[i].querySelector("path").setAttribute("style", "fill:#BBBBBB");
        }

        document.getElementById(id).checked = true;
        btn.classList.add("addColor");
        btn.querySelector("path").setAttribute("style", "fill:white");
    }

    function dismissFirst() {
        startTme = $("#start-time").val();
        endTme = $("#end-time").val();
        if (startTme == "") {
            $("#start-time").focus()
        }
        else if (endTme == "") {
            $("#end-time").focus()
        }
        else if ($("input[type=radio]:checked").length == 0) {
            console.log("Check checkboxes");
        }
        else {
            // Displays
            document.getElementById("startTime-text").innerText += startTme;
            document.getElementById("endTime-text").innerText += endTme;
            document.getElementById("transport-text").innerText += document.querySelector(`label[for="${document.querySelector('input[name="transportMode"]:checked').id}"]`).innerText;
            startTmeArr = startTme.split(":");
            endTmeArr = endTme.split(":");
            var startDate = new Date(0, 0, 0, startTmeArr[0], startTmeArr[1], 0);
            var endDate = new Date(0, 0, 0, endTmeArr[0], endTmeArr[1], 0);
            var diff = endDate.getTime() - startDate.getTime();
            allowanceLeft = Math.floor(diff / 1000 / 60);
            originalDuration = Math.floor(diff / 1000 / 60);
            document.getElementById("time-left").querySelector("span").innerText = allowanceLeft;

            // Set post
            post = document.getElementById("start-location-latlng").innerText.split(",");

            // Start end cards
            div = document.getElementById("recommendation-listings");
            var startPlace = new DOMParser().parseFromString(`
                <div class="plan-selection">
                    <div class="explorerstart">
                        <div class="explorerstartpoint">
                            <svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                d="M0.888672 15.5C0.888672 12.5333 1.76841 9.63319 3.41663 7.16645C5.06485 4.69972 7.40753 2.77713 10.1484 1.64181C12.8893 0.506499 15.9053 0.209449 18.815 0.788228C21.7247 1.36701 24.3975 2.79562 26.4953 4.8934C28.5931 6.99119 30.0217 9.66394 30.6004 12.5737C31.1792 15.4834 30.8822 18.4994 29.7469 21.2403C28.6115 23.9811 26.689 26.3238 24.2222 27.972C21.7555 29.6203 18.8554 30.5 15.8887 30.5C13.9188 30.5 11.9683 30.112 10.1484 29.3582C8.32853 28.6044 6.67495 27.4995 5.28207 26.1066C2.46902 23.2936 0.888672 19.4783 0.888672 15.5ZM15.8887 24.5C17.6687 24.5 19.4088 23.9722 20.8888 22.9832C22.3688 21.9943 23.5224 20.5887 24.2036 18.9442C24.8848 17.2996 25.063 15.49 24.7157 13.7442C24.3685 11.9984 23.5113 10.3947 22.2526 9.13604C20.994 7.87737 19.3903 7.0202 17.6445 6.67294C15.8987 6.32567 14.0891 6.5039 12.4445 7.18509C10.8 7.86628 9.39438 9.01983 8.40544 10.4999C7.41651 11.9799 6.88867 13.72 6.88867 15.5C6.88867 17.887 7.83688 20.1761 9.52471 21.864C11.2125 23.5518 13.5017 24.5 15.8887 24.5Z"
                                fill="#06A122" />
                            </svg>
                            <h1 class="plan-name">${$("#start-location").val()}</h1>
                            <p class="plan-address" hidden>${$("#start-location-address").text()}</p>
                            <p class="plan-latlng" hidden>${$("#start-location-latlng").text()}</p>
                        </div>

                        <div class="explorerstarttime">
                            <h1 class="plan-timing"></h1>
                        </div>
                    </div>
                </div>`, "text/html").body.firstElementChild;
            var endPlace = new DOMParser().parseFromString(`
                <div class="plan-selection">
                    <hr>

                    <div class="explorerdirections">
                        <!-- explorertravelicons -->
                        <div class="explorertransport"></div>

                        <!-- explorertravelduration -->
                        <div class="explorertravelduration">
                        <h1><span class="plan-travel-duration"></span>, 150km</h1>
                        <h2 onclick="showExpandedRoute">Details
                            <svg width="8" height="5" viewBox="0 0 8 5" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M0.429688 4.34255C0.511089 4.59387 0.704012 4.74756 0.881264 4.9099C1.02127 5.03805 1.25042 5.02138 1.39593 4.89756C1.42997 4.86759 1.46238 4.83558 1.493 4.80167C2.44825 3.78617 3.40302 2.7701 4.35732 1.75345C4.37869 1.72696 4.39808 1.69873 4.41532 1.66903C4.45297 1.70734 4.47637 1.72921 4.49672 1.75215C5.45916 2.77559 6.42154 3.79902 7.38384 4.82245C7.5556 5.00493 7.76724 5.06056 7.9392 4.92397C8.09806 4.79543 8.23971 4.64446 8.36026 4.47525C8.4734 4.31853 8.44003 4.10726 8.31955 3.95227C8.30144 3.9289 8.28211 3.90617 8.26196 3.88474L4.77512 0.17436C4.60153 -0.0104982 4.39802 -0.0507602 4.20978 0.0650471C4.16552 0.0940067 4.12495 0.12893 4.0891 0.168949C2.92235 1.41 1.75633 2.65141 0.591067 3.89318C0.522486 3.96678 0.482802 4.0696 0.429688 4.15986L0.429688 4.34255Z"
                                fill="#E4002B" />
                            </svg>
                        </h2>
                        </div>

                    </div>

                    <hr>

                    <div class="explorerend">
                        <div class="explorerendpoint">
                            <svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                d="M0.333984 15.9771C0.333984 13.0103 1.21372 10.1102 2.86194 7.6435C4.51016 5.17677 6.85284 3.25418 9.59373 2.11886C12.3346 0.98355 15.3506 0.6865 18.2603 1.26528C21.17 1.84406 23.8428 3.27267 25.9406 5.37046C28.0384 7.46824 29.467 10.141 30.0458 13.0507C30.6245 15.9604 30.3275 18.9764 29.1922 21.7173C28.0569 24.4582 26.1343 26.8009 23.6675 28.4491C21.2008 30.0973 18.3007 30.9771 15.334 30.9771C13.3642 30.9771 11.4136 30.5891 9.59373 29.8352C7.77385 29.0814 6.12026 27.9765 4.72738 26.5837C1.91434 23.7706 0.333984 19.9553 0.333984 15.9771ZM15.334 24.9771C17.114 24.9771 18.8541 24.4492 20.3341 23.4603C21.8142 22.4713 22.9677 21.0657 23.6489 19.4212C24.3301 17.7767 24.5083 15.9671 24.161 14.2212C23.8138 12.4754 22.9566 10.8718 21.6979 9.6131C20.4393 8.35442 18.8356 7.49726 17.0898 7.14999C15.344 6.80272 13.5344 6.98095 11.8898 7.66214C10.2453 8.34333 8.83969 9.49688 7.85076 10.9769C6.86182 12.457 6.33398 14.197 6.33398 15.9771C6.33398 18.364 7.28219 20.6532 8.97002 22.341C10.6578 24.0288 12.947 24.9771 15.334 24.9771Z"
                                fill="#E4002B" />
                            </svg>
                            <h1 class="plan-name">${$("#end-location").val()}</h1>
                            <p class="plan-address" hidden>${$("#end-location-address").text()}</p>
                            <p class="plan-latlng" hidden>${$("#end-location-latlng").text()}</p>
                            <p class="plan-total-duration" hidden></p>
                        </div>
                        <div class="explorerendtime">
                            <h1 class="plan-timing"></h1>
                        </div>
                    </div>
                </div>`, "text/html").body.firstElementChild;

            div.insertBefore(startPlace, div.firstChild);
            div.appendChild(endPlace);

            // Pull screen down
            $("#firstSelection").animate({
                bottom: "-200vh"
            }, 350, function() {
                $("#firstSelection").hide();
            })
            $("#planPage").show();

            // Recommend itinerary straight
            recommendExplorer();
        }
    }

    function nextRecommend(pageNum, order, cat) {
        pageNum += 1;
        recommend(pageNum, order, cat, 0, true);
        btn.remove();
    }

    function recommendExplorer() {
        startTme = $("#start-time").val();
        endTme = $("#end-time").val();

        if (startTme == "") {
            $("#start-time").focus()
        }
        else if (endTme == "") {
            $("#end-time").focus()
        }
        else {
            div = document.getElementById("recommendation-listings");
            endCoords = document.getElementById("end-location-latlng").innerText.split(",");

            var latlng = document.getElementById("start-location-latlng").innerText.split(",")
            if (latlng.length == 0) {
                locationErr = div.getElementById("location-errMsg");
                locationErr.remove();
                div.insertBefore(new DOMParser().parseFromString(`   
                            <div id="location-errMsg">Please hang on while we are still trying to get your location ... Give us up to 3 seconds</div>`, "text/html").body.firstElementChild, 
                            div.lastElementChild);
            }
            $("#reloadingbg").show();
            
            $.ajax({
                type: "POST",
                url: `/funcs/explorer-recommend-places`,
                data: {
                    startTime: startTme,
                    endTime: endTme,
                    latitude: latlng[0],
                    longitude: latlng[1],
                    endLatitude: endCoords[0],
                    endLongitude: endCoords[1],
                    category: "Eateries",
                    transportMode: "pt",
                },
                success: function(result) {
                    cleanedResult = result.replaceAll("\\u", "").replaceAll("NaN", `""`);
                    result = JSON.parse(cleanedResult);
                    
                    // Clear out listing with new ones
                    var startCard = div.firstElementChild.cloneNode(true);
                    var endCard = div.lastElementChild.cloneNode(true);
                    div.innerHTML = "";

                    div.appendChild(startCard);
                    div.appendChild(endCard);

                    startTmeArr = startTme.split(":");
                    endTmeArr = endTme.split(":");
                    var startDate = new Date(0, 0, 0, startTmeArr[0], startTmeArr[1], 0);
                    var endDate = new Date(0, 0, 0, endTmeArr[0], endTmeArr[1], 0);
                    var diff = endDate.getTime() - startDate.getTime();
                    allowanceLeft = Math.floor(diff / 1000 / 60);

                    placesName = [];
                    placesAddress = [];
                    placesActivityDuration = [];
                    placesDuration = [];

                    // Display function
                    for (var i=0; i< result.length; i++) {
                        var newPlace = new DOMParser().parseFromString(`
                            <div class="plan-selection">
                                <hr>
                                <!-- explorerdirections -->
                                <div class="explorerdirections">
                                    <div class="explorertransport">
                                    </div>

                                    <!-- explorertravelduration -->
                                    <div class="explorertravelduration">
                                    <h1><span class="plan-travel-duration">${Math.round(result[i].TravelDuration)}</span>min</h1>
                                    <h2 onclick="showExpandedRoute">Details <svg width="9" height="5" viewBox="0 0 9 5" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M0.78125 0.657445C0.862652 0.406133 1.05557 0.252445 1.23283 0.0900984C1.37284 -0.0380473 1.60198 -0.0213795 1.74749 0.102437C1.78154 0.132408 1.81395 0.164424 1.84456 0.198329C2.79981 1.21383 3.75459 2.2299 4.70889 3.24655C4.73025 3.27304 4.74965 3.30127 4.76688 3.33097C4.80453 3.29266 4.82794 3.27079 4.84829 3.24785C5.81073 2.22441 6.7731 1.20098 7.7354 0.177549C7.90716 -0.00492803 8.11881 -0.0605592 8.29077 0.0760284C8.44962 0.204574 8.59127 0.355537 8.71182 0.524754C8.82497 0.681473 8.79159 0.89274 8.67112 1.04773C8.65301 1.0711 8.63367 1.09383 8.61352 1.11526L5.12668 4.82564C4.95309 5.0105 4.74959 5.05076 4.56134 4.93495C4.51708 4.90599 4.47652 4.87107 4.44067 4.83105C3.27391 3.59 2.1079 2.34859 0.942629 1.10682C0.874048 1.03322 0.834365 0.930405 0.78125 0.84014L0.78125 0.657445Z"
                                            fill="#E4002B" />
                                        </svg>
                                    </h2>
                                    </div>
                                </div>
                                <hr>

                                <button class="btn-addPlan btn-addColor" onclick="openRecommendTab(${i+2});">  +  </button>
                                <hr>

                                <div class="explorerevent">
                                    <div class="eventdetails">
                                        <div class="eventimg plan-img" style="background-image: url('${result[i].Image_url}');">
                                            <span hidden>${result[i].Image_url}</span>
                                        </div>
                            
                                        <div class="eventinfo">
                                            <h1 class="eventname plan-name">${result[i].Name}</h1>
                                            <h2 class="eventtype plan-category">${result[i].Category}</h2>
                                            <p class="plan-address" hidden>${result[i].Address}</p>
                                            <p class="plan-activity-duration" hidden><span>${Math.round(result[i].ActivityDuration)}</span> min</p>
                                            <p class="plan-total-duration" hidden><span>${Math.round(result[i].Duration)}</span> min</p>
                                            <p class="plan-timing" hidden></p>
                                            <p class="plan-latlng" hidden>${result[i].Latlng}</p>
                                        </div>
                                    </div>
                            
                                    <div class="eventedit">
                                        <svg class="editevent plan-edit" width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg"
                                        onclick="editCard(this, ${i+2});">
                                        <path
                                            d="M0.333984 16.3335V20.5H4.49963L16.7872 8.21241L12.6208 4.04593L0.333984 16.3335ZM20.0091 4.9905C20.1121 4.88775 20.1938 4.76571 20.2495 4.63135C20.3053 4.49699 20.334 4.35295 20.334 4.20748C20.334 4.06202 20.3053 3.91798 20.2495 3.78362C20.1938 3.64926 20.1121 3.52721 20.0091 3.42447L17.4095 0.82485C17.3068 0.721875 17.1847 0.640178 17.0504 0.584435C16.916 0.528693 16.772 0.5 16.6265 0.5C16.481 0.5 16.337 0.528693 16.2026 0.584435C16.0683 0.640178 15.9462 0.721875 15.8435 0.82485L13.8101 2.8574L17.9725 7.02387L20.0058 4.9905H20.0091Z"
                                            fill="#2B2B2B" />
                                        </svg>
                            
                                        <svg class="deleteevent plan-delete" width="17" height="21" viewBox="0 0 17 21" fill="none" xmlns="http://www.w3.org/2000/svg"
                                        onclick="delCard(this, ${i+2});">
                                        <path
                                            d="M2.01977 18.2776C2.02236 18.8662 2.26154 19.43 2.68522 19.8462C3.1089 20.2625 3.68278 20.4974 4.28195 20.5H13.3297C13.9289 20.4974 14.5028 20.2625 14.9264 19.8462C15.3501 19.43 15.5893 18.8662 15.5919 18.2776V4.94391H2.01977V18.2776ZM16.722 1.61122H12.7637L11.6326 0.5H5.9781L4.84701 1.61122H0.888672V3.83366H16.722V1.61122Z"
                                            fill="#E4002B" />
                                        </svg>
                                    </div>
                                </div>
                            </div>`, "text/html").body.firstElementChild;
                        
                        div.insertBefore(newPlace, div.lastElementChild);

                        allowanceLeft -= result[i].Duration;
                        document.getElementById("time-left").querySelector("span").innerText = parseInt(allowanceLeft);

                        placesName.push(result[i].Name)
                        placesAddress.push(result[i].Address)
                        placesActivityDuration.push(parseFloat(result[i].ActivityDuration))
                        placesDuration.push(parseFloat(result[i].Duration))
                    }
                    allowanceLeft -= result[result.length-1].EndDuration;
                    div.lastElementChild.querySelector(".plan-travel-duration").innerText = Math.round(result[result.length-1].EndDuration);
                    div.lastElementChild.querySelector(".plan-total-duration").innerText = Math.round(result[result.length-1].EndDuration);
                    document.getElementById("time-left").querySelector("span").innerText = parseInt(allowanceLeft);

                    reAssignValues();
                    displayRouteDetails();
                    saveTrips(placesName, placesAddress, placesActivityDuration, placesDuration);
                },
                error: function(jq, status, errorMsg) {
                    div.insertBefore(new DOMParser().parseFromString(`   
                            <div>Something went wrong. Try again</div>`, "text/html").body.firstElementChild, 
                            div.lastElementChild);
                },
                complete: function(result) {
                    $("#reloadingbg").hide();
                }
            })
        }
    }

    function openRecommendTab(order) {
        // Pull screen up
        $("#recommendationTab").show();
        $("#recommendationTab").animate({
            top: "0",
            bottom: "0"
        }, 350);

        allCat = document.getElementById("categories").getElementsByTagName("li");
        for (var i=0; i<allCat.length; i++) {
            var li = allCat[i];
            li.setAttribute("onclick", `recommend(1, ${order}, '${li.querySelector("p").innerText}')`)
        }
        recommend(1, order, "Eateries");
    }
    function closeRecommendTab() {
        // Pull screen down
        $("#recommendationTab").animate({
            bottom: "-200vh"
        }, 350, function () {
            $("#recommendationTab").hide();
        });
    }
    // Order - the positional order of the button in DOM
    async function recommend(pageNum, order, cat, sectionNo=0, append=false) {
        // Stop pending ajax req
        if (requests.length > 0) {
            while (requests.length > 0) {
                try {
                    requests[0].abort();
                }
                catch (e) {}
                finally {
                    requests.pop(0);
                }
            }
        }

        startTme = $("#start-time").val();
        endTme = $("#end-time").val();
        transportMde = document.querySelector('input[name="transportMode"]:checked').value;

        div = document.getElementById("recommendation-listings");
        var allCards = div.getElementsByClassName("plan-selection");

        $("#reloadingbg").show();
        $("#selectedCat").text(cat);
        document.getElementById("recSearchBar").setAttribute("onkeyup", `recSearch(${order});`);

        // Get place before, after and registered places
        var registeredPlaces = [].slice.call(allCards).slice(1, allCards.length - 1).map(x => x.querySelector(".plan-address").innerText);
        if (order - 1 > 0) {
            var placeBefore = allCards[order-2].querySelector(".plan-address").innerText;
            var latlng = allCards[order-2].querySelector(".plan-latlng").innerText.split(",");
        }
        else {
            var placeBefore;
            var latlng = document.getElementById("start-location-latlng").innerText.split(",");
        }
        
        var placeAfter = allCards[order-1].querySelector(".plan-address").innerText;

        async function fetchDisplay(sectionNo) {
            request = await $.ajax({
                type: "POST",
                url: `/funcs/planner-recommend-places?page=${pageNum}`,
                data: {
                    date: currentTime.toISOString().slice(0, 10),
                    startTime: startTme,
                    endTime: endTme,
                    timeLeft: allowanceLeft,
                    latitude: latlng[0],
                    longitude: latlng[1],
                    category: cat,
                    transportMode: transportMde,
                    skipped: JSON.stringify(skipped),
                    placesAdded: registeredPlaces,
                    abovePlace: placeBefore,
                    belowPlace: placeAfter,
                    section: sectionNo
                },
                success: function(result) {
                    cleanedResult = result.replaceAll("\\u", "").replaceAll("NaN", `""`);
                    result = JSON.parse(cleanedResult);

                    listingIndex = [document.getElementById("recommend-main"), document.getElementById("recommend-ratings"), document.getElementById("recommend-partners")]
                    pendingChooseList[sectionNo] = result;
                    listing = listingIndex[sectionNo-1]
                    if (!append)
                        listing.innerHTML = "";

                    if (result.list.length > 0) {
                        for (var i in result.list) {
                            var recommendCard = 
                            `<div class="maincard attractioncard plan-choice" onclick="choosePlace(this, ${sectionNo}, ${order}, ${i});">
                                <div class="cardimg" style="background-image: url('${result.list[i].Image_url}');">
                                </div>
                    
                                <div class="maincardinfo attractioncardinfo">
                                <h1 class="recentname">${result.list[i].Name}</h1>
                    
                                <div class="recenttype">
                                    <h3 class="recentcat">${result.list[i].Category.replace(/,/g, "")}</h3>
                                    <div class="rating">`
                            for (var i=0; i< Math.round(result.list[i].Rating); i++) {
                                recommendCard += 
                                    `<svg width="12" height="12" fill="none">
                                        <rect x="0.5" y="0.5" width="11" height="11" rx="1.5" stroke="#E4002B" />
                                    </svg>`
                            }
                            for (var i=0; i< 5 - Math.round(result.list[i].Rating); i++) {
                                recommendCard +=
                                    `<svg width="12" height="12" fill="none">
                                        <rect x="0.5" y="0.5" width="11" height="11" rx="1.5" stroke="#C4C4C4" />
                                    </svg>`
                            }
                            recommendCard +=
                                `       <p class="ratingvalue">${result.list[i].Review_no}</p>
                                    </div>
                                </div>
                    
                                </div>
                            </div>`;
                            listing.innerHTML += recommendCard;
                        }
                    }
                    else {
                        listing.innerHTML += `<div class="card">There isn't any available places to be added</div>`;
                        var allBtns = div.getElementsByClassName("btn-addPlan");
                        for (var i=0; i<allBtns.length; i++) {
                            allBtns[i].disabled = true;
                            allBtns[i].classList.remove("btn-addColor");
                        }
                    }

                    if (result.list.length == 10)
                        listing.innerHTML += `<p onclick="nextRecommend(${pageNum}, ${order}, this)" class="list-load-more">Load more</p>`;

                    console.log(skipped);
                    
                },
                error: function(jq, status, errorMsg) {
                    div.innerHTML = 
                    `<div class="plan-choices-list">
                        Something went wrong. Try again
                    </div>`;
                },
                complete: function(result) {
                    $("#reloadingbg").hide();
                }
            });

            requests.push(request);
        }

        if (sectionNo == 0) {
            for (var i=1; i<4; i++) {
                fetchDisplay(i)
            }
        }
        else
            fetchDisplay(sectionNo)
    }

    function choosePlace(btn, index, order, itemNo) {
        btn.parentElement.remove()
        div = document.getElementById("recommendation-listings");
        var info = pendingChooseList[index].list[itemNo];

        var newPlace = new DOMParser().parseFromString(`
            <div class="plan-selection">
                <hr>
                <!-- explorerdirections -->
                <div class="explorerdirections">
                    <div class="explorertransport">
                    </div>

                    <!-- explorertravelduration -->
                    <div class="explorertravelduration">
                    <h1><span class="plan-travel-duration">${info.TravelDuration}</span>min</h1>
                    <h2 onclick="showExpandedRoute">Details <svg width="9" height="5" viewBox="0 0 9 5" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M0.78125 0.657445C0.862652 0.406133 1.05557 0.252445 1.23283 0.0900984C1.37284 -0.0380473 1.60198 -0.0213795 1.74749 0.102437C1.78154 0.132408 1.81395 0.164424 1.84456 0.198329C2.79981 1.21383 3.75459 2.2299 4.70889 3.24655C4.73025 3.27304 4.74965 3.30127 4.76688 3.33097C4.80453 3.29266 4.82794 3.27079 4.84829 3.24785C5.81073 2.22441 6.7731 1.20098 7.7354 0.177549C7.90716 -0.00492803 8.11881 -0.0605592 8.29077 0.0760284C8.44962 0.204574 8.59127 0.355537 8.71182 0.524754C8.82497 0.681473 8.79159 0.89274 8.67112 1.04773C8.65301 1.0711 8.63367 1.09383 8.61352 1.11526L5.12668 4.82564C4.95309 5.0105 4.74959 5.05076 4.56134 4.93495C4.51708 4.90599 4.47652 4.87107 4.44067 4.83105C3.27391 3.59 2.1079 2.34859 0.942629 1.10682C0.874048 1.03322 0.834365 0.930405 0.78125 0.84014L0.78125 0.657445Z"
                            fill="#E4002B" />
                        </svg>
                    </h2>
                    </div>
                </div>
                <hr>

                <button class="btn-addPlan btn-addColor" onclick="openRecommendTab(${order});">  +  </button>
                <hr>

                <div class="explorerevent">
                    <div class="eventdetails">
                        <div class="eventimg plan-img" style="background-image: url('${info.Image_url}');">
                            <span hidden>${info.Image_url}</span>
                        </div>
            
                        <div class="eventinfo">
                            <h1 class="eventname plan-name">${info.Name}</h1>
                            <h2 class="eventtype plan-category">${info.Category}</h2>
                            <p class="plan-address" hidden>${info.Address}</p>
                            <p class="plan-activity-duration" hidden><span>${Math.round(info.ActivityDuration)}</span> min</p>
                            <p class="plan-total-duration" hidden><span>${Math.round(info.Duration)}</span> min</p>
                            <p class="plan-timing" hidden></p>
                            <p class="plan-latlng" hidden>${info.Latlng}</p>
                        </div>
                    </div>
            
                    <div class="eventedit">
                        <svg class="editevent plan-edit" width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg"
                        onclick="editCard(this, ${order});">
                        <path
                            d="M0.333984 16.3335V20.5H4.49963L16.7872 8.21241L12.6208 4.04593L0.333984 16.3335ZM20.0091 4.9905C20.1121 4.88775 20.1938 4.76571 20.2495 4.63135C20.3053 4.49699 20.334 4.35295 20.334 4.20748C20.334 4.06202 20.3053 3.91798 20.2495 3.78362C20.1938 3.64926 20.1121 3.52721 20.0091 3.42447L17.4095 0.82485C17.3068 0.721875 17.1847 0.640178 17.0504 0.584435C16.916 0.528693 16.772 0.5 16.6265 0.5C16.481 0.5 16.337 0.528693 16.2026 0.584435C16.0683 0.640178 15.9462 0.721875 15.8435 0.82485L13.8101 2.8574L17.9725 7.02387L20.0058 4.9905H20.0091Z"
                            fill="#2B2B2B" />
                        </svg>
            
                        <svg class="deleteevent plan-delete" width="17" height="21" viewBox="0 0 17 21" fill="none" xmlns="http://www.w3.org/2000/svg"
                        onclick="delCard(this, ${order});">
                        <path
                            d="M2.01977 18.2776C2.02236 18.8662 2.26154 19.43 2.68522 19.8462C3.1089 20.2625 3.68278 20.4974 4.28195 20.5H13.3297C13.9289 20.4974 14.5028 20.2625 14.9264 19.8462C15.3501 19.43 15.5893 18.8662 15.5919 18.2776V4.94391H2.01977V18.2776ZM16.722 1.61122H12.7637L11.6326 0.5H5.9781L4.84701 1.61122H0.888672V3.83366H16.722V1.61122Z"
                            fill="#E4002B" />
                        </svg>
                    </div>
                </div>
            </div>`, "text/html").body.firstElementChild;

        var allPlans = div.getElementsByClassName("plan-selection");
        
        div.insertBefore(newPlace, allPlans[order-2].nextSibling);
        
        allowanceLeft -= info.Duration;
        console.log(allowanceLeft);
        document.getElementById("time-left").querySelector("span").innerText = parseInt(allowanceLeft);
        
        // Fill up info for autosaving data
        reCal2Places(div, order);
        reAssignValues();
        saveTrips();

        closeRecommendTab();
    }

    function chooseSearchPlace(btn, order) {
        btn.parentElement.remove()
        div = document.getElementById("recommendation-listings");

        var newPlace = new DOMParser().parseFromString(`
            <div class="plan-selection">
                <hr>
                <!-- explorerdirections -->
                <div class="explorerdirections">
                    <div class="explorertransport">
                    </div>

                    <!-- explorertravelduration -->
                    <div class="explorertravelduration">
                    <h1><span class="plan-travel-duration">${info.TravelDuration}</span>min, 150km</h1>
                    <h2 onclick="showExpandedRoute">Details <svg width="9" height="5" viewBox="0 0 9 5" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M0.78125 0.657445C0.862652 0.406133 1.05557 0.252445 1.23283 0.0900984C1.37284 -0.0380473 1.60198 -0.0213795 1.74749 0.102437C1.78154 0.132408 1.81395 0.164424 1.84456 0.198329C2.79981 1.21383 3.75459 2.2299 4.70889 3.24655C4.73025 3.27304 4.74965 3.30127 4.76688 3.33097C4.80453 3.29266 4.82794 3.27079 4.84829 3.24785C5.81073 2.22441 6.7731 1.20098 7.7354 0.177549C7.90716 -0.00492803 8.11881 -0.0605592 8.29077 0.0760284C8.44962 0.204574 8.59127 0.355537 8.71182 0.524754C8.82497 0.681473 8.79159 0.89274 8.67112 1.04773C8.65301 1.0711 8.63367 1.09383 8.61352 1.11526L5.12668 4.82564C4.95309 5.0105 4.74959 5.05076 4.56134 4.93495C4.51708 4.90599 4.47652 4.87107 4.44067 4.83105C3.27391 3.59 2.1079 2.34859 0.942629 1.10682C0.874048 1.03322 0.834365 0.930405 0.78125 0.84014L0.78125 0.657445Z"
                            fill="#E4002B" />
                        </svg>
                    </h2>
                    </div>
                </div>
                <hr>

                <button class="btn-addPlan btn-addColor" onclick="openRecommendTab(${order});">  +  </button>
                <hr>

                <div class="explorerevent">
                    <div class="eventdetails">
                        <div class="eventimg plan-img" style="background-image: url('${info.Image_url}');">
                            <span hidden>${info.Image_url}</span>
                        </div>
            
                        <div class="eventinfo">
                            <h1 class="eventname plan-name">${info.Name}</h1>
                            <h2 class="eventtype plan-category">${info.Category}</h2>
                            <p class="plan-address" hidden>${info.Address}</p>
                            <p class="plan-activity-duration" hidden><span>${Math.round(info.ActivityDuration)}</span> min</p>
                            <p class="plan-total-duration" hidden><span>${Math.round(info.Duration)}</span> min</p>
                            <p class="plan-timing" hidden></p>
                            <p class="plan-latlng" hidden>${info.Latlng}</p>
                        </div>
                    </div>
            
                    <div class="eventedit">
                        <svg class="editevent plan-edit" width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg"
                        onclick="editCard(this, ${order});">
                        <path
                            d="M0.333984 16.3335V20.5H4.49963L16.7872 8.21241L12.6208 4.04593L0.333984 16.3335ZM20.0091 4.9905C20.1121 4.88775 20.1938 4.76571 20.2495 4.63135C20.3053 4.49699 20.334 4.35295 20.334 4.20748C20.334 4.06202 20.3053 3.91798 20.2495 3.78362C20.1938 3.64926 20.1121 3.52721 20.0091 3.42447L17.4095 0.82485C17.3068 0.721875 17.1847 0.640178 17.0504 0.584435C16.916 0.528693 16.772 0.5 16.6265 0.5C16.481 0.5 16.337 0.528693 16.2026 0.584435C16.0683 0.640178 15.9462 0.721875 15.8435 0.82485L13.8101 2.8574L17.9725 7.02387L20.0058 4.9905H20.0091Z"
                            fill="#2B2B2B" />
                        </svg>
            
                        <svg class="deleteevent plan-delete" width="17" height="21" viewBox="0 0 17 21" fill="none" xmlns="http://www.w3.org/2000/svg"
                        onclick="delCard(this, ${order});">
                        <path
                            d="M2.01977 18.2776C2.02236 18.8662 2.26154 19.43 2.68522 19.8462C3.1089 20.2625 3.68278 20.4974 4.28195 20.5H13.3297C13.9289 20.4974 14.5028 20.2625 14.9264 19.8462C15.3501 19.43 15.5893 18.8662 15.5919 18.2776V4.94391H2.01977V18.2776ZM16.722 1.61122H12.7637L11.6326 0.5H5.9781L4.84701 1.61122H0.888672V3.83366H16.722V1.61122Z"
                            fill="#E4002B" />
                        </svg>
                    </div>
                </div>
            </div>`, "text/html").body.firstElementChild;
        
        var allPlans = div.getElementsByClassName("plan-selection");
        
        div.insertBefore(newPlace, allPlans[order-2].nextSibling);
        
        allowanceLeft -= info.Duration;
        console.log(allowanceLeft);
        document.getElementById("time-left").querySelector("span").innerText = parseInt(allowanceLeft);
        
        // Fill up info for autosaving data
        reCal2Places(div, order);
        reAssignValues();
        saveTrips();
    }

    // Edit/delete/rearrange
    async function editCard(btn, order) {
        var card = btn.closest(".plan-selection");
        var timeLeft = document.querySelector("#time-left").querySelector("span");
        card.closest("#recommendation-listings").getElementsByClassName("btn-addPlan")[order-1].remove();
        reAssignValues();

        timeLeft.innerText = parseInt(timeLeft.innerText) + parseInt(card.querySelector(".plan-total-duration").querySelector("span").innerText);
        allowanceLeft = timeLeft.innerText;
        openRecommendTab(order-1);
        card.remove();
    }

    function delCard(btn, order) {
        var card = btn.closest(".plan-selection");
        var div = btn.closest("#recommendation-listings");

        var timeLeft = document.querySelector("#time-left").querySelector("span");
        timeLeft.innerText = parseInt(timeLeft.innerText) + parseInt(card.querySelector(".plan-total-duration").querySelector("span").innerText);
        allowanceLeft = timeLeft.innerText;
        card.remove();

        reAssignValues();
        reCal2Places(div, order-1);
    }

    // Recalculate route and travel time
    async function reCal2Places(div, order) {
        var cards = div.getElementsByClassName("plan-selection");
        var aboveCard = cards[order-2];
        var belowCard = cards[order-1];
        var totalDuration = 0;
        for (var i=1; i<order-1; i++) {
            var duration = parseFloat(cards[i].querySelector(".plan-total-duration").querySelector("span").innerText);
            totalDuration += Math.round(duration);
        }

        await $.ajax({
            type: "POST",
            url: `/funcs/reCalculate`,
            data: {
                latlngs: [aboveCard.querySelector(".plan-latlng").innerText, belowCard.querySelector(".plan-latlng").innerText],
                routeType: document.getElementById("firstSelection").querySelector('input[type="radio"]:checked').value,
                date: currentTime.toISOString().slice(0, 10),
                topDuration: totalDuration,
                startTime: $("#start-time").val()
            },
            success: function(result) {
                result = JSON.parse(result);

                var belowCardTDuration = belowCard.querySelector(".plan-total-duration").innerText;
                var belowCardADuration = belowCard.querySelector(".plan-activity-duration")
                if (belowCardADuration) {
                    var belowCardADuration = belowCardADuration.querySelector("span").innerText;
                }
                else {
                    var belowCardADuration = 0;
                }

                var timeDiff = result[0] + parseInt(belowCardADuration) - parseInt(belowCardTDuration);
                belowCard.querySelector(".plan-travel-duration").innerText = Math.round(result[0] - belowCardADuration);
                document.querySelector("#time-left").querySelector("span").innerText = parseInt(document.querySelector("#time-left").querySelector("span").innerText) + timeDiff;
            }
        })

        saveTrips();
    }

    function reAssignValues() {
        var div = document.getElementsByClassName("btn-add-place");
        for (var i=0; i<div.length; i++) {
            div[i].setAttribute("onclick", `openRecommendTab(${i+1});`);
        }

        var startTime = new Date(`2022-01-01T${$("#start-time").val()}:00`);
        var plansCards = document.getElementsByClassName("plan-selection");

        var currTime = startTime.toLocaleTimeString('en-SG', {hour12: false});
        plansCards[0].querySelector(".plan-timing").innerText = currTime.substring(0, currTime.length-3);
        for (var i=1; i<plansCards.length-1; i++) {
            startTime.setTime(startTime.getTime() + parseInt(plansCards[i].querySelector(".plan-total-duration").querySelector("span").innerText)*60000);

            currTime = startTime.toLocaleTimeString('en-SG', {hour12: false});
            plansCards[i].querySelector(".plan-timing").innerText = currTime.substring(0, currTime.length-3);
        }

        if (allowanceLeft < 70) {

        }
    }

    function saveTrips() {
        startTme = $("#start-time").val();
        endTme = $("#end-time").val();

        // Update db function
        itineraryId = document.getElementById("itinerary-id").value;
        var allPlacesDiv = document.getElementsByClassName("plan-selection");
        var placesName = [];
        var placesAddress = [];
        var placesActivityDuration = [];
        var placesCategory = [];
        var placesImg = [];
        var placesDuration = [];
        var placesLatlng = [];

        for (var i=0; i<allPlacesDiv.length; i++) {
            placesName.push(allPlacesDiv[i].querySelector(".plan-name").innerText);
            placesAddress.push(allPlacesDiv[i].querySelector(".plan-address").innerText);
            if (i == 0 || i == allPlacesDiv.length-1) {
                placesCategory.push(null);
                placesImg.push(null);
                placesActivityDuration.push(null);
                placesDuration.push(null);
            }
            else {
                placesCategory.push(allPlacesDiv[i].querySelector(".plan-category").innerText);
                placesImg.push(allPlacesDiv[i].querySelector(".plan-img").querySelector("span").innerText);
                placesActivityDuration.push(parseInt(allPlacesDiv[i].querySelector(".plan-activity-duration").querySelector("span").innerText));
                placesDuration.push(parseInt(allPlacesDiv[i].querySelector(".plan-total-duration").querySelector("span").innerText));
            }
            placesLatlng.push(allPlacesDiv[i].querySelector(".plan-latlng").innerText);
        }

        $.ajax({
            type: "POST",
            url: `/funcs/save-trip`,
            data: {
                id: itineraryId,
                tripType: "Explorer",
                tripName: "Hello",
                date: "Today",
                startTime: startTme,
                endTime: endTme,
                names: placesName,
                addresses: placesAddress,
                categories: placesCategory,
                images: placesImg,
                activityDuration: placesActivityDuration,
                duration: placesDuration,
                latlngs: placesLatlng,
                timeAllowance: originalDuration,
                timeLeft: allowanceLeft,
                transportMode: "pt",
                confirmed: false,
                status: "Planning",
                hasEnd: true
            },
            success: function(result) {
                document.getElementById("itinerary-id").value = JSON.parse(result).id;
                console.log("System: Trip has been autosaved");
            }
        })
    }

    var canSearch = true;
    var dropdownCooldown = false;

    function openSearch(btn) {
        // Pull screen up
        $("#searchTab").show();
        $("#searchTab").animate({
            top: "0",
            bottom: "0"
        }, 350, function () {
            document.querySelector("#searchBar").focus();
        });

        $("#search-btnId").text(btn.id);
    }
    function closeSearch() {
        // Pull screen down
        $("#searchTab").animate({
            bottom: "-200vh"
        }, 350, function() {
            $("#searchTab").hide();
        });
    }

    function pauseSearch() {
        canSearch = false;
        setTimeout(function() {
            canSearch = true;
            search();
        }, 150);
    }
    
    function search() {
        if (canSearch) {
            var dropdownMenu = document.querySelector("#search-results");
            const search = document.querySelector("#searchBar").value;
            const pageNum = $("#searchPage").val()

            if (!search.trim()) {
                dropdownMenu.innerHTML = "";
            }
            else {
                $.ajax({
                    url: `https://developers.onemap.sg/commonapi/search?searchVal=${search}&returnGeom=Y&getAddrDetails=Y&pageNum=${pageNum}`,
                    success: function(result) {
                        dropdownMenu.innerHTML = "";
                        if (result.results.length > 0) {
                            dropdownMenu.style.display = "block";
                            showLength = 10;
                            if (result.results.length < 10) {
                                showLength = result.results.length;
                            }

                            for (var i=0; i<showLength; i++) {
                                dropdownCooldown = true;
                                record = result.results[i]
                                dropdownMenu.innerHTML += `
                                <div class="dropdown-item" onclick="addSE(this);">
                                    <p style="font-size: 14px; margin-bottom: 3px; font-weight: bold;">${capitalize(record.SEARCHVAL)}</p>
                                    <p style="font-size: 11px; max-width: 100%; overflow: auto; margin-bottom: 3px;">${capitalize(record.ADDRESS)}</p>
                                    <p hidden>${record.LATITUDE},${record.LONGITUDE}</p>
                                </div>`;

                                setTimeout(function () { dropdownCooldown = false; }, 126)
                            }
                        }
                        else {
                            dropdownMenu.innerHTML = `<div class="dropdown-item">No results found</div>`; 
                        }
                    }
                });
            }

        }     
    }

    function recSearch(order){
        var dropdownMenu = document.querySelector("#recSearch-results-results");
        var recentMenu = document.querySelector("#recSearch-results-recent");
        const search = document.querySelector("#recSearchBar").value;
        var cat = document.querySelector("#selectedCat").innerText;

        if (search.trim().length == 0) {
            dropdownMenu.innerHTML = "";
        }
        else {
            $.ajax({
                dataType: "json",
                url: `/funcs/search?s=${search}&page=${1}&cat=${cat}`,
                success: function(result) {
                    dropdownMenu.innerHTML = "";
                    // Filter recent searches
                    var allRecent = recentMenu.children;
                    if (allRecent.length > 0) {
                        $(".recentheader").show();
                        for (var i=0; i<allRecent.length; i++) {
                            if (allRecent[i].querySelector(".recentname").innerText.toLowerCase.contains(search.toLowerCase)) {
                                allRecent[i].style.display = "block";
                            }
                            else {
                                allRecent[i].style.display = "none";
                            }
                        }
                    }
                    else {
                        $(".recentheader").hide();
                    }

                    if (result.length > 0) {
                        dropdownMenu.style.display = "block";
                        $(".resultsheader").show();
                        showLength = 10;
                        if (result.length < 10) {
                            showLength = result.length;
                        }
                        
                        for (var i=0; i<showLength; i++) {
                            dropdownCooldown = true;
                            record = result[i]
                            card = 
                            `<div class="recentcards searchcard" onclick="chooseSearchPlace(this, ${order});">
                                <div class="cardimg" style="background-image: url('${record["Image_url"]}')">
                                </div>
                        
                                <div class="cardinfo">
                                    <h1 class="recentname search-name">${record["Name"]}</h1>
                                    <p class="search-address" hidden>${record["Address"]}</p>
                                    <p class="search-address" hidden>${record["ActivityDuration"]}</p>
                                    <div class="recenttype">
                                        <h3 class="recentcat">${record['Category']}</h3>
                                        <div class="rating">`;
                            for (var j=0; j<Math.floor(parseFloat(record['Rating'])); j++) {
                                card += 
                                    `<svg width="12" height="12" fill="none">
                                        <rect x="0.5" y="0.5" width="11" height="11" rx="1.5" stroke="#E4002B" />
                                    </svg>`;
                            }

                            ratingDeci = parseFloat(record["Rating"]) - Math.floor(parseFloat(record['Rating']));
                            if (ratingDeci < 0.35) {
                                card += 
                                    `<svg width="12" height="12" fill="none">
                                        <rect x="0.5" y="0.5" width="11" height="11" rx="1.5" stroke="#E4002B" />
                                    </svg>`;
                            } 
                            else if (ratingDeci > 0.3 && ratingDeci < 0.7) {
                                card += 
                                    `<svg width="12" height="12" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="url(#paint0_linear_2171_1619)" stroke-width="3" />
                                        <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="url(#paint1_linear_2171_1619)" />
                                        <defs>
                                            <linearGradient id="paint0_linear_2171_1619" x1="0" y1="20" x2="40" y2="20" gradientUnits="userSpaceOnUse">
                                            <stop stop-color="#E4002B" />
                                            <stop offset="0.484375" stop-color="#E4002B" />
                                            <stop offset="0.515625" stop-color="#BBBBBB" />
                                            <stop offset="1" stop-color="#BBBBBB" />
                                            </linearGradient>
                                            <linearGradient id="paint1_linear_2171_1619" x1="7.46094" y1="20" x2="32.4759" y2="20" gradientUnits="userSpaceOnUse">
                                            <stop stop-color="#E4002B" />
                                            <stop offset="0.484375" stop-color="#E4002B" />
                                            <stop offset="0.515625" stop-color="#BBBBBB" />
                                            <stop offset="1" stop-color="#BBBBBB" />
                                            </linearGradient>
                                        </defs>
                                    </svg>`;
                            }
                            else {
                                card += 
                                    `<svg width="12" height="12" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="#E4002B" stroke-width="3" />
                                        <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="#E4002B" />
                                    </svg>`;
                            }

                            for (var j=0; j<5- Math.ceil(parseFloat(record['Rating'])) + 1; j++) {
                                card += 
                                    `<svg width="12" height="12" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="#E4002B" stroke-width="3" />
                                        <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="#E4002B" />
                                    </svg>`;
                            }
                            card += `<p class="ratingvalue">${record["Review_no"]}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>`;
                            dropdownMenu.innerHTML += card;

                            setTimeout(function () { dropdownCooldown = false; }, 126)
                        }
                    }
                    else {
                        dropdownMenu.style.display = "none";
                        dropdownMenu.innerText = `No results found`; 
                    }
                }
            });

        }     
    }

    function searchNextPage() {
        $("#searchPage").text(parseInt($("#searchPage").text()) + 1)
    }

    function addSE(card) { 
        var btnId = $("#search-btnId").text();
        var allP = card.getElementsByTagName("p");
        var type = "start";
        if (btnId.charAt(0) == "e") {
            type = "end";
        }
        
        $(`#${type}-location`).val(allP[0].innerText);
        startEndAttr = ["name", "address", "latlng"];
        for (var i=0; i<startEndAttr.length; i++) {
            document.querySelector(`#${type}-location-${startEndAttr[i]}`).innerText = allP[i].innerText;
        }

        closeSearch();
    }

    function displayRouteDetails() {
        var allAddresses = document.getElementsByClassName("plan-address");
        var allLatlngs = document.getElementsByClassName("plan-latlng");
        var allRouteDiv = document.getElementsByClassName("explorertransport")
        var routeType = document.querySelector('input[name="transportMode"]:checked').value;
        var checkTime = currentTime;
        var startTime = $("#start-time").val();

        function getAPIRoute(index) {
            var position1 = allLatlngs[index].innerText.split(",");
            var position2 = allLatlngs[index+1].innerText.split(",");
            var res = true;

            allRouteDiv[index].innerHTML = "";

            $.ajax({
                dataType: "json",
                url: `https://developers.onemap.sg/privateapi/routingsvc/route?start=${position1[0]},${position1[1]}&end=${position2[0]},${position2[1]}&routeType=${routeType}&token=${apiKey}&date=${String(checkTime.getFullYear())}-${String(checkTime.getMonth()+1)}-${String(checkTime.getDate())}&time=${startTime}:00&mode=TRANSIT`,
                success: function(result) {
                    //Set result to a variable for writing
                    if (routeType == "pt")
                        var info = result.plan.itineraries[0];
     
                        else
                        var info = result.route_summary;

                    function addModeIcon(routeType, info) {
                        if (routeType == "walk") {
                            allRouteDiv[index].innerHTML += 
                                `<div><svg width="14" height="20" viewBox="0 0 14 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                    d="M8.79073 3.72093C9.12694 3.72093 9.4556 3.61182 9.73514 3.40739C10.0147 3.20296 10.2326 2.91239 10.3612 2.57244C10.4899 2.23248 10.5236 1.8584 10.458 1.49751C10.3924 1.13661 10.2305 0.805109 9.99274 0.544918C9.75501 0.284728 9.45211 0.107536 9.12236 0.0357492C8.79262 -0.0360373 8.45082 0.000806104 8.14021 0.14162C7.82959 0.282435 7.5641 0.520895 7.37731 0.826847C7.19053 1.1328 7.09083 1.4925 7.09083 1.86047C7.09217 2.35344 7.2717 2.8258 7.5902 3.17439C7.90871 3.52297 8.3403 3.71946 8.79073 3.72093ZM5.73091 16.6512L6.58086 12.5581L8.36575 14.4186V20H10.0657V13.0233L8.28076 11.1628L8.79073 8.37209C9.3739 9.10142 10.0926 9.68613 10.8987 10.0872C11.7049 10.4882 12.5799 10.6964 13.4655 10.6977V8.83721C12.7307 8.84941 12.0061 8.64946 11.3644 8.25751C10.7228 7.86557 10.1869 7.29547 9.81067 6.60465L8.96072 5.11628C8.81006 4.84145 8.59888 4.61233 8.34647 4.44983C8.09407 4.28733 7.80848 4.19664 7.5158 4.18605C7.26082 4.18605 7.09083 4.27907 6.83584 4.27907L2.4161 6.32558V10.6977H4.116V7.53489L5.64591 6.88372L4.28599 14.4186L0.12123 13.4884L-0.21875 15.3488L5.73091 16.6512Z"
                                    fill="#707070" />
                                </svg></div>`;
                        }
                        else if (routeType == "drive") {
                            allRouteDiv[index].innerHTML += 
                                `<div><svg width="14" height="20" viewBox="0 0 14 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                    d="M8.79073 3.72093C9.12694 3.72093 9.4556 3.61182 9.73514 3.40739C10.0147 3.20296 10.2326 2.91239 10.3612 2.57244C10.4899 2.23248 10.5236 1.8584 10.458 1.49751C10.3924 1.13661 10.2305 0.805109 9.99274 0.544918C9.75501 0.284728 9.45211 0.107536 9.12236 0.0357492C8.79262 -0.0360373 8.45082 0.000806104 8.14021 0.14162C7.82959 0.282435 7.5641 0.520895 7.37731 0.826847C7.19053 1.1328 7.09083 1.4925 7.09083 1.86047C7.09217 2.35344 7.2717 2.8258 7.5902 3.17439C7.90871 3.52297 8.3403 3.71946 8.79073 3.72093ZM5.73091 16.6512L6.58086 12.5581L8.36575 14.4186V20H10.0657V13.0233L8.28076 11.1628L8.79073 8.37209C9.3739 9.10142 10.0926 9.68613 10.8987 10.0872C11.7049 10.4882 12.5799 10.6964 13.4655 10.6977V8.83721C12.7307 8.84941 12.0061 8.64946 11.3644 8.25751C10.7228 7.86557 10.1869 7.29547 9.81067 6.60465L8.96072 5.11628C8.81006 4.84145 8.59888 4.61233 8.34647 4.44983C8.09407 4.28733 7.80848 4.19664 7.5158 4.18605C7.26082 4.18605 7.09083 4.27907 6.83584 4.27907L2.4161 6.32558V10.6977H4.116V7.53489L5.64591 6.88372L4.28599 14.4186L0.12123 13.4884L-0.21875 15.3488L5.73091 16.6512Z"
                                    fill="#707070" />
                                </svg></div>`;
                        }
                        else if (routeType == "cycle") {
                            allRouteDiv[index].innerHTML += 
                                `<div><svg width="14" height="20" viewBox="0 0 14 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                    d="M8.79073 3.72093C9.12694 3.72093 9.4556 3.61182 9.73514 3.40739C10.0147 3.20296 10.2326 2.91239 10.3612 2.57244C10.4899 2.23248 10.5236 1.8584 10.458 1.49751C10.3924 1.13661 10.2305 0.805109 9.99274 0.544918C9.75501 0.284728 9.45211 0.107536 9.12236 0.0357492C8.79262 -0.0360373 8.45082 0.000806104 8.14021 0.14162C7.82959 0.282435 7.5641 0.520895 7.37731 0.826847C7.19053 1.1328 7.09083 1.4925 7.09083 1.86047C7.09217 2.35344 7.2717 2.8258 7.5902 3.17439C7.90871 3.52297 8.3403 3.71946 8.79073 3.72093ZM5.73091 16.6512L6.58086 12.5581L8.36575 14.4186V20H10.0657V13.0233L8.28076 11.1628L8.79073 8.37209C9.3739 9.10142 10.0926 9.68613 10.8987 10.0872C11.7049 10.4882 12.5799 10.6964 13.4655 10.6977V8.83721C12.7307 8.84941 12.0061 8.64946 11.3644 8.25751C10.7228 7.86557 10.1869 7.29547 9.81067 6.60465L8.96072 5.11628C8.81006 4.84145 8.59888 4.61233 8.34647 4.44983C8.09407 4.28733 7.80848 4.19664 7.5158 4.18605C7.26082 4.18605 7.09083 4.27907 6.83584 4.27907L2.4161 6.32558V10.6977H4.116V7.53489L5.64591 6.88372L4.28599 14.4186L0.12123 13.4884L-0.21875 15.3488L5.73091 16.6512Z"
                                    fill="#707070" />
                                </svg></div>`;
                        }
                        else if (routeType == "bus") {
                            var routes = info.route.split("/")
                            for (var i=0; i<routes.length; i++) {
                                allRouteDiv[index].innerHTML += 
                                    `<div class="transportation" style="background: ${routeTextures[routeType].color}">
                                        <h1>${routes[i]}</h1>
                                    </div>`;
                            }
                        }
                        else if (routeType == "tram") {
                            allRouteDiv[index].innerHTML += 
                                `<div class="transportation" style="background: ${routeTextures[routeType].color}">
                                    <h1>${info.route}</h1>
                                </div>`;
                        }
                        else if (routeType == "subway") {
                            console.log(info.route)
                            allRouteDiv[index].innerHTML += 
                                `<div class="transportation" style="background: ${routeTextures.subway[info.route].color}">
                                    <h1>${info.route}</h1>
                                </div>`;
                        }
                    }

                    if (routeType == "pt") {
                        for (var i=0; i<info.legs.length; i++) {
                            addModeIcon(info.legs[i].mode.toLowerCase(), info.legs[i]);
                            if (i != info.legs.length -1) {
                                allRouteDiv[index].innerHTML += 
                                    `<div><svg width="8" height="13" viewBox="0 0 8 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                        d="M1.54958 -1.36256e-06C1.75249 0.0669132 1.89922 0.212233 2.04594 0.362284C3.87674 2.23657 5.70952 4.10882 7.54098 5.98108C7.79676 6.24265 7.85162 6.54884 7.68969 6.83069C7.65466 6.89152 7.6084 6.9483 7.55882 6.99899C5.67846 8.92329 3.79611 10.8462 1.91442 12.7705C1.7201 12.9693 1.4934 13.0544 1.22572 12.9638C0.981174 12.8814 0.835107 12.7009 0.791485 12.4414C0.757777 12.2413 0.816601 12.0649 0.944162 11.9121C0.979192 11.8702 1.01753 11.8317 1.0552 11.7925C2.74389 10.0662 4.43193 8.33998 6.12195 6.6144C6.15632 6.57925 6.20324 6.55695 6.24422 6.52856L6.24422 6.47178C6.20324 6.4434 6.15632 6.42109 6.12195 6.38594C4.42069 4.64887 2.7201 2.91044 1.02017 1.17202C0.76042 0.906386 0.71085 0.592767 0.879389 0.310239C0.977868 0.145319 1.13319 0.0648857 1.30173 -1.34089e-06L1.54958 -1.36256e-06Z"
                                        fill="#707070" />
                                    </svg></div>`;
                            }
                        }
                    }
                    else {
                        addModeIcon(routeType, info);
                    }
                },
                error: function(jqXHR, textStatus, err) {
                    res = false;
                }
            });

            return res;
        }

        for (var i=0; i<allAddresses.length-1; i++) {
            tries = 0;
            while (tries <= 3) {
                tries++;
                res = getAPIRoute(i);
                if (res)
                    break;
            }
        }
    }

    // initFunctions();

    // Map settings
    // Map display init
    L.Icon.Default.imagePath = "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.4.0/images";
    var center = L.bounds([1.56073, 104.11475], [1.16, 103.502]).getCenter();
    var map = L.map('mapdiv').setView([center.x, center.y], 12);
    var yourMarker;
    var startMarker;
    var endMarker;

    var routeTextures = {
        walk: {color: "black", dashArray: "10, 10"},
        subway: {
            NE: {color: "#8E3E98"},
            NS: {color: "#E32325"},
            DT: {color: "#2059A9"},
            EW: {color: "#0C9345"},
            CC: {color: "#F99D21"},
            CE: {color: "#F99D21"},
            TE: {color: "#AA7242"},
            Default: {color: "#708573"}
        },
        tram: {color: "#708573"},
        bus: {color: "#0C9345"},
        drive: {color: "black"}
    }

    var basemap = L.tileLayer(`http://maps-{s}.onemap.sg/v2/Default/{z}/{x}/{y}.png`, {
        detectRetina: true,
        maxZoom: 18,
        minZoom: 12,
    });

    map.setMaxBounds([[1.56073, 104.1147], [1.16, 103.502]]);

    basemap.addTo(map);

    var updatePosition = false;
    var repeatedBuildings = {};

    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showYourPosition, positioningError, {
                timeout: 500,
                enableHighAccuracy: true
            });
            navigator.geolocation.watchPosition(showYourPosition, positioningError, {
                timeout: 500,
                enableHighAccuracy: true
            });
        }
    }

    function openMapView() {
        // Make toggle cards
        var planCards = document.getElementById("recommendation-listings").getElementsByClassName("plan-selection");
        var mapDiv = document.getElementById("map-selection");
        mapDiv.innerHTML = "";
        for (var i=1; i<planCards.length; i++) {
            mapDiv.innerHTML += 
            `<div class="mapdetails trip-place" onclick="showRoute('${planCards[i-1].querySelector(".plan-latlng").innerText}', '${planCards[i].querySelector(".plan-latlng").innerText}')">
                <!-- explorerevent -->
                <div class="explorerevent">
                    <div class="eventdetails">
                    <div class="eventinfo">
                        <h1 class="eventname">${planCards[i-1].querySelector(".plan-name").innerText}</h1>
                    </div>
                    </div>

                    <div class="eventedit">
                        <h1>${planCards[i].querySelector(".plan-travel-duration").innerText} mins</h1>
                    </div>
                </div>

                <!-- explorerdirections -->
                <div class="mapdirections">
                    <div class="maptransport">
                    </div>

                    <!-- explorertravelduration -->
                    <div class="explorertravelduration">
                    <h2 onclick="showExpandedRoute">See Details</h2>
                    </div>
                </div>
            </div>`;

            routeIconsDiv = mapDiv.getElementsByClassName("maptransport");
            var routeType = document.querySelector('input[name="transportMode"]:checked').value;
            var checkTime = currentTime;
            var startTime = $("#start-time").val();

            function getAPIRoute(index) {
                var position1 = planCards[index-1].querySelector(".plan-latlng").innerText.split(",");
                var position2 = planCards[index].querySelector(".plan-latlng").innerText.split(",");
                var res = true;

                routeIconsDiv[index-1].innerHTML = "";

                $.ajax({
                    dataType: "json",
                    url: `https://developers.onemap.sg/privateapi/routingsvc/route?start=${position1[0]},${position1[1]}&end=${position2[0]},${position2[1]}&routeType=${routeType}&token=${apiKey}&date=${String(checkTime.getFullYear())}-${String(checkTime.getMonth()+1)}-${String(checkTime.getDate())}&time=${startTime}:00&mode=TRANSIT`,
                    success: function(result) {
                        //Set result to a variable for writing
                        if (routeType == "pt")
                            var info = result.plan.itineraries[0];
                        else
                            var info = result.route_summary;

                        function addModeIcon(routeType, info) {
                            if (routeType == "walk") {
                                routeIconsDiv[index-1].innerHTML += 
                                    `<svg width="14" height="20" viewBox="0 0 14 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                        d="M8.79073 3.72093C9.12694 3.72093 9.4556 3.61182 9.73514 3.40739C10.0147 3.20296 10.2326 2.91239 10.3612 2.57244C10.4899 2.23248 10.5236 1.8584 10.458 1.49751C10.3924 1.13661 10.2305 0.805109 9.99274 0.544918C9.75501 0.284728 9.45211 0.107536 9.12236 0.0357492C8.79262 -0.0360373 8.45082 0.000806104 8.14021 0.14162C7.82959 0.282435 7.5641 0.520895 7.37731 0.826847C7.19053 1.1328 7.09083 1.4925 7.09083 1.86047C7.09217 2.35344 7.2717 2.8258 7.5902 3.17439C7.90871 3.52297 8.3403 3.71946 8.79073 3.72093ZM5.73091 16.6512L6.58086 12.5581L8.36575 14.4186V20H10.0657V13.0233L8.28076 11.1628L8.79073 8.37209C9.3739 9.10142 10.0926 9.68613 10.8987 10.0872C11.7049 10.4882 12.5799 10.6964 13.4655 10.6977V8.83721C12.7307 8.84941 12.0061 8.64946 11.3644 8.25751C10.7228 7.86557 10.1869 7.29547 9.81067 6.60465L8.96072 5.11628C8.81006 4.84145 8.59888 4.61233 8.34647 4.44983C8.09407 4.28733 7.80848 4.19664 7.5158 4.18605C7.26082 4.18605 7.09083 4.27907 6.83584 4.27907L2.4161 6.32558V10.6977H4.116V7.53489L5.64591 6.88372L4.28599 14.4186L0.12123 13.4884L-0.21875 15.3488L5.73091 16.6512Z"
                                        fill="#707070" />
                                    </svg>`;
                            }
                            else if (routeType == "drive") {
                                routeIconsDiv[index-1].innerHTML += 
                                    `<svg width="8" height="13" viewBox="0 0 8 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                        d="M1.54958 -1.36256e-06C1.75249 0.0669132 1.89922 0.212233 2.04594 0.362284C3.87674 2.23657 5.70952 4.10882 7.54098 5.98108C7.79676 6.24265 7.85162 6.54884 7.68969 6.83069C7.65466 6.89152 7.6084 6.9483 7.55882 6.99899C5.67846 8.92329 3.79611 10.8462 1.91442 12.7705C1.7201 12.9693 1.4934 13.0544 1.22572 12.9638C0.981174 12.8814 0.835107 12.7009 0.791485 12.4414C0.757777 12.2413 0.816601 12.0649 0.944162 11.9121C0.979192 11.8702 1.01753 11.8317 1.0552 11.7925C2.74389 10.0662 4.43193 8.33998 6.12195 6.6144C6.15632 6.57925 6.20324 6.55695 6.24422 6.52856L6.24422 6.47178C6.20324 6.4434 6.15632 6.42109 6.12195 6.38594C4.42069 4.64887 2.7201 2.91044 1.02017 1.17202C0.76042 0.906386 0.71085 0.592767 0.879389 0.310239C0.977868 0.145319 1.13319 0.0648857 1.30173 -1.34089e-06L1.54958 -1.36256e-06Z"
                                        fill="#707070" />
                                    </svg>`;
                            }
                            else if (routeType == "cycle") {
                                routeIconsDiv[index-1].innerHTML += 
                                    `<div><svg width="14" height="20" viewBox="0 0 14 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                        d="M15.4969 3.90244C15.8829 3.90244 16.2601 3.788 16.581 3.5736C16.9019 3.3592 17.152 3.05446 17.2996 2.69792C17.4473 2.34138 17.486 1.94906 17.4107 1.57056C17.3354 1.19206 17.1496 0.844382 16.8767 0.5715C16.6038 0.298617 16.2561 0.112781 15.8776 0.037493C15.4991 -0.0377952 15.1068 0.000845426 14.7502 0.148529C14.3937 0.296212 14.089 0.546304 13.8746 0.867181C13.6602 1.18806 13.5457 1.56531 13.5457 1.95122C13.5473 2.46824 13.7533 2.96364 14.1189 3.32923C14.4845 3.69483 14.9799 3.9009 15.4969 3.90244V3.90244ZM5.25305 10.2439C3.95931 10.2439 2.71856 10.7578 1.80375 11.6726C0.888936 12.5875 0.375 13.8282 0.375 15.1219C0.375 16.4157 0.888936 17.6564 1.80375 18.5712C2.71856 19.4861 3.95931 20 5.25305 20C6.54679 20 7.78754 19.4861 8.70235 18.5712C9.61716 17.6564 10.1311 16.4157 10.1311 15.1219C10.1311 13.8282 9.61716 12.5875 8.70235 11.6726C7.78754 10.7578 6.54679 10.2439 5.25305 10.2439ZM5.25305 18.5366C4.34743 18.5366 3.47891 18.1768 2.83854 17.5365C2.19817 16.8961 1.83841 16.0276 1.83841 15.1219C1.83841 14.2163 2.19817 13.3478 2.83854 12.7074C3.47891 12.0671 4.34743 11.7073 5.25305 11.7073C6.15866 11.7073 7.02719 12.0671 7.66756 12.7074C8.30793 13.3478 8.66768 14.2163 8.66768 15.1219C8.66768 16.0276 8.30793 16.8961 7.66756 17.5365C7.02719 18.1768 6.15866 18.5366 5.25305 18.5366ZM10.9116 8.78049L13.253 6.43902L14.0335 7.21951C14.6811 7.87989 15.456 8.40196 16.3112 8.75412C17.1665 9.10628 18.0843 9.2812 19.0091 9.26829V7.31707C18.3553 7.32268 17.707 7.19592 17.1034 6.94442C16.4998 6.69292 15.9534 6.32189 15.4969 5.85366L13.6433 4C13.21 3.62402 12.656 3.41627 12.0823 3.41463C11.8246 3.39755 11.5665 3.44168 11.3291 3.54341C11.0918 3.64515 10.8818 3.80161 10.7165 4L7.98475 6.73171C7.80159 6.90926 7.65552 7.12143 7.55503 7.3559C7.45454 7.59037 7.40164 7.84247 7.39939 8.09756C7.3823 8.35526 7.42643 8.61335 7.52817 8.85073C7.6299 9.08812 7.78636 9.29806 7.98475 9.46341L11.1067 12.1951V17.0732H13.0579V11.0244L10.9116 8.78049ZM18.9116 10.2439C17.9468 10.2439 17.0037 10.53 16.2015 11.066C15.3993 11.602 14.7741 12.3639 14.4049 13.2552C14.0356 14.1465 13.939 15.1274 14.1273 16.0736C14.3155 17.0199 14.7801 17.889 15.4623 18.5712C16.1445 19.2535 17.0137 19.718 17.9599 19.9063C18.9062 20.0945 19.887 19.9979 20.7783 19.6287C21.6697 19.2595 22.4315 18.6342 22.9675 17.832C23.5035 17.0299 23.7896 16.0867 23.7896 15.1219C23.796 14.4796 23.6742 13.8424 23.4313 13.2477C23.1884 12.653 22.8294 12.1127 22.3751 11.6584C21.9209 11.2042 21.3806 10.8451 20.7859 10.6022C20.1911 10.3593 19.554 10.2375 18.9116 10.2439V10.2439ZM18.9116 18.5366C18.2362 18.5366 17.576 18.3363 17.0145 17.9611C16.453 17.5859 16.0153 17.0526 15.7569 16.4287C15.4984 15.8047 15.4308 15.1182 15.5626 14.4558C15.6943 13.7934 16.0195 13.185 16.4971 12.7074C16.9746 12.2299 17.583 11.9047 18.2454 11.7729C18.9078 11.6412 19.5944 11.7088 20.2183 11.9672C20.8422 12.2257 21.3755 12.6633 21.7507 13.2249C22.1259 13.7864 22.3262 14.4466 22.3262 15.1219C22.3153 16.0242 21.9521 16.8864 21.3141 17.5244C20.676 18.1624 19.8138 18.5257 18.9116 18.5366V18.5366Z"
                                        fill="#707070" />
                                    </svg></div>`;
                            }
                            else if (routeType == "bus") {
                                var routes = info.route.split("/")
                                for (var i=0; i<routes.length; i++) {
                                    routeIconsDiv[index-1].innerHTML += 
                                        `<div class="transportation" style="background: ${routeTextures[routeType].color}">
                                            <h1>${routes[i]}</h1>
                                        </div>`;
                                }
                            }
                            else if (routeType == "tram") {
                                routeIconsDiv[index-1].innerHTML += 
                                    `<div class="transportation" style="background: ${routeTextures[routeType].color}">
                                        <h1>${info.route}</h1>
                                    </div>`;
                            }
                            else if (routeType == "subway") {
                                console.log(info.route)
                                routeIconsDiv[index-1].innerHTML += 
                                    `<div class="transportation" style="background: ${routeTextures.subway[info.route].color}">
                                        <h1>${info.route}</h1>
                                    </div>`;
                            }
                        }

                        if (routeType == "pt") {
                            for (var i=0; i<info.legs.length; i++) {
                                addModeIcon(info.legs[i].mode.toLowerCase(), info.legs[i]);
                                if (i != info.legs.length -1) {
                                    routeIconsDiv[index-1].innerHTML += 
                                        `<div><svg width="8" height="13" viewBox="0 0 8 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path
                                            d="M1.54958 -1.36256e-06C1.75249 0.0669132 1.89922 0.212233 2.04594 0.362284C3.87674 2.23657 5.70952 4.10882 7.54098 5.98108C7.79676 6.24265 7.85162 6.54884 7.68969 6.83069C7.65466 6.89152 7.6084 6.9483 7.55882 6.99899C5.67846 8.92329 3.79611 10.8462 1.91442 12.7705C1.7201 12.9693 1.4934 13.0544 1.22572 12.9638C0.981174 12.8814 0.835107 12.7009 0.791485 12.4414C0.757777 12.2413 0.816601 12.0649 0.944162 11.9121C0.979192 11.8702 1.01753 11.8317 1.0552 11.7925C2.74389 10.0662 4.43193 8.33998 6.12195 6.6144C6.15632 6.57925 6.20324 6.55695 6.24422 6.52856L6.24422 6.47178C6.20324 6.4434 6.15632 6.42109 6.12195 6.38594C4.42069 4.64887 2.7201 2.91044 1.02017 1.17202C0.76042 0.906386 0.71085 0.592767 0.879389 0.310239C0.977868 0.145319 1.13319 0.0648857 1.30173 -1.34089e-06L1.54958 -1.36256e-06Z"
                                            fill="#707070" />
                                        </svg></div>`;
                                }
                            }
                        }
                        else {
                            addModeIcon(routeType, info);
                        }
                    },
                    error: function(jqXHR, textStatus, err) {
                        res = false;
                    }
                });

                return res;
            }

            tries = 0;
            while (tries <= 3) {
                tries++;
                res = getAPIRoute(i);
                if (res)
                    break;
            }
        }

        // Default show 1st part trip
        var firstCard = document.querySelector(".trip-place")
        if (typeof firstCard.onclick == "function")
            firstCard.onclick.apply(firstCard);

        // Pull plan page down
        $("#planPage").animate({
            top: "0",
            bottom: "-200vh"
        }, 350, function () {
            $("#planPage").hide();
            $("#mapView").show();
        });
    }

    function dismissMapView() {
        // Pull plan page up
        $("#planPage").show();
        $("#planPage").animate({
            top: "0",
            bottom: "0"
        }, 350), function() {
            $("#mapView").hide();
        };
    }

    function showYourPosition(position) {  
        updatePosition = true;  
        // Mark marker
        if (yourMarker) {
            map.removeLayer(yourMarker);
        }
        
        yourMarker = new L.Marker([position.coords.latitude, position.coords.longitude], {bounceOnAdd: false, customId: "YouMarker"}).addTo(map);
        latLngStr = position.coords.latitude + "," + position.coords.longitude;
        document.getElementById("start-latlng").innerText = latLngStr;

        post = latLngStr;
    }

    function positioningError(error) {

    }

    function showRoute(position1, position2) {
        // Routing display
        var today = new Date();
        var routeType = document.querySelector('input[name="transportMode"]:checked').value;
        if (routeType == "Public Transport") {
            routeType = "pt";
        }

        var position1 = position1.split(",");
        var position2 = position2.split(",");

        function decodeGeo(encodedRoute) {
            if (encodedRoute !== undefined || encodedRoute !== '' || encodedRoute != null ) {
                var routeGeo = L.Polyline.fromEncoded(encodedRoute, {
                    precision: 6
                });

                return routeGeo;
            }
        }

        $.ajax({
            url: `https://developers.onemap.sg/privateapi/routingsvc/route?start=${position1[0]},${position1[1]}&end=${position2[0]},${position2[1]}&routeType=${routeType}&token=${apiKey}&date=${String(today.getFullYear())}-${String(today.getMonth()+1)}-${String(today.getDate())}&time=${String(today.getHours())}:${String(today.getMinutes())}:${String(today.getSeconds())}&mode=TRANSIT`,
            success: function(result) {
                //Set result to a variable for writing
                var encodedRoute;
                var modes = [];

                // Remove previous markings and route paths
                if (startMarker) {
                    map.removeLayer(startMarker);
                }
                if (endMarker) {
                    map.removeLayer(endMarker);
                }
                pathPieces = [].slice.call(document.getElementsByTagName("path")).map(x => x.parentElement);
                for (var i=0; i<pathPieces.length; i++) {
                    pathPieces[i].remove();
                }

                startMarker = new L.Marker([position1[0], position1[1]], {bounceOnAdd: true}).addTo(map);
                endMarker = new L.Marker([position2[0], position2[1]], {bounceOnAdd: true}).addTo(map);
                 
                if (routeType == "pt") {
                    var allRoutes = result.plan.itineraries;
                    for (var i in allRoutes) {
                        var transportMeans = allRoutes[i].legs;
                        for (var j in transportMeans) {
                            var details = transportMeans[j];
                            var mode = details.mode.toLowerCase();

                            encodedRoute = details.legGeometry.points
                            var routeGeo = decodeGeo(encodedRoute);
                            modes = {endpoints: routeGeo._latlngs, mode: mode};

                            if (mode.toLowerCase == "subway") {
                                var subwayLine = details.route;
                                L.polyline(modes.endpoints, routeTextures.subway[subwayLine]).addTo(map);
                            }
                            else {
                                L.polyline(modes.endpoints, routeTextures[modes.mode]).addTo(map);
                            }
                        }

                        // Remove for the next time, only take 1st route
                        break
                    }
                }
                else {
                    encodedRoute = result.route_geometry;
                    var routeGeo = decodeGeo(encodedRoute);
                    modes = {endpoints: routeGeo._latlngs, mode: routeType.toUpperCase()};

                    L.polyline(modes.endpoints, routeTextures[modes.mode]).addTo(map);
                }
            }
        });
    }

    window.addEventListener('load', function () {
        document.addEventListener('click', function (event) {
            const allTabs = document.getElementsByClassName("dropdown-menu-search");
            const endInp = document.getElementById("end-location");
            const startInp = document.getElementById("start-location");

            if (![].slice.call(allTabs).find(x => x === event.target) && event.target != endInp && event.target != startInp) {
                if (!dropdownCooldown) {
                    for (var i in allTabs) {
                        allTabs.item(i).style.display = "none";
                    }
                }
            }
        });

        getLocation();
        displayRouteDetails();

        setInterval(function () {
            if (document.getElementById("start-location-name").innerText == "Your Location") {
                document.getElementById("start-location-latlng").innerText = post;
            }
            if (document.getElementById("end-location-name").innerText == "Your Location") {
                document.getElementById("end-location-latlng").innerText = post;
            }
        }, 3000)
    });

</script>
{% endblock %}
