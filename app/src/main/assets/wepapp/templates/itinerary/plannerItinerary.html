{% extends "base.html" %}
{% block title %}Redpins Buffer - Planner{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" />
<script src="https://cdn.onemap.sg/leaflet/onemap-leaflet.js"></script>
<script type="text/javascript" src="https://rawgit.com/jieter/Leaflet.encoded/master/Polyline.encoded.js"></script>


<div class="device" id="reloadingbg" style="display: none;">
    <img src="/static/images/logo.gif" alt="logo" class="relogogif">
</div>

<div class="main-div device">
    <!-- header -->
    <section class="plannertriptopcon">
        <div class="plannerheader">
            <svg width="12" height="20" onclick="window.open('/','_self')">
                <path
                d="M10.2642 0C10.8582 0.203504 11.2215 0.68581 11.6052 1.12894C11.9081 1.47897 11.8687 2.05183 11.5761 2.4156C11.5052 2.50072 11.4295 2.58174 11.3494 2.65828C8.94914 5.0464 6.54751 7.43334 4.14452 9.81909C4.0819 9.87251 4.01519 9.92099 3.94498 9.96409C4.03554 10.0582 4.08722 10.1167 4.14145 10.1676C6.56048 12.5737 8.9795 14.9796 11.3985 17.3854C11.8298 17.8148 11.9613 18.3439 11.6385 18.7738C11.3346 19.1709 10.9778 19.5251 10.5779 19.8264C10.2074 20.1093 9.70807 20.0259 9.34174 19.7247C9.28648 19.6794 9.23276 19.6311 9.18211 19.5807L0.412125 10.8636C-0.0248138 10.4296 -0.119978 9.92084 0.153748 9.45024C0.222198 9.33957 0.304744 9.23817 0.399334 9.14854C3.33272 6.23165 6.26697 3.31661 9.20206 0.403448C9.37602 0.231995 9.61905 0.132787 9.8324 0H10.2642Z"
                fill="#2B2B2B" />
            </svg>
            <h1>Edit Planner</h1>
            <div class="cardedit">
                <svg width="21" height="5" viewBox="0 0 21 5" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="18.1367" cy="2.63721" r="2" transform="rotate(90 18.1367 2.63721)" fill="#2B2B2B" />
                <circle cx="2.13672" cy="2.63721" r="2" transform="rotate(90 2.13672 2.63721)" fill="#2B2B2B" />
                <circle cx="10.1367" cy="2.63721" r="2" transform="rotate(90 10.1367 2.63721)" fill="#2B2B2B" />
                </svg>
            </div>
            </div>
    
            <!-- plannerslider -->
            <div class="plannerslider">
            <ul>
                <!-- covid guidelines -->
                <li>
                <svg width="19" height="21" viewBox="0 0 19 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                    d="M18.441 13.8319C18.1065 13.7496 17.8591 13.9064 17.6525 14.1586C17.025 13.7931 16.4087 13.4337 15.8333 13.0986C16.0044 12.4542 16.166 11.8474 16.3341 11.2149C16.7852 11.2149 17.2718 11.222 17.7584 11.2125C18.155 11.2047 18.4575 10.8805 18.4528 10.4912C18.4481 10.112 18.1474 9.80027 17.7614 9.78954C17.4512 9.7806 17.141 9.78716 16.8308 9.78716C16.6496 9.78716 16.4685 9.78716 16.3377 9.78716C16.1636 9.13857 16.0008 8.53231 15.8315 7.9034C16.4211 7.56062 17.0386 7.20176 17.6572 6.8417C17.7022 6.89296 17.7341 6.9329 17.7703 6.96986C18.023 7.2262 18.3901 7.26435 18.6807 7.06584C18.9649 6.8715 19.0845 6.48819 18.9193 6.17761C18.676 5.71919 18.4161 5.26852 18.1426 4.82798C17.994 4.58774 17.7454 4.49176 17.4689 4.53647C17.1759 4.58357 16.9587 4.75406 16.8989 5.0551C16.8645 5.22858 16.8924 5.41457 16.8924 5.63692C16.3211 5.96837 15.7037 6.32664 15.2082 6.61398C14.7293 6.1335 14.2924 5.69534 13.8324 5.23335C14.0994 4.82023 14.4374 4.30518 14.7671 3.78535C15.0028 3.41397 14.9217 2.98714 14.5842 2.76479C14.2444 2.54064 13.8265 2.63841 13.5832 3.00264C13.4429 3.21248 13.3097 3.42649 13.1724 3.63811C12.9598 3.96598 12.7461 4.29325 12.5561 4.58476C11.9067 4.40652 11.291 4.23781 10.6612 4.06494V1.94094C10.7073 1.93319 10.7441 1.92902 10.7802 1.92007C11.1626 1.82291 11.3982 1.50159 11.3562 1.13557C11.3141 0.76955 11.0116 0.506658 10.6191 0.503677C10.1538 0.5001 9.68796 0.49712 9.22266 0.504869C8.85859 0.510831 8.56912 0.78028 8.52768 1.13199C8.48683 1.47596 8.6958 1.7925 9.03678 1.89921C9.09775 1.91829 9.1611 1.932 9.21852 1.9469V4.06494C8.578 4.24139 7.96234 4.41129 7.32892 4.58595C7.29873 4.54065 7.25315 4.47388 7.20934 4.40592C6.89855 3.92664 6.5925 3.44437 6.27697 2.96866C6.10411 2.70815 5.84956 2.60145 5.54647 2.66225C5.25285 2.72127 5.06696 2.91322 4.99593 3.2089C4.94324 3.42589 5.00658 3.61844 5.12498 3.80026C5.45945 4.31412 5.79096 4.82977 6.0532 5.23513C5.58199 5.70429 5.14392 6.14065 4.67152 6.61099C4.16834 6.3183 3.55209 5.95943 2.93998 5.60294C2.96248 5.52664 2.97846 5.47776 2.99148 5.42828C3.08324 5.08491 2.92518 4.74154 2.60788 4.5937C2.28999 4.44527 1.91763 4.53647 1.72938 4.84169C1.46121 5.27746 1.20193 5.71979 0.966319 6.17344C0.759126 6.57284 0.988223 7.04199 1.42037 7.16241C1.76608 7.25898 2.01649 7.09743 2.23079 6.8417C2.85829 7.20712 3.47513 7.56599 4.05053 7.90101C3.87886 8.54543 3.71725 9.15228 3.54854 9.78597C3.51124 9.78597 3.43902 9.78597 3.3668 9.78597C2.953 9.78597 2.53921 9.77941 2.12542 9.78835C1.73649 9.7967 1.43813 10.1055 1.43162 10.4864C1.4251 10.8757 1.72701 11.1988 2.12246 11.2113C2.41785 11.2208 2.71325 11.2137 3.00865 11.2137C3.2046 11.2137 3.40054 11.2137 3.54617 11.2137C3.72021 11.8617 3.883 12.4679 4.05231 13.098C3.46388 13.4402 2.84586 13.7991 2.22664 14.1586C2.17633 14.1019 2.14022 14.0554 2.09818 14.0149C1.84719 13.7693 1.46595 13.7419 1.18476 13.9463C0.914225 14.1437 0.802341 14.5204 0.962767 14.822C1.20666 15.2805 1.46536 15.7317 1.74004 16.1711C1.89395 16.4173 2.14673 16.515 2.43443 16.459C2.73752 16.4 2.9459 16.214 2.99503 15.9028C3.02049 15.7419 2.98319 15.5702 2.97254 15.3752C3.56215 15.0331 4.17959 14.6742 4.67507 14.3869C5.15339 14.8673 5.59027 15.3055 6.04965 15.7669C5.77852 16.1866 5.43695 16.707 5.10426 17.234C4.87871 17.5911 4.96692 18.0173 5.29784 18.2343C5.63467 18.4554 6.04965 18.3684 6.28703 18.0155C6.52679 17.6584 6.75529 17.2936 6.98912 16.9323C7.1087 16.7475 7.22947 16.5633 7.32655 16.4143C7.97595 16.5919 8.5922 16.7606 9.22621 16.9341C9.22621 16.9359 9.23095 16.9723 9.23095 17.0086C9.23095 17.6852 9.23095 18.3612 9.23095 19.0492C9.14511 19.0706 9.07999 19.0832 9.01665 19.104C8.68929 19.2107 8.48742 19.5237 8.52531 19.8617C8.56261 20.1937 8.83788 20.4793 9.17353 20.4888C9.68263 20.5037 10.1929 20.5037 10.7026 20.4888C11.0389 20.4793 11.3141 20.1979 11.3544 19.8653C11.3946 19.5314 11.1904 19.2119 10.8666 19.1046C10.7985 19.082 10.7287 19.0671 10.6641 19.0498V16.9317C11.3047 16.7559 11.9209 16.5866 12.5537 16.4125C12.5839 16.4572 12.6295 16.524 12.6733 16.5919C12.9841 17.0712 13.2902 17.5535 13.6063 18.0292C13.7785 18.2879 14.0313 18.3988 14.3362 18.3344C14.6393 18.2706 14.8559 18.0733 14.8802 17.7645C14.8956 17.5738 14.8346 17.3484 14.7358 17.1821C14.4279 16.6611 14.0864 16.1603 13.8306 15.7651C14.3036 15.2948 14.7417 14.8584 15.2141 14.3881C15.7149 14.6796 16.3312 15.0384 16.9439 15.3955C16.922 15.4647 16.9072 15.5058 16.8953 15.5481C16.7965 15.8939 16.9433 16.239 17.2541 16.394C17.5773 16.5556 17.9573 16.4685 18.1515 16.155C18.4203 15.7198 18.6807 15.2781 18.9146 14.8232C19.1253 14.4143 18.885 13.938 18.4386 13.8289L18.441 13.8319ZM6.95716 13.3073C6.17337 13.3073 5.53759 12.667 5.53759 11.8778C5.53759 11.0885 6.17337 10.4483 6.95716 10.4483C7.74094 10.4483 8.37672 11.0885 8.37672 11.8778C8.37672 12.667 7.74094 13.3073 6.95716 13.3073ZM10.1544 8.29684C9.5666 8.29684 9.09065 7.81696 9.09065 7.2256C9.09065 6.63424 9.56719 6.15436 10.1544 6.15436C10.7417 6.15436 11.2182 6.63424 11.2182 7.2256C11.2182 7.81696 10.7417 8.29684 10.1544 8.29684ZM12.2873 14.0214C11.6995 14.0214 11.2236 13.5416 11.2236 12.9502C11.2236 12.3588 11.7001 11.879 12.2873 11.879C12.8746 11.879 13.3511 12.3588 13.3511 12.9502C13.3511 13.5416 12.8746 14.0214 12.2873 14.0214Z"
                    fill="#E4002B" />
                </svg>
                <h1>COVID-19 Guidelines</h1>
                </li>
    
                <!-- hotels -->
                <li>
                <svg width="21" height="15" viewBox="0 0 21 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                    d="M6.44869 7.95443C6.98809 7.95443 7.51538 7.79446 7.96388 7.49476C8.41238 7.19506 8.76194 6.76909 8.96836 6.27071C9.17478 5.77233 9.22879 5.22392 9.12356 4.69484C9.01832 4.16577 8.75858 3.67978 8.37716 3.29833C7.99574 2.91689 7.50979 2.65712 6.98075 2.55188C6.45171 2.44664 5.90335 2.50065 5.405 2.70709C4.90666 2.91352 4.48072 3.26311 4.18104 3.71164C3.88137 4.16017 3.72141 4.6875 3.72141 5.22695C3.72141 5.95032 4.00875 6.64407 4.52021 7.15557C5.03168 7.66707 5.72537 7.95443 6.44869 7.95443V7.95443ZM17.3578 2.49947H10.085V8.86359H2.81232V0.681152H0.994141V14.3185H2.81232V11.5911H19.176V14.3185H20.9941V6.13611C20.9941 5.17161 20.611 4.24662 19.9291 3.56462C19.2471 2.88262 18.3222 2.49947 17.3578 2.49947Z"
                    fill="#E4002B" />
                </svg>
                <h1>Hotels</h1>
                </li>
    
                <!-- Finances -->
                <li>
                <svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                    d="M0.996094 19.1724C0.996094 15.2921 0.996094 11.4117 0.996094 7.53143C1.00755 7.50122 1.02214 7.47205 1.02995 7.4408C1.22631 6.65745 1.79924 6.19754 2.60812 6.19702C7.61293 6.19442 12.6178 6.19442 17.6226 6.19702C18.5794 6.19754 19.2362 6.86631 19.2382 7.82415C19.2403 8.63094 19.2388 9.43825 19.2382 10.245C19.2382 10.3013 19.2315 10.3581 19.2273 10.4284C19.144 10.4284 19.0736 10.4284 19.0033 10.4284C18.1637 10.4284 17.3241 10.4211 16.4845 10.4299C14.611 10.4492 13.2422 12.1769 13.648 14.0014C13.9397 15.3113 15.0892 16.2613 16.4319 16.2832C17.2908 16.2973 18.1502 16.2874 19.0091 16.2879C19.0789 16.2879 19.1487 16.2879 19.2158 16.2879C19.2268 16.3259 19.2367 16.3436 19.2367 16.3619C19.2367 17.2536 19.2575 18.1458 19.2278 19.0364C19.208 19.6344 18.8872 20.0771 18.3465 20.3432C18.209 20.4109 18.0559 20.4484 17.9106 20.5H2.32425C2.10654 20.4073 1.87372 20.3385 1.67424 20.2161C1.28829 19.9812 1.10599 19.5958 0.996094 19.1724Z"
                    fill="#E4002B" />
                    <path
                    d="M10.9961 0.5C11.5456 0.647921 11.6305 1.12606 11.7784 1.58909C11.5258 1.58909 11.2925 1.58336 11.0592 1.59013C10.0081 1.62034 9.1789 2.45786 9.16223 3.51049C9.15442 4.00478 9.16067 4.49906 9.16067 5.02408H8.944C7.245 5.02408 5.54599 5.02147 3.84699 5.02824C3.68553 5.02876 3.61834 4.97668 3.57251 4.83032C3.49282 4.57615 3.39021 4.32979 3.30167 4.07874C3.13395 3.60112 3.32719 3.18705 3.8022 3.01413C6.07413 2.18754 8.34607 1.36252 10.6175 0.536459C10.6409 0.528126 10.6618 0.511979 10.6836 0.5H10.9961Z"
                    fill="#E4002B" />
                    <path
                    d="M20.9973 14.6801C20.852 15.0145 20.5963 15.1264 20.2364 15.1223C18.9744 15.1077 17.7118 15.127 16.4498 15.1103C15.4888 15.0978 14.7362 14.2952 14.7482 13.3342C14.7596 12.3904 15.517 11.6185 16.4842 11.606C17.7853 11.5899 19.0869 11.6003 20.3885 11.6024C20.7036 11.6024 20.8879 11.7863 20.9978 12.0628V14.6801H20.9973ZM16.5107 13.9431C16.8316 13.9405 17.091 13.6795 17.0904 13.3603C17.0899 13.0457 16.8232 12.7769 16.5092 12.7738C16.1894 12.7707 15.9138 13.0498 15.9196 13.3717C15.9253 13.691 16.1883 13.9452 16.5107 13.9426V13.9431Z"
                    fill="#E4002B" />
                    <path
                    d="M17.1653 5.01464H10.3406C10.3406 4.47348 10.3166 3.94066 10.3489 3.41148C10.3718 3.03803 10.7078 2.76354 11.0864 2.7625C12.8636 2.75782 14.6407 2.75729 16.4173 2.7625C16.8168 2.76407 17.1481 3.07814 17.1611 3.47398C17.1778 3.98076 17.1653 4.48807 17.1653 5.01412V5.01464Z"
                    fill="#E4002B" />
                </svg>
                <h1>Finances</h1>
                </li>
    
                <!-- Flights   -->
                <li>
                <svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                    d="M13.2952 11.2135C11.868 12.3938 10.4774 13.5446 9.08619 14.6954C8.44009 15.2296 7.79784 15.769 7.14531 16.2955C7.00581 16.408 6.97495 16.509 7.01031 16.6851C7.19353 17.598 7.35618 18.5154 7.53362 19.4302C7.57026 19.6199 7.5529 19.7645 7.39282 19.9028C7.1736 20.0918 6.98138 20.3123 6.79687 20.5C4.86113 18.5649 2.94019 16.644 0.996094 14.7005C1.21725 14.4819 1.4609 14.2196 1.73091 13.9882C1.79906 13.9297 1.95464 13.9483 2.06393 13.9683C2.9974 14.138 3.9283 14.3199 4.86242 14.4864C4.94985 14.5019 5.08936 14.4665 5.14272 14.4029C6.84444 12.3572 8.53845 10.3057 10.2337 8.25428C10.2389 8.24785 10.2415 8.23885 10.2633 8.19385C7.56062 6.95308 4.85792 5.71295 2.11986 4.45611C2.40595 4.21117 2.66246 3.99001 2.91961 3.77014C3.2642 3.4757 3.60172 3.17162 3.95981 2.89389C4.05752 2.81803 4.22339 2.77624 4.34618 2.79553C5.22372 2.93761 6.09676 3.10411 6.9743 3.24683C7.06302 3.26098 7.19996 3.18962 7.2636 3.1144C7.76441 2.52616 8.3308 2.01956 9.06112 1.74698C9.33949 1.64283 9.66029 1.59526 9.95666 1.61326C10.3154 1.63447 10.5012 1.89549 10.5218 2.26C10.5481 2.72545 10.3591 3.12597 10.1412 3.51749C10.0962 3.59785 10.0467 3.67628 9.98173 3.78493C10.5783 3.89165 11.1473 3.99387 11.7169 4.09545C12.3566 4.20924 12.9969 4.31788 13.6353 4.43875C13.8076 4.47153 13.9381 4.44582 14.0808 4.33267C15.328 3.34391 16.5771 2.35836 17.8346 1.38375C18.3444 0.988371 18.9037 0.672071 19.5447 0.537707C20.518 0.333269 21.166 0.981942 20.961 1.95527C20.826 2.59559 20.5097 3.1549 20.1143 3.66471C19.1339 4.92863 18.138 6.18097 17.1564 7.44425C17.0869 7.53296 17.0368 7.67954 17.0548 7.7869C17.2521 8.9666 17.4643 10.1444 17.6745 11.3221C17.6848 11.3781 17.7067 11.4321 17.715 11.4584C18.086 11.308 18.4447 11.1537 18.8105 11.0193C18.9269 10.9769 19.0625 10.9737 19.1898 10.975C19.6527 10.9801 19.9201 11.2521 19.9163 11.7188C19.9118 12.264 19.6829 12.7384 19.364 13.1544C19.0696 13.5388 18.7205 13.8821 18.3804 14.2293C18.2756 14.336 18.2216 14.4131 18.2525 14.5758C18.4196 15.4488 18.5714 16.3244 18.7186 17.2007C18.7334 17.2894 18.7115 17.4135 18.6562 17.4797C18.1361 18.104 17.6057 18.7192 17.0439 19.3762C15.7902 16.6459 14.5501 13.9445 13.2958 11.2128L13.2952 11.2135Z"
                    fill="#E4002B" />
                </svg>
                <h1>Flights</h1>
                </li>
    
                <!-- Insurance -->
                <li>
                <svg width="20" height="21" viewBox="0 0 20 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                    d="M2.60094 0.5C5.74456 0.5 8.88871 0.5 12.0323 0.5C12.1011 0.5 12.1672 0.518749 12.2349 0.529166C13.2 0.657285 14.1937 1.53277 14.1729 2.93011C14.1546 4.1535 14.1692 5.37741 14.1692 6.6008C14.1692 6.73204 14.0854 6.8487 13.9609 6.89089C13.2224 7.14192 12.4906 7.39035 11.7542 7.64086C11.6745 7.66794 11.5876 7.63669 11.5412 7.56638C11.3396 7.25754 11.036 7.1638 10.66 7.16536C8.27154 7.17369 5.88258 7.16953 3.49413 7.16953C3.41601 7.16953 3.33789 7.16848 3.25977 7.17421C2.75197 7.21067 2.39574 7.7143 2.52854 8.20646C2.63635 8.60593 2.94624 8.82831 3.40716 8.82883C5.12532 8.82988 6.844 8.82935 8.56216 8.82935H8.56424C8.65226 8.82935 8.69653 8.93508 8.63559 8.99862C8.28613 9.36319 8.07468 9.76682 7.97572 10.2142C7.93458 10.4012 7.76167 10.5215 7.57053 10.5059C7.55647 10.5048 7.54241 10.5038 7.52834 10.5038C6.13361 10.4986 4.73887 10.4944 3.34362 10.5038C2.88738 10.5064 2.49678 10.8829 2.49938 11.3392C2.50198 11.7954 2.87593 12.1667 3.39361 12.1683C4.54565 12.1719 5.69769 12.1725 6.84973 12.1678C7.1419 12.1662 7.4346 12.1495 7.7325 12.1355C7.83406 12.1308 7.91895 12.2115 7.91947 12.3131C7.92052 12.8386 7.92625 13.3912 7.91739 13.9432C7.89552 15.3473 8.26634 16.641 8.98454 17.841C9.02568 17.9097 8.97568 17.9967 8.896 17.9967C6.62838 17.9972 4.38628 18.0092 2.14471 17.9884C1.46817 17.9821 0.915067 17.6483 0.486439 17.1196C0.354152 16.9561 0.256761 16.778 0.180201 16.591C0.0557269 16.2843 0 15.9535 0 15.6228C0 11.2459 0 6.86902 0 2.49211C0.0130203 2.44992 0.0302071 2.40826 0.0390609 2.36503C0.167181 1.74578 0.476023 1.23174 1.01454 0.902067C1.09944 0.849986 1.18849 0.805717 1.28068 0.765614C1.69629 0.585413 2.14731 0.5 2.60094 0.5ZM4.99147 5.4998C5.52478 5.4998 6.05757 5.50084 6.59088 5.4998C7.12263 5.49876 7.50022 5.15034 7.49918 4.66546C7.49866 4.18839 7.12524 3.8332 6.60755 3.83164C5.53467 3.82799 4.4618 3.82799 3.38945 3.83164C2.8728 3.83372 2.4999 4.19048 2.50042 4.66806C2.50094 5.14669 2.87593 5.49772 3.39205 5.4998C3.92536 5.50188 4.45815 5.4998 4.99147 5.4998Z"
                    fill="#E4002B" />
                    <path
                    d="M14.607 20.4985C13.379 19.9485 12.2785 19.2131 11.3514 18.233C10.4358 17.2648 9.80722 16.1466 9.63223 14.8065C9.59837 14.5493 9.58327 14.2878 9.58171 14.0285C9.57598 12.9743 9.57858 11.9202 9.57963 10.8661C9.57963 10.4343 9.85462 10.0505 10.2635 9.91195C11.6545 9.43957 13.0462 8.96824 14.4362 8.49117C14.6753 8.40889 14.9039 8.40576 15.1414 8.48701C16.5549 8.9698 17.9684 9.45259 19.3839 9.92966C19.5464 9.98434 19.6745 10.0687 19.7751 10.1781C19.9256 10.3421 20 10.5619 20 10.7843L19.9787 14.492L19.9714 14.5987C19.9704 14.6159 19.9714 14.6336 19.9693 14.6519C19.848 15.8544 19.3563 16.8987 18.5938 17.8194C17.6064 19.0126 16.3731 19.8787 14.9612 20.5001L14.607 20.499V20.4985ZM14.4878 14.6534C14.1492 14.3113 13.8378 13.9878 13.5164 13.6748C13.1675 13.3342 12.6545 13.3337 12.3274 13.6628C11.9972 13.9951 11.9988 14.5029 12.3431 14.8519C12.8868 15.4029 13.4336 15.9513 13.9852 16.494C14.3669 16.8695 14.9252 16.8382 15.2487 16.4117C16.0861 15.3086 16.9132 14.1977 17.7439 13.0889C17.8736 12.916 17.9355 12.7197 17.9111 12.5035C17.8704 12.1436 17.6376 11.8686 17.2934 11.7806C16.9335 11.6884 16.634 11.8009 16.4127 12.091C15.9273 12.7269 15.4518 13.3696 14.9716 14.0097C14.8164 14.2165 14.6607 14.4232 14.4872 14.6534H14.4878Z"
                    fill="#E4002B" />
                </svg>
                <h1>Insurance</h1>
                </li>
            </ul>
        </div>
    </section>

    {% if itineraries != None %}
    <div id="initForm" id="planner" class="device" style="position: absolute; z-index:20; background-color: white; display: none; bottom: -200vh;">
    {% else %}
    <div id="initForm" id="planner" class="device" style="position: absolute; z-index:20; background-color: white;">
    {% endif %}
        <!-- header -->
        <div class="explorerheader">
            <svg width="12" height="20" onclick="closeInitPage();">
            <path
                d="M10.2642 0C10.8582 0.203504 11.2215 0.68581 11.6052 1.12894C11.9081 1.47897 11.8687 2.05183 11.5761 2.4156C11.5052 2.50072 11.4295 2.58174 11.3494 2.65828C8.94914 5.0464 6.54751 7.43334 4.14452 9.81909C4.0819 9.87251 4.01519 9.92099 3.94498 9.96409C4.03554 10.0582 4.08722 10.1167 4.14145 10.1676C6.56048 12.5737 8.9795 14.9796 11.3985 17.3854C11.8298 17.8148 11.9613 18.3439 11.6385 18.7738C11.3346 19.1709 10.9778 19.5251 10.5779 19.8264C10.2074 20.1093 9.70807 20.0259 9.34174 19.7247C9.28648 19.6794 9.23276 19.6311 9.18211 19.5807L0.412125 10.8636C-0.0248138 10.4296 -0.119978 9.92084 0.153748 9.45024C0.222198 9.33957 0.304744 9.23817 0.399334 9.14854C3.33272 6.23165 6.26697 3.31661 9.20206 0.403448C9.37602 0.231995 9.61905 0.132787 9.8324 0H10.2642Z"
                fill="#2B2B2B" />
            </svg>
            <h1>Plan a Trip</h1>
            &nbsp
        </div>

        <section class="plannerinput">
            <p id="start-latlng" hidden></p>

            <h1>Where To?</h1>
            <input type="text" class="Username" name="Username" value="Local" placeholder="City or State" readonly>
        
            <h1>Start & End Date</h1>
            <div class="startend">
                <input type="date" id="startDate" class="plannerdate inputstartdate" value="{% if itineraries != None %}{{itineraries[0].getDate().strftime('%Y-%m-%d')}}{% endif %}" onchange="checkResetEndDate(); checkInitPage();" placeholder="Start">
                <input type="date" id="endDate" class="plannerdate inputenddate" value="{% if itineraries != None %}{{itineraries[-1].getDate().strftime('%Y-%m-%d')}}{% endif %}" onchange="checkInitPage();" placeholder="End">
            </div>
        
            <h1>Add a Description</h1>
            <input type="text" class="describetrip" id="description" value="" placeholder="Describe your trip">
        
            <div class="plannerbanner">
                <img src="../../static/images/buffcar.png" alt="">
        
            </div>
        </section>

        <section class="bottom">
            <div class="maincta-disabled" id="initPageNext">
              <h1>Create Trip!</h1>
            </div>
          </section>
    </div>

    <!-- plannerdates -->
    <section class="plannerdates" id="dates-selection" style="overflow-x: auto;">
        <ul>
            {% if itineraries != None %}
            {% for i in range(itineraries|length) %}
            {% set itinerary = itineraries[i] %}
            <li class="inactivedate card-date" onclick="toggleDay(this);">
                <h1>{{itinerary.getDate().strftime("%d/%m")}}<span hidden>{{itinerary.getDate().strftime("%Y-%m-%d")}}</span></h1>
                
                <p class="tm-selection">
                    {% if itinerary.getTransportMode() == "drive" %}
                    <a data-toggle="collapse" href="#tmdropdown-{{i+1}}"><svg width="36" height="19" viewBox="0 0 36 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.7709 2.05692C17.6584 1.72085 17.4456 1.42933 17.1626 1.22344C16.8795 1.01754 16.5405 0.907635 16.1931 0.909196H3.97092C3.62382 0.908654 3.28521 1.01896 3.00236 1.22471C2.71951 1.43047 2.50653 1.72141 2.39314 2.05692L0.0820312 8.86373V17.9546C0.0820313 18.256 0.199094 18.5451 0.407468 18.7582C0.615842 18.9713 0.898457 19.091 1.19314 19.091H2.30425C2.59894 19.091 2.88155 18.9713 3.08993 18.7582C3.2983 18.5451 3.41536 18.256 3.41536 17.9546V16.8183H16.7487V17.9546C16.7487 18.256 16.8658 18.5451 17.0741 18.7582C17.2825 18.9713 17.5651 19.091 17.8598 19.091H18.9709C19.2656 19.091 19.5482 18.9713 19.7566 18.7582C19.965 18.5451 20.082 18.256 20.082 17.9546V8.86373L17.7709 2.05692ZM3.97092 13.4092C3.64128 13.4092 3.31905 13.3092 3.04497 13.1219C2.77089 12.9346 2.55727 12.6684 2.43112 12.3569C2.30497 12.0455 2.27197 11.7027 2.33628 11.3721C2.40059 11.0415 2.55932 10.7377 2.79241 10.4993C3.0255 10.261 3.32247 10.0986 3.64577 10.0328C3.96907 9.96708 4.30418 10.0008 4.60873 10.1298C4.91327 10.2589 5.17357 10.4773 5.3567 10.7576C5.53984 11.038 5.63759 11.3675 5.63759 11.7046C5.63759 12.1567 5.46199 12.5903 5.14943 12.9099C4.83687 13.2296 4.41295 13.4092 3.97092 13.4092ZM16.1931 13.4092C15.8635 13.4092 15.5413 13.3092 15.2672 13.1219C14.9931 12.9346 14.7795 12.6684 14.6533 12.3569C14.5272 12.0455 14.4942 11.7027 14.5585 11.3721C14.6228 11.0415 14.7815 10.7377 15.0146 10.4993C15.2477 10.261 15.5447 10.0986 15.868 10.0328C16.1913 9.96708 16.5264 10.0008 16.8309 10.1298C17.1355 10.2589 17.3958 10.4773 17.5789 10.7576C17.7621 11.038 17.8598 11.3675 17.8598 11.7046C17.8598 12.1567 17.6842 12.5903 17.3717 12.9099C17.0591 13.2296 16.6352 13.4092 16.1931 13.4092ZM2.30425 7.72737L3.97092 2.61374H16.1931L17.8598 7.72737H2.30425Z" 
                        fill="white"/>
                        <path
                            d="M25.168 9.30594C25.2697 8.9918 25.5109 8.79969 25.7324 8.59675C25.9075 8.43657 26.1939 8.45741 26.3758 8.61218C26.4183 8.64964 26.4588 8.68966 26.4971 8.73204C27.6912 10.0014 28.8846 11.2715 30.0775 12.5423C30.1042 12.5754 30.1285 12.6107 30.15 12.6478C30.1971 12.5999 30.2263 12.5726 30.2518 12.5439C31.4548 11.2646 32.6578 9.98536 33.8607 8.70607C34.0754 8.47797 34.3399 8.40843 34.5549 8.57917C34.7534 8.73985 34.9305 8.92855 35.0812 9.14007C35.2226 9.33597 35.1809 9.60006 35.0303 9.79379C35.0077 9.82301 34.9835 9.85142 34.9583 9.87821L30.5998 14.5162C30.3828 14.7473 30.1284 14.7976 29.8931 14.6528C29.8378 14.6166 29.7871 14.573 29.7422 14.5229C28.2838 12.9716 26.8263 11.4199 25.3697 9.86766C25.284 9.77566 25.2344 9.64714 25.168 9.53431L25.168 9.30594Z"
                            fill="white" />
                    </svg></a>
                    {% elif itinerary.getTransportMode() == "pt" %}
                    <a data-toggle="collapse" href="#tmdropdown-{{i+1}}"><svg width="36" height="19" viewBox="0 0 36 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0.0820312 18.125C0.0820313 19.2853 0.542968 20.3981 1.36344 21.2186C2.18391 22.0391 3.29671 22.5 4.45703 22.5L2.58203 24.375V25H17.582V24.375L15.707 22.5C16.8674 22.5 17.9802 22.0391 18.8006 21.2186C19.6211 20.3981 20.082 19.2853 20.082 18.125V5C20.082 0.625 15.607 0 10.082 0C4.55703 0 0.0820312 0.625 0.0820312 5V18.125ZM10.082 20C9.58758 20 9.10423 19.8534 8.69311 19.5787C8.28198 19.304 7.96155 18.9135 7.77233 18.4567C7.58311 17.9999 7.5336 17.4972 7.63007 17.0123C7.72653 16.5273 7.96463 16.0819 8.31426 15.7322C8.6639 15.3826 9.10935 15.1445 9.59431 15.048C10.0793 14.9516 10.5819 15.0011 11.0387 15.1903C11.4956 15.3795 11.886 15.7 12.1607 16.1111C12.4354 16.5222 12.582 17.0055 12.582 17.5C12.5801 18.1624 12.316 18.7972 11.8476 19.2656C11.3792 19.734 10.7445 19.998 10.082 20ZM17.582 11.25H2.58203V5H17.582V11.25Z"
                            fill="white" />
                        <path
                            d="M25.168 9.30594C25.2697 8.9918 25.5109 8.79969 25.7324 8.59675C25.9075 8.43657 26.1939 8.45741 26.3758 8.61218C26.4183 8.64964 26.4588 8.68966 26.4971 8.73204C27.6912 10.0014 28.8846 11.2715 30.0775 12.5423C30.1042 12.5754 30.1285 12.6107 30.15 12.6478C30.1971 12.5999 30.2263 12.5726 30.2518 12.5439C31.4548 11.2646 32.6578 9.98536 33.8607 8.70607C34.0754 8.47797 34.3399 8.40843 34.5549 8.57917C34.7534 8.73985 34.9305 8.92855 35.0812 9.14007C35.2226 9.33597 35.1809 9.60006 35.0303 9.79379C35.0077 9.82301 34.9835 9.85142 34.9583 9.87821L30.5998 14.5162C30.3828 14.7473 30.1284 14.7976 29.8931 14.6528C29.8378 14.6166 29.7871 14.573 29.7422 14.5229C28.2838 12.9716 26.8263 11.4199 25.3697 9.86766C25.284 9.77566 25.2344 9.64714 25.168 9.53431L25.168 9.30594Z"
                            fill="white" />
                    </svg></a>
                    {% elif itinerary.getTransportMode() == "bus" %}
                    <a data-toggle="collapse" href="#tmdropdown-{{i+1}}"><svg width="36" height="19" viewBox="0 0 36 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M16.1119 23.5294C15.2677 23.1777 15.0851 22.9022 15.0851 21.9814C15.0851 21.6783 15.0851 21.3745 15.0851 21.07H5.08093C5.08093 21.4784 5.07946 21.8673 5.08093 22.2568C5.08239 22.5664 5.01418 22.8702 4.78241 23.0744C4.57118 23.2612 4.29908 23.3804 4.05411 23.5294H2.33858C1.53473 23.2641 1.28243 22.6776 1.32643 21.8876C1.3565 21.3454 1.33743 20.8011 1.32717 20.2575C1.3257 20.1623 1.28389 20.0431 1.21788 19.9784C0.449234 19.2189 0.0832465 18.2981 0.082513 17.2304C0.0817796 13.1656 0.0817796 9.10071 0.0832465 5.03585C0.0832465 4.25384 0.202798 3.49509 0.587855 2.79811C1.14601 1.78498 2.06281 1.2181 3.11383 0.827091C4.34748 0.368495 5.64054 0.189708 6.9446 0.108309C9.33783 -0.0406804 11.7325 -0.0566694 14.1206 0.192615C15.3528 0.321254 16.5637 0.552369 17.6895 1.09818C18.4318 1.45793 19.0655 1.94487 19.4982 2.65857C19.9419 3.39043 20.0813 4.19715 20.082 5.03585C20.082 9.10071 20.082 13.1656 20.082 17.2312C20.082 18.3003 19.716 19.2189 18.9489 19.9784C18.8829 20.0438 18.841 20.163 18.8396 20.2575C18.83 20.9007 18.8352 21.5431 18.8344 22.1863C18.8337 22.7387 18.61 23.1617 18.0981 23.4131C18.0101 23.456 17.9184 23.4909 17.8282 23.5294H16.1119ZM2.59235 4.97699V11.1328H17.5744V4.97699H2.59235ZM4.46483 18.5713C5.49679 18.5684 6.33365 17.7348 6.32998 16.7137C6.32558 15.694 5.47625 14.8561 4.4553 14.8641C3.42701 14.872 2.57915 15.7166 2.58649 16.7246C2.59382 17.745 3.43801 18.575 4.46557 18.5713H4.46483ZM15.7034 18.5713C16.7302 18.5735 17.5751 17.7421 17.581 16.7231C17.5869 15.7137 16.739 14.8706 15.7114 14.8641C14.6898 14.8575 13.8404 15.6962 13.8375 16.7152C13.8338 17.7355 14.6722 18.5692 15.7034 18.5713Z"
                            fill="white" />
                        <path
                            d="M16.1119 23.5294C15.2677 23.1777 15.0851 22.9022 15.0851 21.9814C15.0851 21.6783 15.0851 21.3745 15.0851 21.07H5.08093C5.08093 21.4784 5.07946 21.8673 5.08093 22.2568C5.08239 22.5664 5.01418 22.8702 4.78241 23.0744C4.57118 23.2612 4.29908 23.3804 4.05411 23.5294H2.33858C1.53473 23.2641 1.28243 22.6776 1.32643 21.8876C1.3565 21.3454 1.33743 20.8011 1.32717 20.2575C1.3257 20.1623 1.28389 20.0431 1.21788 19.9784C0.449234 19.2189 0.0832465 18.2981 0.082513 17.2304C0.0817796 13.1656 0.0817796 9.10071 0.0832465 5.03585C0.0832465 4.25384 0.202798 3.49509 0.587855 2.79811C1.14601 1.78498 2.06281 1.2181 3.11383 0.827091C4.34748 0.368495 5.64054 0.189708 6.9446 0.108309C9.33783 -0.0406804 11.7325 -0.0566694 14.1206 0.192615C15.3528 0.321254 16.5637 0.552369 17.6895 1.09818C18.4318 1.45793 19.0655 1.94487 19.4982 2.65857C19.9419 3.39043 20.0813 4.19715 20.082 5.03585C20.082 9.10071 20.082 13.1656 20.082 17.2312C20.082 18.3003 19.716 19.2189 18.9489 19.9784C18.8829 20.0438 18.841 20.163 18.8396 20.2575C18.83 20.9007 18.8352 21.5431 18.8344 22.1863C18.8337 22.7387 18.61 23.1617 18.0981 23.4131C18.0101 23.456 17.9184 23.4909 17.8282 23.5294H16.1119ZM2.59235 4.97699V11.1328H17.5744V4.97699H2.59235ZM4.46483 18.5713C5.49679 18.5684 6.33365 17.7348 6.32998 16.7137C6.32558 15.694 5.47625 14.8561 4.4553 14.8641C3.42701 14.872 2.57915 15.7166 2.58649 16.7246C2.59382 17.745 3.43801 18.575 4.46557 18.5713H4.46483ZM15.7034 18.5713C16.7302 18.5735 17.5751 17.7421 17.581 16.7231C17.5869 15.7137 16.739 14.8706 15.7114 14.8641C14.6898 14.8575 13.8404 15.6962 13.8375 16.7152C13.8338 17.7355 14.6722 18.5692 15.7034 18.5713Z"
                            fill="white" />
                    </svg></a>
                    {% elif itinerary.getTransportMode() == "walk" %}
                    <a data-toggle="collapse" href="#tmdropdown-{{i+1}}"><svg width="36" height="19" viewBox="0 0 36 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M11.7746 4.46512C12.1923 4.46512 12.6005 4.33418 12.9478 4.08886C13.2951 3.84355 13.5658 3.49487 13.7256 3.08692C13.8855 2.67898 13.9273 2.23008 13.8458 1.79701C13.7643 1.36393 13.5632 0.966131 13.2678 0.653902C12.9725 0.341673 12.5962 0.129043 12.1866 0.042899C11.7769 -0.0432448 11.3523 0.000967325 10.9664 0.169944C10.5805 0.338921 10.2507 0.625074 10.0187 0.992216C9.78663 1.35936 9.66278 1.791 9.66278 2.23256C9.66445 2.82413 9.88748 3.39096 10.2832 3.80926C10.6788 4.22757 11.215 4.46335 11.7746 4.46512V4.46512ZM7.97334 19.9814L9.02924 15.0698L11.2466 17.3023V24H13.3584V15.6279L11.141 13.3954L11.7746 10.0465C12.4991 10.9217 13.3919 11.6234 14.3933 12.1046C15.3948 12.5859 16.4819 12.8356 17.582 12.8372V10.6047C16.6693 10.6193 15.769 10.3794 14.9719 9.90902C14.1748 9.43868 13.509 8.75456 13.0417 7.92558L11.9858 6.13954C11.7986 5.80975 11.5362 5.53479 11.2227 5.33979C10.9091 5.1448 10.5543 5.03597 10.1907 5.02326C9.87396 5.02326 9.66278 5.13488 9.34601 5.13488L3.85532 7.5907V12.8372H5.96712V9.04186L7.86774 8.26047L6.1783 17.3023L1.00439 16.186L0.582031 18.4186L7.97334 19.9814Z"
                            fill="white" />
                        <path
                            d="M11.7746 4.46512C12.1923 4.46512 12.6005 4.33418 12.9478 4.08886C13.2951 3.84355 13.5658 3.49487 13.7256 3.08692C13.8855 2.67898 13.9273 2.23008 13.8458 1.79701C13.7643 1.36393 13.5632 0.966131 13.2678 0.653902C12.9725 0.341673 12.5962 0.129043 12.1866 0.042899C11.7769 -0.0432448 11.3523 0.000967325 10.9664 0.169944C10.5805 0.338921 10.2507 0.625074 10.0187 0.992216C9.78663 1.35936 9.66278 1.791 9.66278 2.23256C9.66445 2.82413 9.88748 3.39096 10.2832 3.80926C10.6788 4.22757 11.215 4.46335 11.7746 4.46512V4.46512ZM7.97334 19.9814L9.02924 15.0698L11.2466 17.3023V24H13.3584V15.6279L11.141 13.3954L11.7746 10.0465C12.4991 10.9217 13.3919 11.6234 14.3933 12.1046C15.3948 12.5859 16.4819 12.8356 17.582 12.8372V10.6047C16.6693 10.6193 15.769 10.3794 14.9719 9.90902C14.1748 9.43868 13.509 8.75456 13.0417 7.92558L11.9858 6.13954C11.7986 5.80975 11.5362 5.53479 11.2227 5.33979C10.9091 5.1448 10.5543 5.03597 10.1907 5.02326C9.87396 5.02326 9.66278 5.13488 9.34601 5.13488L3.85532 7.5907V12.8372H5.96712V9.04186L7.86774 8.26047L6.1783 17.3023L1.00439 16.186L0.582031 18.4186L7.97334 19.9814Z"
                            fill="white" />
                    </svg></a>
                    {% elif itinerary.getTransportMode() == "cycle" %}
                    <a data-toggle="collapse" href="#tmdropdown-{{i+1}}"><svg width="36" height="19" viewBox="0 0 36 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M15.4969 3.90244C15.8829 3.90244 16.2601 3.788 16.581 3.5736C16.9019 3.3592 17.152 3.05446 17.2996 2.69792C17.4473 2.34138 17.486 1.94906 17.4107 1.57056C17.3354 1.19206 17.1496 0.844382 16.8767 0.5715C16.6038 0.298617 16.2561 0.112781 15.8776 0.037493C15.4991 -0.0377952 15.1068 0.000845426 14.7502 0.148529C14.3937 0.296212 14.089 0.546304 13.8746 0.867181C13.6602 1.18806 13.5457 1.56531 13.5457 1.95122C13.5473 2.46824 13.7533 2.96364 14.1189 3.32923C14.4845 3.69483 14.9799 3.9009 15.4969 3.90244V3.90244ZM5.25305 10.2439C3.95931 10.2439 2.71856 10.7578 1.80375 11.6726C0.888936 12.5875 0.375 13.8282 0.375 15.1219C0.375 16.4157 0.888936 17.6564 1.80375 18.5712C2.71856 19.4861 3.95931 20 5.25305 20C6.54679 20 7.78754 19.4861 8.70235 18.5712C9.61716 17.6564 10.1311 16.4157 10.1311 15.1219C10.1311 13.8282 9.61716 12.5875 8.70235 11.6726C7.78754 10.7578 6.54679 10.2439 5.25305 10.2439ZM5.25305 18.5366C4.34743 18.5366 3.47891 18.1768 2.83854 17.5365C2.19817 16.8961 1.83841 16.0276 1.83841 15.1219C1.83841 14.2163 2.19817 13.3478 2.83854 12.7074C3.47891 12.0671 4.34743 11.7073 5.25305 11.7073C6.15866 11.7073 7.02719 12.0671 7.66756 12.7074C8.30793 13.3478 8.66768 14.2163 8.66768 15.1219C8.66768 16.0276 8.30793 16.8961 7.66756 17.5365C7.02719 18.1768 6.15866 18.5366 5.25305 18.5366ZM10.9116 8.78049L13.253 6.43902L14.0335 7.21951C14.6811 7.87989 15.456 8.40196 16.3112 8.75412C17.1665 9.10628 18.0843 9.2812 19.0091 9.26829V7.31707C18.3553 7.32268 17.707 7.19592 17.1034 6.94442C16.4998 6.69292 15.9534 6.32189 15.4969 5.85366L13.6433 4C13.21 3.62402 12.656 3.41627 12.0823 3.41463C11.8246 3.39755 11.5665 3.44168 11.3291 3.54341C11.0918 3.64515 10.8818 3.80161 10.7165 4L7.98475 6.73171C7.80159 6.90926 7.65552 7.12143 7.55503 7.3559C7.45454 7.59037 7.40164 7.84247 7.39939 8.09756C7.3823 8.35526 7.42643 8.61335 7.52817 8.85073C7.6299 9.08812 7.78636 9.29806 7.98475 9.46341L11.1067 12.1951V17.0732H13.0579V11.0244L10.9116 8.78049ZM18.9116 10.2439C17.9468 10.2439 17.0037 10.53 16.2015 11.066C15.3993 11.602 14.7741 12.3639 14.4049 13.2552C14.0356 14.1465 13.939 15.1274 14.1273 16.0736C14.3155 17.0199 14.7801 17.889 15.4623 18.5712C16.1445 19.2535 17.0137 19.718 17.9599 19.9063C18.9062 20.0945 19.887 19.9979 20.7783 19.6287C21.6697 19.2595 22.4315 18.6342 22.9675 17.832C23.5035 17.0299 23.7896 16.0867 23.7896 15.1219C23.796 14.4796 23.6742 13.8424 23.4313 13.2477C23.1884 12.653 22.8294 12.1127 22.3751 11.6584C21.9209 11.2042 21.3806 10.8451 20.7859 10.6022C20.1911 10.3593 19.554 10.2375 18.9116 10.2439V10.2439ZM18.9116 18.5366C18.2362 18.5366 17.576 18.3363 17.0145 17.9611C16.453 17.5859 16.0153 17.0526 15.7569 16.4287C15.4984 15.8047 15.4308 15.1182 15.5626 14.4558C15.6943 13.7934 16.0195 13.185 16.4971 12.7074C16.9746 12.2299 17.583 11.9047 18.2454 11.7729C18.9078 11.6412 19.5944 11.7088 20.2183 11.9672C20.8422 12.2257 21.3755 12.6633 21.7507 13.2249C22.1259 13.7864 22.3262 14.4466 22.3262 15.1219C22.3153 16.0242 21.9521 16.8864 21.3141 17.5244C20.676 18.1624 19.8138 18.5257 18.9116 18.5366V18.5366Z"
                            fill="white" />
                        <path
                            d="M15.4969 3.90244C15.8829 3.90244 16.2601 3.788 16.581 3.5736C16.9019 3.3592 17.152 3.05446 17.2996 2.69792C17.4473 2.34138 17.486 1.94906 17.4107 1.57056C17.3354 1.19206 17.1496 0.844382 16.8767 0.5715C16.6038 0.298617 16.2561 0.112781 15.8776 0.037493C15.4991 -0.0377952 15.1068 0.000845426 14.7502 0.148529C14.3937 0.296212 14.089 0.546304 13.8746 0.867181C13.6602 1.18806 13.5457 1.56531 13.5457 1.95122C13.5473 2.46824 13.7533 2.96364 14.1189 3.32923C14.4845 3.69483 14.9799 3.9009 15.4969 3.90244V3.90244ZM5.25305 10.2439C3.95931 10.2439 2.71856 10.7578 1.80375 11.6726C0.888936 12.5875 0.375 13.8282 0.375 15.1219C0.375 16.4157 0.888936 17.6564 1.80375 18.5712C2.71856 19.4861 3.95931 20 5.25305 20C6.54679 20 7.78754 19.4861 8.70235 18.5712C9.61716 17.6564 10.1311 16.4157 10.1311 15.1219C10.1311 13.8282 9.61716 12.5875 8.70235 11.6726C7.78754 10.7578 6.54679 10.2439 5.25305 10.2439ZM5.25305 18.5366C4.34743 18.5366 3.47891 18.1768 2.83854 17.5365C2.19817 16.8961 1.83841 16.0276 1.83841 15.1219C1.83841 14.2163 2.19817 13.3478 2.83854 12.7074C3.47891 12.0671 4.34743 11.7073 5.25305 11.7073C6.15866 11.7073 7.02719 12.0671 7.66756 12.7074C8.30793 13.3478 8.66768 14.2163 8.66768 15.1219C8.66768 16.0276 8.30793 16.8961 7.66756 17.5365C7.02719 18.1768 6.15866 18.5366 5.25305 18.5366ZM10.9116 8.78049L13.253 6.43902L14.0335 7.21951C14.6811 7.87989 15.456 8.40196 16.3112 8.75412C17.1665 9.10628 18.0843 9.2812 19.0091 9.26829V7.31707C18.3553 7.32268 17.707 7.19592 17.1034 6.94442C16.4998 6.69292 15.9534 6.32189 15.4969 5.85366L13.6433 4C13.21 3.62402 12.656 3.41627 12.0823 3.41463C11.8246 3.39755 11.5665 3.44168 11.3291 3.54341C11.0918 3.64515 10.8818 3.80161 10.7165 4L7.98475 6.73171C7.80159 6.90926 7.65552 7.12143 7.55503 7.3559C7.45454 7.59037 7.40164 7.84247 7.39939 8.09756C7.3823 8.35526 7.42643 8.61335 7.52817 8.85073C7.6299 9.08812 7.78636 9.29806 7.98475 9.46341L11.1067 12.1951V17.0732H13.0579V11.0244L10.9116 8.78049ZM18.9116 10.2439C17.9468 10.2439 17.0037 10.53 16.2015 11.066C15.3993 11.602 14.7741 12.3639 14.4049 13.2552C14.0356 14.1465 13.939 15.1274 14.1273 16.0736C14.3155 17.0199 14.7801 17.889 15.4623 18.5712C16.1445 19.2535 17.0137 19.718 17.9599 19.9063C18.9062 20.0945 19.887 19.9979 20.7783 19.6287C21.6697 19.2595 22.4315 18.6342 22.9675 17.832C23.5035 17.0299 23.7896 16.0867 23.7896 15.1219C23.796 14.4796 23.6742 13.8424 23.4313 13.2477C23.1884 12.653 22.8294 12.1127 22.3751 11.6584C21.9209 11.2042 21.3806 10.8451 20.7859 10.6022C20.1911 10.3593 19.554 10.2375 18.9116 10.2439V10.2439ZM18.9116 18.5366C18.2362 18.5366 17.576 18.3363 17.0145 17.9611C16.453 17.5859 16.0153 17.0526 15.7569 16.4287C15.4984 15.8047 15.4308 15.1182 15.5626 14.4558C15.6943 13.7934 16.0195 13.185 16.4971 12.7074C16.9746 12.2299 17.583 11.9047 18.2454 11.7729C18.9078 11.6412 19.5944 11.7088 20.2183 11.9672C20.8422 12.2257 21.3755 12.6633 21.7507 13.2249C22.1259 13.7864 22.3262 14.4466 22.3262 15.1219C22.3153 16.0242 21.9521 16.8864 21.3141 17.5244C20.676 18.1624 19.8138 18.5257 18.9116 18.5366V18.5366Z"
                            fill="white" />
                    </svg></a>
                    {% endif %}
                    <span hidden>{{itinerary.getTransportMode()}}</span>
                </p>
                
                <ul id="tmdropdown-{{i+1}}" class="plannerdatestransport tm-dropdown collapse">
                    <li onclick="chooseTransportMode(this);">
                        <svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.7709 2.05692C17.6584 1.72085 17.4456 1.42933 17.1626 1.22344C16.8795 1.01754 16.5405 0.907635 16.1931 0.909196H3.97092C3.62382 0.908654 3.28521 1.01896 3.00236 1.22471C2.71951 1.43047 2.50653 1.72141 2.39314 2.05692L0.0820312 8.86373V17.9546C0.0820313 18.256 0.199094 18.5451 0.407468 18.7582C0.615842 18.9713 0.898457 19.091 1.19314 19.091H2.30425C2.59894 19.091 2.88155 18.9713 3.08993 18.7582C3.2983 18.5451 3.41536 18.256 3.41536 17.9546V16.8183H16.7487V17.9546C16.7487 18.256 16.8658 18.5451 17.0741 18.7582C17.2825 18.9713 17.5651 19.091 17.8598 19.091H18.9709C19.2656 19.091 19.5482 18.9713 19.7566 18.7582C19.965 18.5451 20.082 18.256 20.082 17.9546V8.86373L17.7709 2.05692ZM3.97092 13.4092C3.64128 13.4092 3.31905 13.3092 3.04497 13.1219C2.77089 12.9346 2.55727 12.6684 2.43112 12.3569C2.30497 12.0455 2.27197 11.7027 2.33628 11.3721C2.40059 11.0415 2.55932 10.7377 2.79241 10.4993C3.0255 10.261 3.32247 10.0986 3.64577 10.0328C3.96907 9.96708 4.30418 10.0008 4.60873 10.1298C4.91327 10.2589 5.17357 10.4773 5.3567 10.7576C5.53984 11.038 5.63759 11.3675 5.63759 11.7046C5.63759 12.1567 5.46199 12.5903 5.14943 12.9099C4.83687 13.2296 4.41295 13.4092 3.97092 13.4092ZM16.1931 13.4092C15.8635 13.4092 15.5413 13.3092 15.2672 13.1219C14.9931 12.9346 14.7795 12.6684 14.6533 12.3569C14.5272 12.0455 14.4942 11.7027 14.5585 11.3721C14.6228 11.0415 14.7815 10.7377 15.0146 10.4993C15.2477 10.261 15.5447 10.0986 15.868 10.0328C16.1913 9.96708 16.5264 10.0008 16.8309 10.1298C17.1355 10.2589 17.3958 10.4773 17.5789 10.7576C17.7621 11.038 17.8598 11.3675 17.8598 11.7046C17.8598 12.1567 17.6842 12.5903 17.3717 12.9099C17.0591 13.2296 16.6352 13.4092 16.1931 13.4092ZM2.30425 7.72737L3.97092 2.61374H16.1931L17.8598 7.72737H2.30425Z" 
                            fill="#BBBBBB"/>
                        </svg>
                        <span hidden>drive</span></li>
                    <li onclick="chooseTransportMode(this);">
                        <svg width="21" height="25" viewBox="0 0 21 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M0.0820312 18.125C0.0820313 19.2853 0.542968 20.3981 1.36344 21.2186C2.18391 22.0391 3.29671 22.5 4.45703 22.5L2.58203 24.375V25H17.582V24.375L15.707 22.5C16.8674 22.5 17.9802 22.0391 18.8006 21.2186C19.6211 20.3981 20.082 19.2853 20.082 18.125V5C20.082 0.625 15.607 0 10.082 0C4.55703 0 0.0820312 0.625 0.0820312 5V18.125ZM10.082 20C9.58758 20 9.10423 19.8534 8.69311 19.5787C8.28198 19.304 7.96155 18.9135 7.77233 18.4567C7.58311 17.9999 7.5336 17.4972 7.63007 17.0123C7.72653 16.5273 7.96463 16.0819 8.31426 15.7322C8.6639 15.3826 9.10935 15.1445 9.59431 15.048C10.0793 14.9516 10.5819 15.0011 11.0387 15.1903C11.4956 15.3795 11.886 15.7 12.1607 16.1111C12.4354 16.5222 12.582 17.0055 12.582 17.5C12.5801 18.1624 12.316 18.7972 11.8476 19.2656C11.3792 19.734 10.7445 19.998 10.082 20ZM17.582 11.25H2.58203V5H17.582V11.25Z"
                            fill="#BBBBBB" />
                        </svg>
                        <span hidden>pt</span></li>
                    <li onclick="chooseTransportMode(this);">
                        <svg width="18" height="24" viewBox="0 0 18 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                            d="M16.1119 23.5294C15.2677 23.1777 15.0851 22.9022 15.0851 21.9814C15.0851 21.6783 15.0851 21.3745 15.0851 21.07H5.08093C5.08093 21.4784 5.07946 21.8673 5.08093 22.2568C5.08239 22.5664 5.01418 22.8702 4.78241 23.0744C4.57118 23.2612 4.29908 23.3804 4.05411 23.5294H2.33858C1.53473 23.2641 1.28243 22.6776 1.32643 21.8876C1.3565 21.3454 1.33743 20.8011 1.32717 20.2575C1.3257 20.1623 1.28389 20.0431 1.21788 19.9784C0.449234 19.2189 0.0832465 18.2981 0.082513 17.2304C0.0817796 13.1656 0.0817796 9.10071 0.0832465 5.03585C0.0832465 4.25384 0.202798 3.49509 0.587855 2.79811C1.14601 1.78498 2.06281 1.2181 3.11383 0.827091C4.34748 0.368495 5.64054 0.189708 6.9446 0.108309C9.33783 -0.0406804 11.7325 -0.0566694 14.1206 0.192615C15.3528 0.321254 16.5637 0.552369 17.6895 1.09818C18.4318 1.45793 19.0655 1.94487 19.4982 2.65857C19.9419 3.39043 20.0813 4.19715 20.082 5.03585C20.082 9.10071 20.082 13.1656 20.082 17.2312C20.082 18.3003 19.716 19.2189 18.9489 19.9784C18.8829 20.0438 18.841 20.163 18.8396 20.2575C18.83 20.9007 18.8352 21.5431 18.8344 22.1863C18.8337 22.7387 18.61 23.1617 18.0981 23.4131C18.0101 23.456 17.9184 23.4909 17.8282 23.5294H16.1119ZM2.59235 4.97699V11.1328H17.5744V4.97699H2.59235ZM4.46483 18.5713C5.49679 18.5684 6.33365 17.7348 6.32998 16.7137C6.32558 15.694 5.47625 14.8561 4.4553 14.8641C3.42701 14.872 2.57915 15.7166 2.58649 16.7246C2.59382 17.745 3.43801 18.575 4.46557 18.5713H4.46483ZM15.7034 18.5713C16.7302 18.5735 17.5751 17.7421 17.581 16.7231C17.5869 15.7137 16.739 14.8706 15.7114 14.8641C14.6898 14.8575 13.8404 15.6962 13.8375 16.7152C13.8338 17.7355 14.6722 18.5692 15.7034 18.5713Z"
                            fill="#BBBBBB" />
                        </svg>
                        <span hidden>bus</span></li>
                    <li onclick="chooseTransportMode(this);">
                        <svg width="24" height="20" viewBox="0 0 24 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                            d="M11.7746 4.46512C12.1923 4.46512 12.6005 4.33418 12.9478 4.08886C13.2951 3.84355 13.5658 3.49487 13.7256 3.08692C13.8855 2.67898 13.9273 2.23008 13.8458 1.79701C13.7643 1.36393 13.5632 0.966131 13.2678 0.653902C12.9725 0.341673 12.5962 0.129043 12.1866 0.042899C11.7769 -0.0432448 11.3523 0.000967325 10.9664 0.169944C10.5805 0.338921 10.2507 0.625074 10.0187 0.992216C9.78663 1.35936 9.66278 1.791 9.66278 2.23256C9.66445 2.82413 9.88748 3.39096 10.2832 3.80926C10.6788 4.22757 11.215 4.46335 11.7746 4.46512V4.46512ZM7.97334 19.9814L9.02924 15.0698L11.2466 17.3023V24H13.3584V15.6279L11.141 13.3954L11.7746 10.0465C12.4991 10.9217 13.3919 11.6234 14.3933 12.1046C15.3948 12.5859 16.4819 12.8356 17.582 12.8372V10.6047C16.6693 10.6193 15.769 10.3794 14.9719 9.90902C14.1748 9.43868 13.509 8.75456 13.0417 7.92558L11.9858 6.13954C11.7986 5.80975 11.5362 5.53479 11.2227 5.33979C10.9091 5.1448 10.5543 5.03597 10.1907 5.02326C9.87396 5.02326 9.66278 5.13488 9.34601 5.13488L3.85532 7.5907V12.8372H5.96712V9.04186L7.86774 8.26047L6.1783 17.3023L1.00439 16.186L0.582031 18.4186L7.97334 19.9814Z"
                            fill="#BBBBBB" />
                        </svg>
                        <span hidden>walk</span></li>
                    <li onclick="chooseTransportMode(this);">
                        <svg width="21" height="24" viewBox="0 0 21 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                            d="M15.4969 3.90244C15.8829 3.90244 16.2601 3.788 16.581 3.5736C16.9019 3.3592 17.152 3.05446 17.2996 2.69792C17.4473 2.34138 17.486 1.94906 17.4107 1.57056C17.3354 1.19206 17.1496 0.844382 16.8767 0.5715C16.6038 0.298617 16.2561 0.112781 15.8776 0.037493C15.4991 -0.0377952 15.1068 0.000845426 14.7502 0.148529C14.3937 0.296212 14.089 0.546304 13.8746 0.867181C13.6602 1.18806 13.5457 1.56531 13.5457 1.95122C13.5473 2.46824 13.7533 2.96364 14.1189 3.32923C14.4845 3.69483 14.9799 3.9009 15.4969 3.90244V3.90244ZM5.25305 10.2439C3.95931 10.2439 2.71856 10.7578 1.80375 11.6726C0.888936 12.5875 0.375 13.8282 0.375 15.1219C0.375 16.4157 0.888936 17.6564 1.80375 18.5712C2.71856 19.4861 3.95931 20 5.25305 20C6.54679 20 7.78754 19.4861 8.70235 18.5712C9.61716 17.6564 10.1311 16.4157 10.1311 15.1219C10.1311 13.8282 9.61716 12.5875 8.70235 11.6726C7.78754 10.7578 6.54679 10.2439 5.25305 10.2439ZM5.25305 18.5366C4.34743 18.5366 3.47891 18.1768 2.83854 17.5365C2.19817 16.8961 1.83841 16.0276 1.83841 15.1219C1.83841 14.2163 2.19817 13.3478 2.83854 12.7074C3.47891 12.0671 4.34743 11.7073 5.25305 11.7073C6.15866 11.7073 7.02719 12.0671 7.66756 12.7074C8.30793 13.3478 8.66768 14.2163 8.66768 15.1219C8.66768 16.0276 8.30793 16.8961 7.66756 17.5365C7.02719 18.1768 6.15866 18.5366 5.25305 18.5366ZM10.9116 8.78049L13.253 6.43902L14.0335 7.21951C14.6811 7.87989 15.456 8.40196 16.3112 8.75412C17.1665 9.10628 18.0843 9.2812 19.0091 9.26829V7.31707C18.3553 7.32268 17.707 7.19592 17.1034 6.94442C16.4998 6.69292 15.9534 6.32189 15.4969 5.85366L13.6433 4C13.21 3.62402 12.656 3.41627 12.0823 3.41463C11.8246 3.39755 11.5665 3.44168 11.3291 3.54341C11.0918 3.64515 10.8818 3.80161 10.7165 4L7.98475 6.73171C7.80159 6.90926 7.65552 7.12143 7.55503 7.3559C7.45454 7.59037 7.40164 7.84247 7.39939 8.09756C7.3823 8.35526 7.42643 8.61335 7.52817 8.85073C7.6299 9.08812 7.78636 9.29806 7.98475 9.46341L11.1067 12.1951V17.0732H13.0579V11.0244L10.9116 8.78049ZM18.9116 10.2439C17.9468 10.2439 17.0037 10.53 16.2015 11.066C15.3993 11.602 14.7741 12.3639 14.4049 13.2552C14.0356 14.1465 13.939 15.1274 14.1273 16.0736C14.3155 17.0199 14.7801 17.889 15.4623 18.5712C16.1445 19.2535 17.0137 19.718 17.9599 19.9063C18.9062 20.0945 19.887 19.9979 20.7783 19.6287C21.6697 19.2595 22.4315 18.6342 22.9675 17.832C23.5035 17.0299 23.7896 16.0867 23.7896 15.1219C23.796 14.4796 23.6742 13.8424 23.4313 13.2477C23.1884 12.653 22.8294 12.1127 22.3751 11.6584C21.9209 11.2042 21.3806 10.8451 20.7859 10.6022C20.1911 10.3593 19.554 10.2375 18.9116 10.2439V10.2439ZM18.9116 18.5366C18.2362 18.5366 17.576 18.3363 17.0145 17.9611C16.453 17.5859 16.0153 17.0526 15.7569 16.4287C15.4984 15.8047 15.4308 15.1182 15.5626 14.4558C15.6943 13.7934 16.0195 13.185 16.4971 12.7074C16.9746 12.2299 17.583 11.9047 18.2454 11.7729C18.9078 11.6412 19.5944 11.7088 20.2183 11.9672C20.8422 12.2257 21.3755 12.6633 21.7507 13.2249C22.1259 13.7864 22.3262 14.4466 22.3262 15.1219C22.3153 16.0242 21.9521 16.8864 21.3141 17.5244C20.676 18.1624 19.8138 18.5257 18.9116 18.5366V18.5366Z"
                            fill="#BBBBBB" />
                        </svg>
                        <span hidden>cycle</span></li>
                </ul>
            </li>
            {% endfor %}{% endif %}
            <li class="inactivedate" id="card-date-add" onclick="openInitPage();">
                <h1>+ Add day</h1>
            </li>
        </ul>
    </section>

    {% if itineraries == None %}
    <section id="editplannertrip" style="display: none; background-color: white;">
    {% else %}
    <section id="editplannertrip" style="background-color: white;">
    {% endif %}
        <div id="planPage">
            {% if itineraries != None %}
                {% for i in range(itineraries|length) %}
                {% set itinerary = itineraries[i] %}
                <div class="planSection" style="display: none;">
                    <section class="req-info" hidden>
                        {% if itineraries != None %}
                        <div class="time-left">Duration left: <span>{{itinerary.getTimeLeft()| int}}</span></div>
                        {% else %}
                        <div class="time-left">Duration left: <span></span></div>
                        {% endif %}
                    </section>

                    <div class="recommendation-listings plannertripitinerary" style="overflow-y: scroll;">
                        {% if itinerary.getPlaces()| length == 0 %}
                        <div class="plannerend start" onclick="openSearch(this, '{{i+1}}');">
                            <div class="plannerendpoint">
                                <svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                    d="M0.888672 15.5C0.888672 12.5333 1.76841 9.63319 3.41663 7.16645C5.06485 4.69972 7.40753 2.77713 10.1484 1.64181C12.8893 0.506499 15.9053 0.209449 18.815 0.788228C21.7247 1.36701 24.3975 2.79562 26.4953 4.8934C28.5931 6.99119 30.0217 9.66394 30.6004 12.5737C31.1792 15.4834 30.8822 18.4994 29.7469 21.2403C28.6115 23.9811 26.689 26.3238 24.2222 27.972C21.7555 29.6203 18.8554 30.5 15.8887 30.5C13.9188 30.5 11.9683 30.112 10.1484 29.3582C8.32853 28.6044 6.67495 27.4995 5.28207 26.1066C2.46902 23.2936 0.888672 19.4783 0.888672 15.5ZM15.8887 24.5C17.6687 24.5 19.4088 23.9722 20.8888 22.9832C22.3688 21.9943 23.5224 20.5887 24.2036 18.9442C24.8848 17.2996 25.063 15.49 24.7157 13.7442C24.3685 11.9984 23.5113 10.3947 22.2526 9.13604C20.994 7.87737 19.3903 7.0202 17.6445 6.67294C15.8987 6.32567 14.0891 6.5039 12.4445 7.18509C10.8 7.86628 9.39438 9.01983 8.40544 10.4999C7.41651 11.9799 6.88867 13.72 6.88867 15.5C6.88867 17.887 7.83688 20.1761 9.52471 21.864C11.2125 23.5518 13.5017 24.5 15.8887 24.5Z"
                                    fill="#06A122" />
                                </svg>
                                <h2 class="inactiveinput">Add Start-Off Point</h2>
                            </div>
                    
                            <!-- addlocation -->
                            <svg class="addlocation" width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="2.22656" y="2" width="26" height="26" rx="5" fill="white" />
                                <path
                                d="M26.8842 3.66314e-06H3.56402C2.67887 3.66314e-06 1.82997 0.351656 1.20408 0.977601C0.578186 1.60355 0.226563 2.45251 0.226562 3.33773V26.6647C0.226563 27.5499 0.578186 28.3989 1.20408 29.0248C1.82997 29.6508 2.67887 30.0024 3.56402 30.0024H26.8891C27.7743 30.0024 28.6231 29.6508 29.249 29.0248C29.8749 28.3989 30.2266 27.5499 30.2266 26.6647V3.33773C30.2266 2.899 30.1401 2.46457 29.972 2.05929C29.804 1.65402 29.5577 1.28585 29.2473 0.975851C28.9369 0.66585 28.5684 0.420098 28.1629 0.252652C27.7574 0.0852068 27.3229 -0.000646311 26.8842 3.66314e-06ZM23.5467 16.6627H16.8879V23.327H13.5504V16.6627H6.89034V13.3249H13.5541V6.66433H16.8916V13.3287H23.5517L23.5467 16.6627Z"
                                fill="#2B2B2B" />
                            </svg>
                        </div>

                        {% elif itinerary.getPlaces()| length == 1 %}
                        <div class="plan-selection start">
                            <div class="plannerstart">
                                <div class="plannerstartpoint">
                                    <svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                        d="M0.888672 15.5C0.888672 12.5333 1.76841 9.63319 3.41663 7.16645C5.06485 4.69972 7.40753 2.77713 10.1484 1.64181C12.8893 0.506499 15.9053 0.209449 18.815 0.788228C21.7247 1.36701 24.3975 2.79562 26.4953 4.8934C28.5931 6.99119 30.0217 9.66394 30.6004 12.5737C31.1792 15.4834 30.8822 18.4994 29.7469 21.2403C28.6115 23.9811 26.689 26.3238 24.2222 27.972C21.7555 29.6203 18.8554 30.5 15.8887 30.5C13.9188 30.5 11.9683 30.112 10.1484 29.3582C8.32853 28.6044 6.67495 27.4995 5.28207 26.1066C2.46902 23.2936 0.888672 19.4783 0.888672 15.5ZM15.8887 24.5C17.6687 24.5 19.4088 23.9722 20.8888 22.9832C22.3688 21.9943 23.5224 20.5887 24.2036 18.9442C24.8848 17.2996 25.063 15.49 24.7157 13.7442C24.3685 11.9984 23.5113 10.3947 22.2526 9.13604C20.994 7.87737 19.3903 7.0202 17.6445 6.67294C15.8987 6.32567 14.0891 6.5039 12.4445 7.18509C10.8 7.86628 9.39438 9.01983 8.40544 10.4999C7.41651 11.9799 6.88867 13.72 6.88867 15.5C6.88867 17.887 7.83688 20.1761 9.52471 21.864C11.2125 23.5518 13.5017 24.5 15.8887 24.5Z"
                                        fill="#06A122" />
                                    </svg>
                                    <h1 class="plan-name">{{itinerary.getPlaces()[0].Name}}</h1>
                                    <p class="plan-address" hidden>{{itinerary.getPlaces()[0].Address}}</p>
                                    <p class="plan-latlng" hidden>{{itinerary.getPlaces()[0].Latlng}}</p>
                                </div>
        
                                <div class="plannerstarttime">
                                    <h1 class="plan-timing" hidden></h1>
                                </div>
                            </div>
                        </div>

                        <div class="plan-unsetEnd">
                            <hr>
                            <div class="plannerevent btn-addPlan" onclick="openRecommendTab(2, this);">
                                <div class="eventdetails">
                                    <div class="eventinfo">
                                    <h2 class="inactiveinput">Add an Itinerary</h2>
                                    </div>
                                </div>
                        
                                <div class="eventedit">
                                <!-- addlocation -->
                                <svg class="addlocation" width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg" >
                                    <rect x="2.22656" y="2" width="26" height="26" rx="5" fill="white" />
                                    <path
                                    d="M26.8842 3.66314e-06H3.56402C2.67887 3.66314e-06 1.82997 0.351656 1.20408 0.977601C0.578186 1.60355 0.226563 2.45251 0.226562 3.33773V26.6647C0.226563 27.5499 0.578186 28.3989 1.20408 29.0248C1.82997 29.6508 2.67887 30.0024 3.56402 30.0024H26.8891C27.7743 30.0024 28.6231 29.6508 29.249 29.0248C29.8749 28.3989 30.2266 27.5499 30.2266 26.6647V3.33773C30.2266 2.899 30.1401 2.46457 29.972 2.05929C29.804 1.65402 29.5577 1.28585 29.2473 0.975851C28.9369 0.66585 28.5684 0.420098 28.1629 0.252652C27.7574 0.0852068 27.3229 -0.000646311 26.8842 3.66314e-06ZM23.5467 16.6627H16.8879V23.327H13.5504V16.6627H6.89034V13.3249H13.5541V6.66433H16.8916V13.3287H23.5517L23.5467 16.6627Z"
                                    fill="#2B2B2B" />
                                </svg>
                                </div>
                            </div>

                            <hr>
 
                            <div class="plannerend end" onclick="openSearch(this, '{{i+1}}');removeUnset(this);">
                                <div class="plannerendpoint">
                                    <svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M0.333984 15.9771C0.333984 13.0103 1.21372 10.1102 2.86194 7.6435C4.51016 5.17677 6.85284 3.25418 9.59373 2.11886C12.3346 0.98355 15.3506 0.6865 18.2603 1.26528C21.17 1.84406 23.8428 3.27267 25.9406 5.37046C28.0384 7.46824 29.467 10.141 30.0458 13.0507C30.6245 15.9604 30.3275 18.9764 29.1922 21.7173C28.0569 24.4582 26.1343 26.8009 23.6675 28.4491C21.2008 30.0973 18.3007 30.9771 15.334 30.9771C13.3642 30.9771 11.4136 30.5891 9.59373 29.8352C7.77385 29.0814 6.12026 27.9765 4.72738 26.5837C1.91434 23.7706 0.333984 19.9553 0.333984 15.9771ZM15.334 24.9771C17.114 24.9771 18.8541 24.4492 20.3341 23.4603C21.8142 22.4713 22.9677 21.0657 23.6489 19.4212C24.3301 17.7767 24.5083 15.9671 24.161 14.2212C23.8138 12.4754 22.9566 10.8718 21.6979 9.6131C20.4393 8.35442 18.8356 7.49726 17.0898 7.14999C15.344 6.80272 13.5344 6.98095 11.8898 7.66214C10.2453 8.34333 8.83969 9.49688 7.85076 10.9769C6.86182 12.457 6.33398 14.197 6.33398 15.9771C6.33398 18.364 7.28219 20.6532 8.97002 22.341C10.6578 24.0288 12.947 24.9771 15.334 24.9771Z"
                                        fill="#E4002B" />
                                    </svg>
                                    <h2 class="inactiveinput">Add End-Off Point</h2>
                                </div>
                        
                                <!-- addlocation -->
                                <svg class="addlocation" width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="2.22656" y="2" width="26" height="26" rx="5" fill="white" />
                                    <path
                                    d="M26.8842 3.66314e-06H3.56402C2.67887 3.66314e-06 1.82997 0.351656 1.20408 0.977601C0.578186 1.60355 0.226563 2.45251 0.226562 3.33773V26.6647C0.226563 27.5499 0.578186 28.3989 1.20408 29.0248C1.82997 29.6508 2.67887 30.0024 3.56402 30.0024H26.8891C27.7743 30.0024 28.6231 29.6508 29.249 29.0248C29.8749 28.3989 30.2266 27.5499 30.2266 26.6647V3.33773C30.2266 2.899 30.1401 2.46457 29.972 2.05929C29.804 1.65402 29.5577 1.28585 29.2473 0.975851C28.9369 0.66585 28.5684 0.420098 28.1629 0.252652C27.7574 0.0852068 27.3229 -0.000646311 26.8842 3.66314e-06ZM23.5467 16.6627H16.8879V23.327H13.5504V16.6627H6.89034V13.3249H13.5541V6.66433H16.8916V13.3287H23.5517L23.5467 16.6627Z"
                                    fill="#2B2B2B" />
                                </svg>
                            </div>
                        </div>
                        
                        {% else %}
                            {% set planLoopLen = itinerary.getPlaces()| length %}
                            {% if itinerary.getEnd() %} {% set planLoopLen = planLoopLen -1 %} {% endif %}

                            <div class="plan-selection start">
                                <div class="plannerstart">
                                    <div class="plannerstartpoint">
                                        <svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path
                                            d="M0.888672 15.5C0.888672 12.5333 1.76841 9.63319 3.41663 7.16645C5.06485 4.69972 7.40753 2.77713 10.1484 1.64181C12.8893 0.506499 15.9053 0.209449 18.815 0.788228C21.7247 1.36701 24.3975 2.79562 26.4953 4.8934C28.5931 6.99119 30.0217 9.66394 30.6004 12.5737C31.1792 15.4834 30.8822 18.4994 29.7469 21.2403C28.6115 23.9811 26.689 26.3238 24.2222 27.972C21.7555 29.6203 18.8554 30.5 15.8887 30.5C13.9188 30.5 11.9683 30.112 10.1484 29.3582C8.32853 28.6044 6.67495 27.4995 5.28207 26.1066C2.46902 23.2936 0.888672 19.4783 0.888672 15.5ZM15.8887 24.5C17.6687 24.5 19.4088 23.9722 20.8888 22.9832C22.3688 21.9943 23.5224 20.5887 24.2036 18.9442C24.8848 17.2996 25.063 15.49 24.7157 13.7442C24.3685 11.9984 23.5113 10.3947 22.2526 9.13604C20.994 7.87737 19.3903 7.0202 17.6445 6.67294C15.8987 6.32567 14.0891 6.5039 12.4445 7.18509C10.8 7.86628 9.39438 9.01983 8.40544 10.4999C7.41651 11.9799 6.88867 13.72 6.88867 15.5C6.88867 17.887 7.83688 20.1761 9.52471 21.864C11.2125 23.5518 13.5017 24.5 15.8887 24.5Z"
                                            fill="#06A122" />
                                        </svg>
                                        <h1 class="plan-name">{{itinerary.getPlaces()[0].Name}}</h1>
                                        <p class="plan-address" hidden>{{itinerary.getPlaces()[0].Address}}</p>
                                        <p class="plan-latlng" hidden>{{itinerary.getPlaces()[0].Latlng}}</p>
                                    </div>
            
                                    <div class="plannerstarttime">
                                        <h1 class="plan-timing"></h1>
                                    </div>
                                </div>
                            </div>
                            {% for j in range(1, planLoopLen) %}
                            <div class="plan-selection">
                                <hr>
                                <!-- explorerdirections -->
                                <div class="explorerdirections">
                                    <div class="explorertransport">
                                    </div>

                                    <!-- explorertravelduration -->
                                    <div class="explorertravelduration">
                                    <h1><span class="plan-travel-duration">{{itinerary.getPlaces()[j].TravelDuration|int}}</span>min</h1>
                                    <h2 onclick="showExpandedRoute">Details <svg width="9" height="5" viewBox="0 0 9 5" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M0.78125 0.657445C0.862652 0.406133 1.05557 0.252445 1.23283 0.0900984C1.37284 -0.0380473 1.60198 -0.0213795 1.74749 0.102437C1.78154 0.132408 1.81395 0.164424 1.84456 0.198329C2.79981 1.21383 3.75459 2.2299 4.70889 3.24655C4.73025 3.27304 4.74965 3.30127 4.76688 3.33097C4.80453 3.29266 4.82794 3.27079 4.84829 3.24785C5.81073 2.22441 6.7731 1.20098 7.7354 0.177549C7.90716 -0.00492803 8.11881 -0.0605592 8.29077 0.0760284C8.44962 0.204574 8.59127 0.355537 8.71182 0.524754C8.82497 0.681473 8.79159 0.89274 8.67112 1.04773C8.65301 1.0711 8.63367 1.09383 8.61352 1.11526L5.12668 4.82564C4.95309 5.0105 4.74959 5.05076 4.56134 4.93495C4.51708 4.90599 4.47652 4.87107 4.44067 4.83105C3.27391 3.59 2.1079 2.34859 0.942629 1.10682C0.874048 1.03322 0.834365 0.930405 0.78125 0.84014L0.78125 0.657445Z"
                                            fill="#E4002B" />
                                        </svg>
                                    </h2>
                                    </div>
                                </div>
                                <hr>
                                
                                <div class="plannerevent btn-addPlan" onclick="openRecommendTab(parseInt('{{j+1}}'), this);">
                                    <div class="eventdetails">
                                        <div class="eventinfo">
                                        <h2 class="inactiveinput">Add an Itinerary</h2>
                                        </div>
                                    </div>
                            
                                    <div class="eventedit">
                                    <!-- addlocation -->
                                    <svg class="addlocation" width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <rect x="2.22656" y="2" width="26" height="26" rx="5" fill="white" />
                                        <path
                                        d="M26.8842 3.66314e-06H3.56402C2.67887 3.66314e-06 1.82997 0.351656 1.20408 0.977601C0.578186 1.60355 0.226563 2.45251 0.226562 3.33773V26.6647C0.226563 27.5499 0.578186 28.3989 1.20408 29.0248C1.82997 29.6508 2.67887 30.0024 3.56402 30.0024H26.8891C27.7743 30.0024 28.6231 29.6508 29.249 29.0248C29.8749 28.3989 30.2266 27.5499 30.2266 26.6647V3.33773C30.2266 2.899 30.1401 2.46457 29.972 2.05929C29.804 1.65402 29.5577 1.28585 29.2473 0.975851C28.9369 0.66585 28.5684 0.420098 28.1629 0.252652C27.7574 0.0852068 27.3229 -0.000646311 26.8842 3.66314e-06ZM23.5467 16.6627H16.8879V23.327H13.5504V16.6627H6.89034V13.3249H13.5541V6.66433H16.8916V13.3287H23.5517L23.5467 16.6627Z"
                                        fill="#2B2B2B" />
                                    </svg>
                                    </div>
                                </div>
                                <hr>
            
                                <div class="plannerevent">
                                    <div class="eventdetails">
                                        <div class="eventimg plan-img" style="background-image: url('{{itinerary.getPlaces()[j].Image}}');">
                                            <span hidden>{{itinerary.getPlaces()[j].Img}}</span>
                                        </div>
                            
                                        <div class="eventinfo">
                                            <h1 class="eventname plan-name">{{itinerary.getPlaces()[j].Name}}</h1>
                                            <h2 class="eventtype plan-category">{{itinerary.getPlaces()[j].Category}}</h2>
                                            <p class="plan-address" hidden>{{itinerary.getPlaces()[j].Address}}</p>
                                            <p class="plan-activity-duration" hidden><span>{{itinerary.getPlaces()[j].ActivityDuration}}</span> min</p>
                                            <p class="plan-total-duration" hidden><span>{{itinerary.getPlaces()[j].TotalDuration|int}}</span> min</p>
                                            <p class="plan-timing" hidden></p>
                                            <p class="plan-latlng" hidden>{{itinerary.getPlaces()[j].Latlng}}</p>
                                        </div>
                                    </div>
                            
                                    <div class="eventedit">
                                        <svg class="editevent plan-edit" width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg"
                                        onclick="editCard(this, parseInt('{{j+1}}'));">
                                        <path
                                            d="M0.333984 16.3335V20.5H4.49963L16.7872 8.21241L12.6208 4.04593L0.333984 16.3335ZM20.0091 4.9905C20.1121 4.88775 20.1938 4.76571 20.2495 4.63135C20.3053 4.49699 20.334 4.35295 20.334 4.20748C20.334 4.06202 20.3053 3.91798 20.2495 3.78362C20.1938 3.64926 20.1121 3.52721 20.0091 3.42447L17.4095 0.82485C17.3068 0.721875 17.1847 0.640178 17.0504 0.584435C16.916 0.528693 16.772 0.5 16.6265 0.5C16.481 0.5 16.337 0.528693 16.2026 0.584435C16.0683 0.640178 15.9462 0.721875 15.8435 0.82485L13.8101 2.8574L17.9725 7.02387L20.0058 4.9905H20.0091Z"
                                            fill="#2B2B2B" />
                                        </svg>
                            
                                        <svg class="deleteevent plan-delete" width="17" height="21" viewBox="0 0 17 21" fill="none" xmlns="http://www.w3.org/2000/svg"
                                        onclick="delCard(this, parseInt('{{j+1}}'));">
                                        <path
                                            d="M2.01977 18.2776C2.02236 18.8662 2.26154 19.43 2.68522 19.8462C3.1089 20.2625 3.68278 20.4974 4.28195 20.5H13.3297C13.9289 20.4974 14.5028 20.2625 14.9264 19.8462C15.3501 19.43 15.5893 18.8662 15.5919 18.2776V4.94391H2.01977V18.2776ZM16.722 1.61122H12.7637L11.6326 0.5H5.9781L4.84701 1.61122H0.888672V3.83366H16.722V1.61122Z"
                                            fill="#E4002B" />
                                        </svg>
                                    </div>
                                </div>

                                <input type="text" class="addnote" value="" placeholder="Add Notes">
                            </div>
                            {% endfor %}
                            {% if itinerary.getEnd() %}
                            <div class="plan-selection end">
                                <hr>
                                <!-- explorerdirections -->
                                <div class="explorerdirections">
                                    <div class="explorertransport">
                                    </div>

                                    <!-- explorertravelduration -->
                                    <div class="explorertravelduration">
                                    <h1><span class="plan-travel-duration">{{itinerary.getPlaces()[planLoopLen].TotalDuration|int}}</span>min</h1>
                                    <h2 onclick="showExpandedRoute">Details <svg width="9" height="5" viewBox="0 0 9 5" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M0.78125 0.657445C0.862652 0.406133 1.05557 0.252445 1.23283 0.0900984C1.37284 -0.0380473 1.60198 -0.0213795 1.74749 0.102437C1.78154 0.132408 1.81395 0.164424 1.84456 0.198329C2.79981 1.21383 3.75459 2.2299 4.70889 3.24655C4.73025 3.27304 4.74965 3.30127 4.76688 3.33097C4.80453 3.29266 4.82794 3.27079 4.84829 3.24785C5.81073 2.22441 6.7731 1.20098 7.7354 0.177549C7.90716 -0.00492803 8.11881 -0.0605592 8.29077 0.0760284C8.44962 0.204574 8.59127 0.355537 8.71182 0.524754C8.82497 0.681473 8.79159 0.89274 8.67112 1.04773C8.65301 1.0711 8.63367 1.09383 8.61352 1.11526L5.12668 4.82564C4.95309 5.0105 4.74959 5.05076 4.56134 4.93495C4.51708 4.90599 4.47652 4.87107 4.44067 4.83105C3.27391 3.59 2.1079 2.34859 0.942629 1.10682C0.874048 1.03322 0.834365 0.930405 0.78125 0.84014L0.78125 0.657445Z"
                                            fill="#E4002B" />
                                        </svg>
                                    </h2>
                                    </div>
                                </div>

                                <hr>
                                <div class="plannerevent btn-addPlan" onclick="openRecommendTab(parseInt('{{planLoopLen+1}}'), this)">
                                    <div class="eventdetails">
                                        <div class="eventinfo">
                                        <h2 class="inactiveinput">Add an Itinerary</h2>
                                        </div>
                                    </div>
                            
                                    <div class="eventedit">
                                    <!-- addlocation -->
                                    <svg class="addlocation" width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg" >
                                        <rect x="2.22656" y="2" width="26" height="26" rx="5" fill="white" />
                                        <path
                                        d="M26.8842 3.66314e-06H3.56402C2.67887 3.66314e-06 1.82997 0.351656 1.20408 0.977601C0.578186 1.60355 0.226563 2.45251 0.226562 3.33773V26.6647C0.226563 27.5499 0.578186 28.3989 1.20408 29.0248C1.82997 29.6508 2.67887 30.0024 3.56402 30.0024H26.8891C27.7743 30.0024 28.6231 29.6508 29.249 29.0248C29.8749 28.3989 30.2266 27.5499 30.2266 26.6647V3.33773C30.2266 2.899 30.1401 2.46457 29.972 2.05929C29.804 1.65402 29.5577 1.28585 29.2473 0.975851C28.9369 0.66585 28.5684 0.420098 28.1629 0.252652C27.7574 0.0852068 27.3229 -0.000646311 26.8842 3.66314e-06ZM23.5467 16.6627H16.8879V23.327H13.5504V16.6627H6.89034V13.3249H13.5541V6.66433H16.8916V13.3287H23.5517L23.5467 16.6627Z"
                                        fill="#2B2B2B" />
                                    </svg>
                                    </div>
                                </div>
                                <hr>
            
                                <div class="explorerend">
                                    <div class="explorerendpoint">
                                        <svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path
                                            d="M0.333984 15.9771C0.333984 13.0103 1.21372 10.1102 2.86194 7.6435C4.51016 5.17677 6.85284 3.25418 9.59373 2.11886C12.3346 0.98355 15.3506 0.6865 18.2603 1.26528C21.17 1.84406 23.8428 3.27267 25.9406 5.37046C28.0384 7.46824 29.467 10.141 30.0458 13.0507C30.6245 15.9604 30.3275 18.9764 29.1922 21.7173C28.0569 24.4582 26.1343 26.8009 23.6675 28.4491C21.2008 30.0973 18.3007 30.9771 15.334 30.9771C13.3642 30.9771 11.4136 30.5891 9.59373 29.8352C7.77385 29.0814 6.12026 27.9765 4.72738 26.5837C1.91434 23.7706 0.333984 19.9553 0.333984 15.9771ZM15.334 24.9771C17.114 24.9771 18.8541 24.4492 20.3341 23.4603C21.8142 22.4713 22.9677 21.0657 23.6489 19.4212C24.3301 17.7767 24.5083 15.9671 24.161 14.2212C23.8138 12.4754 22.9566 10.8718 21.6979 9.6131C20.4393 8.35442 18.8356 7.49726 17.0898 7.14999C15.344 6.80272 13.5344 6.98095 11.8898 7.66214C10.2453 8.34333 8.83969 9.49688 7.85076 10.9769C6.86182 12.457 6.33398 14.197 6.33398 15.9771C6.33398 18.364 7.28219 20.6532 8.97002 22.341C10.6578 24.0288 12.947 24.9771 15.334 24.9771Z"
                                            fill="#E4002B" />
                                        </svg>
                                        <h1 class="plan-name">{{itinerary.getPlaces()[planLoopLen].Name}}</h1>
                                        <p class="plan-address" hidden>{{itinerary.getPlaces()[planLoopLen].Address}}</p>
                                        <p class="plan-latlng" hidden>{{itinerary.getPlaces()[planLoopLen].Latlng}}</p>
                                        <p class="plan-total-duration" hidden>{{itinerary.getPlaces()[planLoopLen].TotalDuration|int}}</p>
                                    </div>
                                    <div class="explorerendtime">
                                        <h1 class="plan-timing" hidden></h1>
                                    </div>
                                </div>
                            </div>
                            {% else %}
                            <div class="plan-unsetEnd">
                                <hr>
                                <div class="plannerevent btn-addPlan" onclick="openRecommendTab(parseInt('{{planLoopLen+1}}'), this);">
                                    <div class="eventdetails">
                                        <div class="eventinfo">
                                        <h2 class="inactiveinput">Add an Itinerary</h2>
                                        </div>
                                    </div>
                            
                                    <div class="eventedit">
                                    <!-- addlocation -->
                                    <svg class="addlocation" width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg" >
                                        <rect x="2.22656" y="2" width="26" height="26" rx="5" fill="white" />
                                        <path
                                        d="M26.8842 3.66314e-06H3.56402C2.67887 3.66314e-06 1.82997 0.351656 1.20408 0.977601C0.578186 1.60355 0.226563 2.45251 0.226562 3.33773V26.6647C0.226563 27.5499 0.578186 28.3989 1.20408 29.0248C1.82997 29.6508 2.67887 30.0024 3.56402 30.0024H26.8891C27.7743 30.0024 28.6231 29.6508 29.249 29.0248C29.8749 28.3989 30.2266 27.5499 30.2266 26.6647V3.33773C30.2266 2.899 30.1401 2.46457 29.972 2.05929C29.804 1.65402 29.5577 1.28585 29.2473 0.975851C28.9369 0.66585 28.5684 0.420098 28.1629 0.252652C27.7574 0.0852068 27.3229 -0.000646311 26.8842 3.66314e-06ZM23.5467 16.6627H16.8879V23.327H13.5504V16.6627H6.89034V13.3249H13.5541V6.66433H16.8916V13.3287H23.5517L23.5467 16.6627Z"
                                        fill="#2B2B2B" />
                                    </svg>
                                    </div>
                                </div>

                                <hr>
                                <div class="plannerend end" onclick="openSearch(this, '{{i+1}}');removeUnset(this);">
                                    <div class="plannerendpoint">
                                        <svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M0.333984 15.9771C0.333984 13.0103 1.21372 10.1102 2.86194 7.6435C4.51016 5.17677 6.85284 3.25418 9.59373 2.11886C12.3346 0.98355 15.3506 0.6865 18.2603 1.26528C21.17 1.84406 23.8428 3.27267 25.9406 5.37046C28.0384 7.46824 29.467 10.141 30.0458 13.0507C30.6245 15.9604 30.3275 18.9764 29.1922 21.7173C28.0569 24.4582 26.1343 26.8009 23.6675 28.4491C21.2008 30.0973 18.3007 30.9771 15.334 30.9771C13.3642 30.9771 11.4136 30.5891 9.59373 29.8352C7.77385 29.0814 6.12026 27.9765 4.72738 26.5837C1.91434 23.7706 0.333984 19.9553 0.333984 15.9771ZM15.334 24.9771C17.114 24.9771 18.8541 24.4492 20.3341 23.4603C21.8142 22.4713 22.9677 21.0657 23.6489 19.4212C24.3301 17.7767 24.5083 15.9671 24.161 14.2212C23.8138 12.4754 22.9566 10.8718 21.6979 9.6131C20.4393 8.35442 18.8356 7.49726 17.0898 7.14999C15.344 6.80272 13.5344 6.98095 11.8898 7.66214C10.2453 8.34333 8.83969 9.49688 7.85076 10.9769C6.86182 12.457 6.33398 14.197 6.33398 15.9771C6.33398 18.364 7.28219 20.6532 8.97002 22.341C10.6578 24.0288 12.947 24.9771 15.334 24.9771Z"
                                            fill="#E4002B" />
                                        </svg>
                                        <h2 class="inactiveinput">Add End-Off Point</h2>
                                    </div>
                            
                                    <!-- addlocation -->
                                    <svg class="addlocation" width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <rect x="2.22656" y="2" width="26" height="26" rx="5" fill="white" />
                                        <path
                                        d="M26.8842 3.66314e-06H3.56402C2.67887 3.66314e-06 1.82997 0.351656 1.20408 0.977601C0.578186 1.60355 0.226563 2.45251 0.226562 3.33773V26.6647C0.226563 27.5499 0.578186 28.3989 1.20408 29.0248C1.82997 29.6508 2.67887 30.0024 3.56402 30.0024H26.8891C27.7743 30.0024 28.6231 29.6508 29.249 29.0248C29.8749 28.3989 30.2266 27.5499 30.2266 26.6647V3.33773C30.2266 2.899 30.1401 2.46457 29.972 2.05929C29.804 1.65402 29.5577 1.28585 29.2473 0.975851C28.9369 0.66585 28.5684 0.420098 28.1629 0.252652C27.7574 0.0852068 27.3229 -0.000646311 26.8842 3.66314e-06ZM23.5467 16.6627H16.8879V23.327H13.5504V16.6627H6.89034V13.3249H13.5541V6.66433H16.8916V13.3287H23.5517L23.5467 16.6627Z"
                                        fill="#2B2B2B" />
                                    </svg>
                                </div>
                            </div>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% endif %}
        </div>

        <!-- viewonmap -->
        <div class="viewonmap" onclick="openMapView();">
            <svg width="51" height="50" viewBox="0 0 51 50" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="0.888672" width="50" height="50" rx="5" fill="#2B2B2B" />
            <path
                d="M14.0286 37.4989C13.5494 37.3388 13.3875 36.9977 13.3887 36.5057C13.3978 31.8787 13.3942 27.2517 13.3942 22.6247C13.3942 22.0306 13.5311 21.8228 14.0714 21.6064C16.3617 20.6896 18.6526 19.7733 20.9434 18.8571H20.9459C21.0693 18.807 21.2032 18.8993 21.2032 19.0319V19.0417C21.2032 24.1894 21.202 29.3366 21.2081 34.4843C21.2081 34.6873 21.1445 34.7777 20.9599 34.8505C18.787 35.7117 16.6172 36.5808 14.4473 37.4494C14.4192 37.4604 14.396 37.4824 14.3703 37.4995H14.0286V37.4989Z"
                fill="white" />
            <path
                d="M37.8765 19.9487C37.2017 21.602 36.1015 23.025 35.0227 24.4571C34.5581 25.0732 34.0484 25.6557 33.5472 26.2437C33.1823 26.6722 32.6658 26.6813 32.3021 26.2645C30.9116 24.6679 29.6042 23.0091 28.5565 21.1613C28.1225 20.3967 27.7399 19.607 27.551 18.7409C27.3255 17.7079 27.4954 16.7128 27.9251 15.7697C28.6892 14.0925 29.9892 13.0467 31.7838 12.628C34.3045 12.0406 37.0898 13.5302 37.9847 15.9598C38.0152 16.0435 38.0434 16.1279 38.0696 16.2128C38.4437 17.4396 38.3618 18.7611 37.8771 19.9487H37.8765ZM32.9078 20.3154C34.1835 20.324 35.2543 19.2574 35.2568 17.9762C35.2592 16.7061 34.2177 15.6548 32.9366 15.6328C31.667 15.6114 30.5907 16.6725 30.5754 17.9597C30.5601 19.2323 31.6243 20.3062 32.9078 20.3154Z"
                fill="white" />
            <path
                d="M30.5742 37.1345V27.3525C30.5742 27.111 30.8762 27.0022 31.0302 27.1874L31.0345 27.1923C31.4098 27.644 31.8682 27.9674 32.4519 28.0762C33.3296 28.24 34.082 27.9869 34.6749 27.325C35.6945 26.1856 36.6498 24.9931 37.5086 23.7267C37.6437 23.528 37.7769 23.3282 37.9102 23.1283C38.052 22.9156 38.3832 23.0158 38.3832 23.2713V33.9256C38.3832 33.9653 38.3784 34.0044 38.3649 34.0417C38.2543 34.3547 38.0159 34.5295 37.706 34.6517C36.137 35.2703 34.5716 35.898 33.0069 36.527C32.3132 36.8057 31.6225 37.0905 30.9306 37.3741C30.7606 37.4438 30.5742 37.3185 30.5742 37.1351V37.1345Z"
                fill="white" />
            <path
                d="M22.766 19.0019C22.766 18.8846 22.8846 18.8045 22.9934 18.8479C23.1578 18.9133 23.3124 18.9744 23.4671 19.0362C24.3717 19.3974 25.2769 19.7562 26.1785 20.1235C26.2738 20.1626 26.3887 20.2378 26.4248 20.3246C27.0391 21.8154 27.9021 23.1601 28.8434 24.4577C28.9553 24.6118 29.0158 24.797 29.0158 24.987C29.0109 28.9655 29.0121 32.944 29.0121 36.9225V36.997C29.0121 37.1144 28.8935 37.1975 28.7841 37.1541H28.7823C26.8459 36.3791 24.9108 35.601 22.972 34.8327C22.8094 34.7685 22.7611 34.6872 22.7617 34.5167C22.7666 29.3451 22.7654 24.1735 22.7654 19.0019H22.766Z"
                fill="white" />
            </svg>
    
        </div>
    
        <!-- bottom -->
        <section class="bottom">
            <form method="POST">
                <input id="planner-id" name="plannerId" value="{% if itineraries != None %}{{itineraries[0].getPlannerId()}}{% endif %}" hidden readonly>
                <div class="maincta" onclick="document.querySelector('form').submit();">
                    <h1>Create Trip!</h1>
                </div>
            </form>
        </section>

    </section>

    <!-- Search Page -->
    <div class="device" id="searchTab" style="position: absolute; z-index:15; background-color: white; display: none; bottom: -200vh;">
        <div class="searchheader">
            <svg onclick="document.getElementById('recommendSearch').style.display = 'none';" width="12" height="20" viewBox="0 0 12 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M10.2642 0C10.8582 0.203504 11.2215 0.68581 11.6052 1.12894C11.9081 1.47897 11.8687 2.05183 11.5761 2.4156C11.5052 2.50072 11.4295 2.58174 11.3494 2.65828C8.94914 5.0464 6.54751 7.43334 4.14452 9.81909C4.0819 9.87251 4.01519 9.92099 3.94498 9.96409C4.03554 10.0582 4.08722 10.1167 4.14145 10.1676C6.56048 12.5737 8.9795 14.9796 11.3985 17.3854C11.8298 17.8148 11.9613 18.3439 11.6385 18.7738C11.3346 19.1709 10.9778 19.5251 10.5779 19.8264C10.2074 20.1093 9.70807 20.0259 9.34174 19.7247C9.28648 19.6794 9.23276 19.6311 9.18211 19.5807L0.412125 10.8636C-0.0248138 10.4296 -0.119978 9.92084 0.153748 9.45024C0.222198 9.33957 0.304744 9.23817 0.399334 9.14854C3.33272 6.23165 6.26697 3.31661 9.20206 0.403448C9.37602 0.231995 9.61905 0.132787 9.8324 0H10.2642Z"
                fill="#2B2B2B" />
            </svg>
      
            <h1>Set Location</h1>
      
      
            <svg width="15" height="20" viewBox="0 0 15 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M12.569 0H2.14312C1.57629 0.00205569 1.03339 0.237205 0.633538 0.653854C0.233688 1.0705 0.00954761 1.63462 0.0102946 2.22244L0 20L7.5 16.6663L15 20V2.22244C14.9975 1.6338 14.771 1.06999 14.3696 0.653759C13.9682 0.237523 13.4245 0.00255379 12.8569 0V0Z"
                  fill="#2B2B2B" />
            </svg>
        </div>

        <input type="text" class="Username" placeholder="Search location" id="searchBar" onkeyup="pauseSearch();" autocomplete="off">
        <div id="searchPage" hidden>1</div>
        <div id="search-btnId" hidden></div>
        <div id="search-divOrder" hidden></div>
        <div class="dropdown-item" id="start" onclick="addSE(this);">
            <p style="font-size: 14px; margin-bottom: 3px; font-weight: bold;">Your Location</p>
            <p style="font-size: 11px; max-width: 100%; overflow: auto; margin-bottom: 3px; display: none;">Current Location</p>
            <p id="start-latlng" hidden></p>
        </div>
        <div id="search-results">
        </div>
    </div>
    
    <!-- Recommendation tab -->
    <div class="device" id="recommendationTab" style="position: absolute; z-index:10; background-color: white; display: none; bottom: -200vh;">
        <div id="sectionIndex" hidden></div>
        <!-- header -->
        <div class="explorerheader">
            <svg width="12" height="20" onclick="closeRecommendTab();">
            <path
                d="M10.2642 0C10.8582 0.203504 11.2215 0.68581 11.6052 1.12894C11.9081 1.47897 11.8687 2.05183 11.5761 2.4156C11.5052 2.50072 11.4295 2.58174 11.3494 2.65828C8.94914 5.0464 6.54751 7.43334 4.14452 9.81909C4.0819 9.87251 4.01519 9.92099 3.94498 9.96409C4.03554 10.0582 4.08722 10.1167 4.14145 10.1676C6.56048 12.5737 8.9795 14.9796 11.3985 17.3854C11.8298 17.8148 11.9613 18.3439 11.6385 18.7738C11.3346 19.1709 10.9778 19.5251 10.5779 19.8264C10.2074 20.1093 9.70807 20.0259 9.34174 19.7247C9.28648 19.6794 9.23276 19.6311 9.18211 19.5807L0.412125 10.8636C-0.0248138 10.4296 -0.119978 9.92084 0.153748 9.45024C0.222198 9.33957 0.304744 9.23817 0.399334 9.14854C3.33272 6.23165 6.26697 3.31661 9.20206 0.403448C9.37602 0.231995 9.61905 0.132787 9.8324 0H10.2642Z"
                fill="#2B2B2B" />
            </svg>
            <h1>Edit Plan</h1>
            <svg onclick="document.getElementById('recommendSearch').style.display = 'block';" width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
                d="M0.773438 8.20312V9.29688C0.829688 9.68802 0.867708 10.0828 0.944792 10.4703C1.69479 14.225 4.80156 17.0578 8.6276 17.45C10.6422 17.6568 12.5146 17.2036 14.2292 16.1182C14.3974 16.0115 14.5609 15.8979 14.7516 15.7708C14.8031 15.8349 14.8427 15.8958 14.8938 15.9458C16.0599 17.0984 17.2307 18.2464 18.3917 19.4042C18.6635 19.675 18.9448 19.913 19.3281 20H19.7188C19.8984 19.9188 20.0901 19.8562 20.2547 19.7521C20.5469 19.5672 20.6839 19.2682 20.7734 18.9453V18.5156C20.6651 18.1245 20.3984 17.8469 20.1198 17.5703C18.974 16.4339 17.8354 15.2896 16.6943 14.1484C16.6406 14.0948 16.5896 14.0385 16.5438 13.9901C16.5568 13.9573 16.5599 13.9443 16.5667 13.9339C16.5995 13.8854 16.6339 13.838 16.6677 13.7901C17.9063 12.0109 18.4297 10.0365 18.2224 7.88333C18.0396 5.98698 17.3 4.31823 16.0214 2.90365C14.6906 1.43229 13.0453 0.507812 11.0891 0.152083C10.7391 0.0885417 10.3839 0.05 10.0312 0C9.69271 0 9.35417 0 9.01562 0C8.96563 0.0109375 8.91563 0.0291667 8.8651 0.0322917C7.66771 0.114063 6.53125 0.426042 5.4776 0.997396C3.00156 2.34062 1.47344 4.39531 0.924479 7.16458C0.85677 7.50729 0.822917 7.85729 0.773438 8.20312ZM3.27344 8.75052C3.27344 5.30208 6.0724 2.50104 9.51979 2.50156C12.9656 2.50156 15.7698 5.30469 15.7698 8.74948C15.7698 12.1937 12.9646 14.999 9.52083 14.9984C6.0724 14.9979 3.27396 12.1995 3.27344 8.75052Z"
                fill="#2B2B2B" />
            </svg>
        </div>

        <section id="recommendPage" class="homecontent">
            <div class="banner">

            </div>
            
            <div class="categories">
                <div id="selectedCat" hidden>Eateries</div>
                <ul id="categories">
                    {% for cat in catInfo %}
                    <li>
                        <div class="categoriesbutton">
                            <svg>
                            </svg>
                        </div>
                        <p>{{cat}}</p>
                    </li>
                    {% endfor %}
                    {% for i in range(8 - catInfo|length) %}
                    <li>
                        <div class="categoriesbutton">
                            <svg>
                            </svg>
                        </div>
                        <p>Lorem</p>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            
            <div id="recommendcon">
                <div class="sectionheader manyheadertags">
                    <div>
                        <h1>Recommended For You</h1>
                        <h2>Specially tailored for you!</h2>
                    </div>
            
                    <div class="view">
                        <h3>View All</h3>
                    </div>
                </div>
        
                <div id="recommend-main" class="plan-choices-list maincardcon attractionscon">
                </div>
            
                <!-- Places Near You -->
                <div class="sectionheader manyheadertags">
                    <div>
                        <h1>Places Near You</h1>
                        <h2>We thought you might like...</h2>
                    </div>
            
                    <div class="view">
                        <h3>View All</h3>
                    </div>
                </div>
        
                <div id="recommend-ratings" class="plan-choices-list maincardcon attractionscon">
                </div>
        
                <!-- Recommended By Us -->
                <div class="sectionheader manyheadertags">
                    <div>
                        <h1>Recommended By Us</h1>
                        <h2>We thought you might like...</h2>
                    </div>
            
                    <div class="view">
                        <h3>View All</h3>
                    </div>
                </div>
        
                <div id="recommend-partners" class="plan-choices-list maincardcon attractionscon">
                </div>
            </div>
        </section>

        <section id="recommendSearch" class="device" style="position:absolute; z-index: 12; display: none; background-color: white;">
            <div id="search">
                <div class="searchheader">
                  <svg onclick="document.getElementById('recommendSearch').style.display = 'none';" width="12" height="20" viewBox="0 0 12 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M10.2642 0C10.8582 0.203504 11.2215 0.68581 11.6052 1.12894C11.9081 1.47897 11.8687 2.05183 11.5761 2.4156C11.5052 2.50072 11.4295 2.58174 11.3494 2.65828C8.94914 5.0464 6.54751 7.43334 4.14452 9.81909C4.0819 9.87251 4.01519 9.92099 3.94498 9.96409C4.03554 10.0582 4.08722 10.1167 4.14145 10.1676C6.56048 12.5737 8.9795 14.9796 11.3985 17.3854C11.8298 17.8148 11.9613 18.3439 11.6385 18.7738C11.3346 19.1709 10.9778 19.5251 10.5779 19.8264C10.2074 20.1093 9.70807 20.0259 9.34174 19.7247C9.28648 19.6794 9.23276 19.6311 9.18211 19.5807L0.412125 10.8636C-0.0248138 10.4296 -0.119978 9.92084 0.153748 9.45024C0.222198 9.33957 0.304744 9.23817 0.399334 9.14854C3.33272 6.23165 6.26697 3.31661 9.20206 0.403448C9.37602 0.231995 9.61905 0.132787 9.8324 0H10.2642Z"
                      fill="#2B2B2B" />
                  </svg>
            
                  <h1>Search</h1>
            
            
                  <svg onclick="window.open('saved.html','_self')" width="15" height="20" viewBox="0 0 15 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M12.8569 0H2.14312C1.57629 0.00205569 1.03339 0.237205 0.633538 0.653854C0.233688 1.0705 0.00954761 1.63462 0.0102946 2.22244L0 20L7.5 16.6663L15 20V2.22244C14.9975 1.6338 14.771 1.06999 14.3696 0.653759C13.9682 0.237523 13.4245 0.00255379 12.8569 0V0Z"
                      fill="#2B2B2B" />
                  </svg>
                </div>
            
                <input type="text" id="recSearchBar" class="Username" value="" onkeyup="recSearch();" placeholder="Search Activities, Restaurants, Cafes" autocomplete="off">
            
                <div id="recSearch-results" class="searchcardscon">
                    <div style="position: relative; right: 5px;" class="sectionheader recentheader">
                        <h1>Recent Searches</h1>
                        <h3>Clear</h3>
                    </div>
                    <div id="recSearch-results-recent">
                        {% for i in range(recentSearches|length) %}
                        <div class="recentcards searchcard">
                            <div class="cardimg" style="background-image: url('{{recentInfo[i].Image_url}}');">
                            </div>
                    
                            <div class="cardinfo">
                                <h1 class="recentname">{{recentSearches[i].getPlaceName()}}</h1>
                                <div class="recenttype">
                                    <h3 class="recentcat">{{recentSearches[i].getCategory()}}</h3>
                                    <div class="rating">
                                        {% for rating in range(recentInfo[i]["Rating"]|round) %}
                                        <svg width="12" height="12" fill="none">
                                            <rect x="0.5" y="0.5" width="11" height="11" rx="1.5" stroke="#E4002B" />
                                        </svg>
                                        {% endfor %}
                                        {% for rating in range(5 - recentInfo[i]["Rating"]|round) %}
                                        <svg width="12" height="12" fill="none">
                                            <rect x="0.5" y="0.5" width="11" height="11" rx="1.5" stroke="#C4C4C4" />
                                        </svg>
                                        {% endfor %}
                                        <p class="ratingvalue">{{recentInfo[i]["Review_no"]}}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div style="position: relative; right: 5px;" class="sectionheader resultsheader" style="display: none;">
                        <h1>Results</h1>
                    </div>
                    <div id="recSearch-results-results" style="display: none;">

                    </div>
                </div>
            
            </div>
        </section>

        <div class="device" id="carddetails" style="position: absolute; z-index:12; background-color: white; display: none; bottom: -200vh;">
            <div class="cardimg" id="view-img">
                <svg onclick="closeViewPlace();" width="41" height="40" viewBox="0 0 41 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="0.664062" width="40" height="40" rx="5" fill="white"/>
                    <path d="M24.9283 10C25.5223 10.2035 25.8856 10.6858 26.2693 11.1289C26.5722 11.479 26.5328 12.0518 26.2401 12.4156C26.1693 12.5007 26.0936 12.5817 26.0135 12.6583C23.6132 15.0464 21.2116 17.4333 18.8086 19.8191C18.746 19.8725 18.6793 19.921 18.609 19.9641C18.6996 20.0582 18.7513 20.1167 18.8055 20.1676C21.2245 22.5737 23.6436 24.9796 26.0626 27.3854C26.4939 27.8148 26.6254 28.3439 26.3025 28.7738C25.9987 29.1709 25.6419 29.5251 25.2419 29.8264C24.8715 30.1093 24.3721 30.0259 24.0058 29.7247C23.9505 29.6794 23.8968 29.6311 23.8462 29.5807L15.0762 20.8636C14.6392 20.4296 14.5441 19.9208 14.8178 19.4502C14.8863 19.3396 14.9688 19.2382 15.0634 19.1485C17.9968 16.2316 20.931 13.3166 23.8661 10.4034C24.0401 10.232 24.2831 10.1328 24.4965 10H24.9283Z" fill="#2B2B2B"/>
                </svg>
            </div>
        
            <section class="cardhover">
                <div class="carddetailedinfo">
                    <div class="scrollhandle"></div>
            
                    <h1 id="view-name" class="cardname">Name</h1>
            
                    <div class="cardmaininfo">
                    <!-- rating -->
                    <div id="view-ratingBars-sm" class="rating">
                        <!-- full red -->
                        <svg width="12" height="12" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="#E4002B" stroke-width="3" />
                        <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="#E4002B" />
                        </svg>
            
                        <!-- full red -->
                        <svg width="12" height="12" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="#E4002B" stroke-width="3" />
                        <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="#E4002B" />
                        </svg>
            
                        <!-- half -->
                        <svg width="12" height="12" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="url(#paint0_linear_2171_1619)" stroke-width="3" />
                        <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="url(#paint1_linear_2171_1619)" />
                        <defs>
                            <linearGradient id="paint0_linear_2171_1619" x1="0" y1="20" x2="40" y2="20" gradientUnits="userSpaceOnUse">
                            <stop stop-color="#E4002B" />
                            <stop offset="0.484375" stop-color="#E4002B" />
                            <stop offset="0.515625" stop-color="#BBBBBB" />
                            <stop offset="1" stop-color="#BBBBBB" />
                            </linearGradient>
                            <linearGradient id="paint1_linear_2171_1619" x1="7.46094" y1="20" x2="32.4759" y2="20" gradientUnits="userSpaceOnUse">
                            <stop stop-color="#E4002B" />
                            <stop offset="0.484375" stop-color="#E4002B" />
                            <stop offset="0.515625" stop-color="#BBBBBB" />
                            <stop offset="1" stop-color="#BBBBBB" />
                            </linearGradient>
                        </defs>
                        </svg>
            
                        <!-- grey -->
                        <svg width="12" height="12" viewBox="0 0 41 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="2.05078" y="1.5" width="37" height="37" rx="3.5" stroke="#BBBBBB" stroke-width="3" />
                        <rect x="8.01172" y="7.5" width="25.015" height="25" rx="2" fill="#BBBBBB" />
                        </svg>
            
                        <!-- grey -->
                        <svg width="12" height="12" viewBox="0 0 41 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="2.05078" y="1.5" width="37" height="37" rx="3.5" stroke="#BBBBBB" stroke-width="3" />
                        <rect x="8.01172" y="7.5" width="25.015" height="25" rx="2" fill="#BBBBBB" />
                        </svg>
            
            
                        <p id="view-reviewNo-sm" class="ratingvalue">234</p>
                    </div>
            
                    <!-- dot -->
                    <svg width="6" height="6" viewBox="0 0 6 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="2.61328" cy="3.05103" r="2.5" fill="#2D2D2D" />
                    </svg>
            
                    <h1 id="view-price" class="cardaffordabilty">$$</h1>
            
                    <!-- dot -->
                    <svg width="6" height="6" viewBox="0 0 6 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="2.61328" cy="3.05103" r="2.5" fill="#2D2D2D" />
                    </svg>
            
                    <h1 id="view-category" class="cardcategory">Attraction</h1>
                    </div>
            
                    <!-- card location -->
                    <div class="cardlocation">
                    <svg width="16" height="22" viewBox="0 0 16 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                        d="M8.34766 0.551028C7.36252 0.550251 6.38689 0.739835 5.47659 1.10893C4.56629 1.47803 3.73919 2.0194 3.04259 2.70207C2.34599 3.38474 1.79358 4.19531 1.41695 5.08741C1.04032 5.97951 0.846866 6.93563 0.847659 7.90107C0.847659 13.4134 8.34766 21.551 8.34766 21.551C8.34766 21.551 15.8477 13.4134 15.8477 7.90107C15.8484 6.93563 15.655 5.97951 15.2784 5.08741C14.9017 4.19531 14.3493 3.38474 13.6527 2.70207C12.9561 2.0194 12.129 1.47803 11.2187 1.10893C10.3084 0.739835 9.33279 0.550251 8.34766 0.551028V0.551028ZM8.34766 10.5255C7.81782 10.5255 7.29989 10.3716 6.85935 10.0831C6.41881 9.79462 6.07545 9.3846 5.8727 8.90489C5.66994 8.42518 5.61689 7.89731 5.72025 7.38805C5.82362 6.87879 6.07876 6.411 6.4534 6.04385C6.82805 5.67669 7.30538 5.42665 7.82503 5.32535C8.34468 5.22406 8.88332 5.27605 9.37282 5.47475C9.86232 5.67345 10.2807 6.00995 10.5751 6.44168C10.8694 6.87341 11.0265 7.38099 11.0265 7.90023C11.0263 8.59643 10.744 9.26406 10.2417 9.75636C9.73932 10.2487 9.05807 10.5253 8.34766 10.5255V10.5255Z"
                        fill="#E4002B" />
                    </svg>
            
                    <h1 id="view-address">8 Sentosa Gateway, 098269</h1>
                    </div>
            
                    <!-- card opening -->
                    <div class="cardopening">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                        d="M8.34635 0.988525C6.86304 0.988785 5.41312 1.42887 4.17993 2.25314C2.94673 3.07741 1.98564 4.24884 1.41819 5.61931C0.850731 6.98977 0.702393 8.49773 0.99193 9.9525C1.28147 11.4073 1.99588 12.7435 3.04482 13.7923C4.09377 14.841 5.43014 15.5552 6.88496 15.8445C8.33978 16.1338 9.84772 15.9852 11.2181 15.4175C12.5885 14.8498 13.7597 13.8885 14.5838 12.6552C15.4078 11.4218 15.8477 9.97183 15.8477 8.48852C15.842 6.50093 15.0498 4.59639 13.6442 3.19106C12.2386 1.78574 10.3339 0.993883 8.34635 0.988525V0.988525ZM11.496 11.6381L7.59366 9.23859V4.7382H8.71843V8.63788L12.0934 10.6627L11.496 11.6381Z"
                        fill="#E4002B" />
                    </svg>
            
            
                    <h1 id="view-operatingHours">Opening 9.30am to 8.00pm</h1>
                    </div>
            
                    <!-- card number -->
                    <div class="cardnumber">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                        d="M15.0163 11.3061C14.0177 11.3049 13.0254 11.1466 12.0759 10.8371C11.9309 10.7882 11.7752 10.7811 11.6264 10.8167C11.4777 10.8522 11.3419 10.929 11.2348 11.0381L9.92691 12.6795C7.44277 11.4605 5.42677 9.45999 4.18792 6.98477L5.81185 5.60128C5.91909 5.49102 5.99442 5.3537 6.0298 5.20398C6.06518 5.05425 6.05928 4.89773 6.01275 4.75109C5.6994 3.80207 5.54111 2.80869 5.54398 1.80924C5.54102 1.59203 5.45328 1.38459 5.2995 1.23124C5.14571 1.07789 4.93809 0.990779 4.72097 0.988525H1.83875C1.38874 0.988525 0.847656 1.18952 0.847656 1.81326C0.878453 5.56324 2.38111 9.1509 5.0316 11.8026C7.6821 14.4544 11.2681 15.9577 15.0163 15.9885C15.1367 15.9827 15.2545 15.952 15.3624 15.8983C15.4703 15.8447 15.566 15.7694 15.6434 15.677C15.7208 15.5847 15.7783 15.4773 15.8122 15.3617C15.8462 15.246 15.8559 15.1246 15.8407 15.005V12.1302C15.8386 11.9121 15.751 11.7036 15.5969 11.5495C15.4427 11.3954 15.2343 11.308 15.0163 11.3061V11.3061Z"
                        fill="#E4002B" />
                    </svg>
            
                    <h1 id="view-phone">6577 8888</h1>
                    </div>
            
                    <!-- reviews -->
                    <div id="view-bottomSection" class="cardreviews">
                        <div class="sectionheader manyheadertags">
                            <div>
                            <h1>Reviews</h1>
                            </div>
                
                            <div class="view">
                            <h3>View All</h3>
                            </div>
                        </div>
            
                        <div class="ratingbig">
                            <div class="ratingbigdisplay">
                            <h1 id="view-rating">4.6</h1>
                
                            <!-- rating -->
                            <div class="rating" id="view-ratingBars">
                                <!-- full red -->
                                <svg width="20" height="20" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="#E4002B" stroke-width="3" />
                                <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="#E4002B" />
                                </svg>
                
                                <!-- full red -->
                                <svg width="20" height="20" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="#E4002B" stroke-width="3" />
                                <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="#E4002B" />
                                </svg>
                
                                <!-- half -->
                                <svg width="20" height="20" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="url(#paint0_linear_2171_1619)" stroke-width="3" />
                                <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="url(#paint1_linear_2171_1619)" />
                                <defs>
                                    <linearGradient id="paint0_linear_2171_1619" x1="0" y1="20" x2="40" y2="20" gradientUnits="userSpaceOnUse">
                                    <stop stop-color="#E4002B" />
                                    <stop offset="0.484375" stop-color="#E4002B" />
                                    <stop offset="0.515625" stop-color="#BBBBBB" />
                                    <stop offset="1" stop-color="#BBBBBB" />
                                    </linearGradient>
                                    <linearGradient id="paint1_linear_2171_1619" x1="7.46094" y1="20" x2="32.4759" y2="20" gradientUnits="userSpaceOnUse">
                                    <stop stop-color="#E4002B" />
                                    <stop offset="0.484375" stop-color="#E4002B" />
                                    <stop offset="0.515625" stop-color="#BBBBBB" />
                                    <stop offset="1" stop-color="#BBBBBB" />
                                    </linearGradient>
                                </defs>
                                </svg>
                
                                <!-- grey -->
                                <svg width="20" height="20" viewBox="0 0 41 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="2.05078" y="1.5" width="37" height="37" rx="3.5" stroke="#BBBBBB" stroke-width="3" />
                                <rect x="8.01172" y="7.5" width="25.015" height="25" rx="2" fill="#BBBBBB" />
                                </svg>
                
                                <!-- grey -->
                                <svg width="20" height="20" viewBox="0 0 41 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="2.05078" y="1.5" width="37" height="37" rx="3.5" stroke="#BBBBBB" stroke-width="3" />
                                <rect x="8.01172" y="7.5" width="25.015" height="25" rx="2" fill="#BBBBBB" />
                                </svg>
                            </div>
                
                            </div>
                
                            <div class="ratingsource">
                            <h2>Based on <span id="view-reviewNo">1</span> submitted reviews</h2>
                            </div>
                        </div>
            
            
                        <!-- review -->
                        <div class="review">
                            <!-- reviewer -->
                            <div class="reviewer">
                                <div class="reviewerdetails">
                                    <div class="reviewerimg"></div>
                    
                                    <div class="reviewerinfo">
                                    <p class="reviewername view-review-name">Swanson J.</p>
                                    <p class="reviewercountry">Singapore</p>
                                    </div>
                                </div>
                    
                                <div class="revieweredit">
                                    <svg width="5" height="20" viewBox="0 0 5 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="2.5" cy="3.48846" r="2.5" fill="#707070" />
                                    <circle cx="2.5" cy="17.4885" r="2.5" fill="#707070" />
                                    <circle cx="2.5" cy="10.4885" r="2.5" fill="#707070" />
                                    </svg>
                    
                                </div>
                            </div>
                    
                            <div class="reviewerreview view-review-desc">
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco...</p>
                            </div>
                
                            <div class="reviewbottom">
                                <div class="reviewsubmitted">
                                    <p>Submitted 8/4/2022</p>
                                </div>
                            </div>
                        </div>

                    </div>
            
            
                    <!-- youmightlike -->
                    <div class="youmightlike">
                        <h1>You Might Also Like</h1>
                        </div>
                
                        <div id="trackedInfoCards" class="youmightlikecon">
                
                        <!-- youmightlikecards -->
                        <div class="youmightlikecards">
                            <div class="cardimg"></div>
                
                            <div class="cardinfo">
                            <h1 class="youmightlikename">VeganBurg Singapore</h1>
                            <div class="youmightliketype">
                
                                <div class="youmightlikecategory">
                                <h2>Restaurant</h2>
                                <svg width="3" height="3" viewBox="0 0 3 3" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <ellipse cx="1.03093" cy="1.98846" rx="1.03093" ry="1" fill="#707070" />
                                </svg>
                                <h2>fusion</h2>
                                <svg width="3" height="3" viewBox="0 0 3 3" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <ellipse cx="1.03093" cy="1.98846" rx="1.03093" ry="1" fill="#707070" />
                                </svg>
                                <h2>$$</h2>
                
                                </div>
                                <!-- rating -->
                                <div class="rating">
                                <!-- full red -->
                                <svg width="12" height="12" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="#E4002B" stroke-width="3" />
                                    <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="#E4002B" />
                                </svg>
                
                                <!-- full red -->
                                <svg width="12" height="12" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="#E4002B" stroke-width="3" />
                                    <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="#E4002B" />
                                </svg>
                
                                <!-- half -->
                                <svg width="12" height="12" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="url(#paint0_linear_2171_1619)" stroke-width="3" />
                                    <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="url(#paint1_linear_2171_1619)" />
                                    <defs>
                                    <linearGradient id="paint0_linear_2171_1619" x1="0" y1="20" x2="40" y2="20" gradientUnits="userSpaceOnUse">
                                        <stop stop-color="#E4002B" />
                                        <stop offset="0.484375" stop-color="#E4002B" />
                                        <stop offset="0.515625" stop-color="#BBBBBB" />
                                        <stop offset="1" stop-color="#BBBBBB" />
                                    </linearGradient>
                                    <linearGradient id="paint1_linear_2171_1619" x1="7.46094" y1="20" x2="32.4759" y2="20" gradientUnits="userSpaceOnUse">
                                        <stop stop-color="#E4002B" />
                                        <stop offset="0.484375" stop-color="#E4002B" />
                                        <stop offset="0.515625" stop-color="#BBBBBB" />
                                        <stop offset="1" stop-color="#BBBBBB" />
                                    </linearGradient>
                                    </defs>
                                </svg>
                
                                <!-- grey -->
                                <svg width="12" height="12" viewBox="0 0 41 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="2.05078" y="1.5" width="37" height="37" rx="3.5" stroke="#BBBBBB" stroke-width="3" />
                                    <rect x="8.01172" y="7.5" width="25.015" height="25" rx="2" fill="#BBBBBB" />
                                </svg>
                
                                <!-- grey -->
                                <svg width="12" height="12" viewBox="0 0 41 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="2.05078" y="1.5" width="37" height="37" rx="3.5" stroke="#BBBBBB" stroke-width="3" />
                                    <rect x="8.01172" y="7.5" width="25.015" height="25" rx="2" fill="#BBBBBB" />
                                </svg>
                
                
                                <p class="ratingvalue">234</p>
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>
            
                </div>
        
            </section>
            
            <!-- bottom -->
            <section class="bottom">
                <div id="addItineraryBtn" class="maincta">
                    <h1>Add To Itinerary</h1>
                </div>
            </section>
        </div>
    </div>

    <!-- Map View -->
    <div class="device" id="mapView" style="position: absolute; z-index: 0; display: none;">
        <div id='mapdiv' style='height:100vh;'></div>

        <svg style="z-index: 5;" class="back" width="12" height="21" viewBox="0 0 12 21" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path onclick="dismissMapView();"
                d="M10.3111 0.5C10.9051 0.703504 11.2684 1.18581 11.6521 1.62894C11.955 1.97897 11.9156 2.55183 11.6229 2.9156C11.5521 3.00072 11.4764 3.08174 11.3963 3.15828C8.99602 5.5464 6.59439 7.93334 4.1914 10.3191C4.12878 10.3725 4.06206 10.421 3.99186 10.4641C4.08242 10.5582 4.13409 10.6167 4.18833 10.6676C6.60735 13.0737 9.02637 15.4796 11.4454 17.8854C11.8767 18.3148 12.0082 18.8439 11.6854 19.2738C11.3815 19.6709 11.0247 20.0251 10.6247 20.3264C10.2543 20.6093 9.75495 20.5259 9.38861 20.2247C9.33336 20.1794 9.27963 20.1311 9.22898 20.0807L0.459 11.3636C0.0220612 10.9296 -0.0731035 10.4208 0.200623 9.95024C0.269073 9.83957 0.351619 9.73817 0.446209 9.64854C3.3796 6.73165 6.31384 3.81661 9.24894 0.903448C9.42289 0.731995 9.66592 0.632787 9.87927 0.5H10.3111Z"
                fill="#FFFFFF" />
        </svg>
        
        
        <div class="mapbuttons" style="z-index: 5;">
            <div class="qrcodescanner" onclick="window.open('/qr-scanner','_self')">
                <img src="../../static/images/qrscanner.png" alt="">
            </div>
    
            <div class="currentlocation">
                <img src="../../static/images/currentlocation.png" alt="">
            </div>
        </div>
        
        <section>
            <div class="mapdetailscon" id="map-selection">

            </div>
        </section>
    </div>

    <!-- Popup -->
    <div id="changesPopup" style="display: none; position: absolute; z-index:5; top: 50%;">
        <p id="changes-text">You've changed the starting date of your itinerary. What action do you wish to perform ?</p>
        <p class="text-primary" onclick="dateChangesAction(1)">Leave itinerary in their respective pages</p>
        <p class="text-danger" onclick="dateChangesAction(2)">Reset itinerary</p>
    </div>

</div>
{% endblock %}

{% block scripts %}
{{super()}}
<script>
    const apiKey = "{{apiKey}}";
    var skipped = [0];
    var pendingChooseList = {};
    var startTime = new Date("2022-01-01T08:00:00");
    var originalDuration;
    const currentTime = new Date();

    var requests = [];
    var cardEdit;

    function initFunctions() {
        getLocation();
        const todayDate = currentTime.toISOString().split("T")[0]
        document.getElementById("startDate").min = todayDate;
        document.getElementById("startDate").value = todayDate;

        document.getElementById("endDate").min = todayDate;

        toggleDay(0);
        initAllowance();
        reAssignValues();
        displayRouteDetails();
    }
    function initAllowance() {
        // Set time allowance
        var startTmeArr = ["08", "00"];
        var endTmeArr = ["23", "59"];
        var startDate = new Date(0, 0, 0, startTmeArr[0], startTmeArr[1], 0);
        var endDate = new Date(0, 0, 0, endTmeArr[0], endTmeArr[1], 0);
        var diff = endDate.getTime() - startDate.getTime();
        var allowanceLeft = Math.floor(diff / 1000 / 60);

        var allSections = document.getElementsByClassName("planSection");
        for (var i=0; i<allSections.length; i++) {
            if (allSections[i].querySelector(".time-left").querySelector("span").innerText.length > 0)
                allSections[i].querySelector(".time-left").querySelector("span").innerText = allowanceLeft;
        }
    }

    function openInitPage() {
        $("#initForm").show();
        $("#initForm").animate({
            top: "0",
            bottom: "0"
        });
        checkInitPage();
    }
    function closeInitPage() {
        // Pull form down
        $("#initForm").animate({
            bottom: "-200vh"
        }, 350, function() {
            $("#initForm").hide();
        });
        $("#planPage").show();
    }

    function checkInitPage() {
        console.log("Here")
        var valid = true;
        var initDiv = document.getElementById("initForm");
        var allInps = initDiv.getElementsByTagName("input");
        var nextBtn = document.getElementById("initPageNext");

        for (var i=0; i<allInps.length; i++) {
            if (allInps[i].id != "description") {
                if (allInps[i].value.trim() == "") {
                    valid = false;
                    break;
                }
            }
        }

        var startDateVal = $("#startDate").val();
        if (isNaN(Date.parse(startDateVal)))
            valid = false;
        if (isNaN(Date.parse(endDate.value)))
            valid = false;

        if (valid) {
            nextBtn.setAttribute("onclick", "dismissInit();")
            nextBtn.classList.remove("maincta-disabled");
            nextBtn.classList.add("maincta");
        }
        else {
            nextBtn.removeAttribute("onclick");
            nextBtn.classList.remove("maincta");
            nextBtn.classList.add("maincta-disabled");
        }
    }
    var oldVal;
    function checkResetEndDate() {
        var startDateVal = $("#startDate").val();
        var endDateVal = $("#endDate").val();

        if (startDateVal.trim()) {
            if (startDateVal != oldVal) {
                $("#endDate").val("");
                $("#endDate").attr("min", new Date(startDateVal).toISOString().split("T")[0]);
                oldVal = startDateVal;
            }
        }
    }
    async function dismissInit() {
        var initDiv = document.getElementById("initForm");
        var datesDiv = document.getElementById("dates-selection").querySelector("ul");
        var plansDiv = document.getElementById("planPage");
        var startDate = new Date($("#startDate").val());
        var endDate = new Date($("#endDate").val());

        var days = Math.ceil((endDate.getTime() - startDate.getTime()) / (1000 * 3600 * 24)) + 1;
        var dateCards = [].slice.call(document.getElementsByClassName("card-date"));
        var diff = days - dateCards.length;
        
        if (dateCards.length > 0) {
            // Prompt for action
            if (startDate > new Date(dateCards[0].querySelector("h1").querySelector("span").innerText)) {
                $("#changesPopup").fadeIn(150);
            }

            datesDiv.innerHTML = 
            `<li class="inactivedate" id="card-date-add" onclick="openInitPage();">
                <h1>+ Add day</h1>
            </li>`;
        }

        // Pull form down
        closeInitPage();

        var checkDate = startDate;
        for (var i=0; i<days; i++) {
            await new Promise(resolve => setTimeout(resolve, 150));
            console.log(checkDate.getDate())
            var cardDate = new DOMParser().parseFromString(`
            <li class="inactivedate card-date" onclick="toggleDay(this);">
                <h1>${checkDate.getDate()}/${('0' + checkDate.getMonth()).slice(-2)}<span hidden>${checkDate.getFullYear()}-${('0' + checkDate.getMonth()).slice(-2)}-${('0' + checkDate.getDate()).slice(-2)}</span></h1>
                <p class="tm-selection">
                    <a data-toggle="collapse" href="#tmdropdown-${i}"><svg width="36" height="19" viewBox="0 0 36 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.7709 2.05692C17.6584 1.72085 17.4456 1.42933 17.1626 1.22344C16.8795 1.01754 16.5405 0.907635 16.1931 0.909196H3.97092C3.62382 0.908654 3.28521 1.01896 3.00236 1.22471C2.71951 1.43047 2.50653 1.72141 2.39314 2.05692L0.0820312 8.86373V17.9546C0.0820313 18.256 0.199094 18.5451 0.407468 18.7582C0.615842 18.9713 0.898457 19.091 1.19314 19.091H2.30425C2.59894 19.091 2.88155 18.9713 3.08993 18.7582C3.2983 18.5451 3.41536 18.256 3.41536 17.9546V16.8183H16.7487V17.9546C16.7487 18.256 16.8658 18.5451 17.0741 18.7582C17.2825 18.9713 17.5651 19.091 17.8598 19.091H18.9709C19.2656 19.091 19.5482 18.9713 19.7566 18.7582C19.965 18.5451 20.082 18.256 20.082 17.9546V8.86373L17.7709 2.05692ZM3.97092 13.4092C3.64128 13.4092 3.31905 13.3092 3.04497 13.1219C2.77089 12.9346 2.55727 12.6684 2.43112 12.3569C2.30497 12.0455 2.27197 11.7027 2.33628 11.3721C2.40059 11.0415 2.55932 10.7377 2.79241 10.4993C3.0255 10.261 3.32247 10.0986 3.64577 10.0328C3.96907 9.96708 4.30418 10.0008 4.60873 10.1298C4.91327 10.2589 5.17357 10.4773 5.3567 10.7576C5.53984 11.038 5.63759 11.3675 5.63759 11.7046C5.63759 12.1567 5.46199 12.5903 5.14943 12.9099C4.83687 13.2296 4.41295 13.4092 3.97092 13.4092ZM16.1931 13.4092C15.8635 13.4092 15.5413 13.3092 15.2672 13.1219C14.9931 12.9346 14.7795 12.6684 14.6533 12.3569C14.5272 12.0455 14.4942 11.7027 14.5585 11.3721C14.6228 11.0415 14.7815 10.7377 15.0146 10.4993C15.2477 10.261 15.5447 10.0986 15.868 10.0328C16.1913 9.96708 16.5264 10.0008 16.8309 10.1298C17.1355 10.2589 17.3958 10.4773 17.5789 10.7576C17.7621 11.038 17.8598 11.3675 17.8598 11.7046C17.8598 12.1567 17.6842 12.5903 17.3717 12.9099C17.0591 13.2296 16.6352 13.4092 16.1931 13.4092ZM2.30425 7.72737L3.97092 2.61374H16.1931L17.8598 7.72737H2.30425Z" 
                        fill="white"/>
                        <path
                            d="M25.168 9.30594C25.2697 8.9918 25.5109 8.79969 25.7324 8.59675C25.9075 8.43657 26.1939 8.45741 26.3758 8.61218C26.4183 8.64964 26.4588 8.68966 26.4971 8.73204C27.6912 10.0014 28.8846 11.2715 30.0775 12.5423C30.1042 12.5754 30.1285 12.6107 30.15 12.6478C30.1971 12.5999 30.2263 12.5726 30.2518 12.5439C31.4548 11.2646 32.6578 9.98536 33.8607 8.70607C34.0754 8.47797 34.3399 8.40843 34.5549 8.57917C34.7534 8.73985 34.9305 8.92855 35.0812 9.14007C35.2226 9.33597 35.1809 9.60006 35.0303 9.79379C35.0077 9.82301 34.9835 9.85142 34.9583 9.87821L30.5998 14.5162C30.3828 14.7473 30.1284 14.7976 29.8931 14.6528C29.8378 14.6166 29.7871 14.573 29.7422 14.5229C28.2838 12.9716 26.8263 11.4199 25.3697 9.86766C25.284 9.77566 25.2344 9.64714 25.168 9.53431L25.168 9.30594Z"
                            fill="white" />
                    </svg></a>
                    <span hidden>drive</span>
                </p>

                <ul id="tmdropdown-${i}" class="plannerdatestransport tm-dropdown collapse">
                    <li onclick="chooseTransportMode(this);">
                        <svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.7709 2.05692C17.6584 1.72085 17.4456 1.42933 17.1626 1.22344C16.8795 1.01754 16.5405 0.907635 16.1931 0.909196H3.97092C3.62382 0.908654 3.28521 1.01896 3.00236 1.22471C2.71951 1.43047 2.50653 1.72141 2.39314 2.05692L0.0820312 8.86373V17.9546C0.0820313 18.256 0.199094 18.5451 0.407468 18.7582C0.615842 18.9713 0.898457 19.091 1.19314 19.091H2.30425C2.59894 19.091 2.88155 18.9713 3.08993 18.7582C3.2983 18.5451 3.41536 18.256 3.41536 17.9546V16.8183H16.7487V17.9546C16.7487 18.256 16.8658 18.5451 17.0741 18.7582C17.2825 18.9713 17.5651 19.091 17.8598 19.091H18.9709C19.2656 19.091 19.5482 18.9713 19.7566 18.7582C19.965 18.5451 20.082 18.256 20.082 17.9546V8.86373L17.7709 2.05692ZM3.97092 13.4092C3.64128 13.4092 3.31905 13.3092 3.04497 13.1219C2.77089 12.9346 2.55727 12.6684 2.43112 12.3569C2.30497 12.0455 2.27197 11.7027 2.33628 11.3721C2.40059 11.0415 2.55932 10.7377 2.79241 10.4993C3.0255 10.261 3.32247 10.0986 3.64577 10.0328C3.96907 9.96708 4.30418 10.0008 4.60873 10.1298C4.91327 10.2589 5.17357 10.4773 5.3567 10.7576C5.53984 11.038 5.63759 11.3675 5.63759 11.7046C5.63759 12.1567 5.46199 12.5903 5.14943 12.9099C4.83687 13.2296 4.41295 13.4092 3.97092 13.4092ZM16.1931 13.4092C15.8635 13.4092 15.5413 13.3092 15.2672 13.1219C14.9931 12.9346 14.7795 12.6684 14.6533 12.3569C14.5272 12.0455 14.4942 11.7027 14.5585 11.3721C14.6228 11.0415 14.7815 10.7377 15.0146 10.4993C15.2477 10.261 15.5447 10.0986 15.868 10.0328C16.1913 9.96708 16.5264 10.0008 16.8309 10.1298C17.1355 10.2589 17.3958 10.4773 17.5789 10.7576C17.7621 11.038 17.8598 11.3675 17.8598 11.7046C17.8598 12.1567 17.6842 12.5903 17.3717 12.9099C17.0591 13.2296 16.6352 13.4092 16.1931 13.4092ZM2.30425 7.72737L3.97092 2.61374H16.1931L17.8598 7.72737H2.30425Z" 
                            fill="#BBBBBB"/>
                        </svg>
                        <span hidden>drive</span></li>
                    <li onclick="chooseTransportMode(this);">
                        <svg width="21" height="25" viewBox="0 0 21 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M0.0820312 18.125C0.0820313 19.2853 0.542968 20.3981 1.36344 21.2186C2.18391 22.0391 3.29671 22.5 4.45703 22.5L2.58203 24.375V25H17.582V24.375L15.707 22.5C16.8674 22.5 17.9802 22.0391 18.8006 21.2186C19.6211 20.3981 20.082 19.2853 20.082 18.125V5C20.082 0.625 15.607 0 10.082 0C4.55703 0 0.0820312 0.625 0.0820312 5V18.125ZM10.082 20C9.58758 20 9.10423 19.8534 8.69311 19.5787C8.28198 19.304 7.96155 18.9135 7.77233 18.4567C7.58311 17.9999 7.5336 17.4972 7.63007 17.0123C7.72653 16.5273 7.96463 16.0819 8.31426 15.7322C8.6639 15.3826 9.10935 15.1445 9.59431 15.048C10.0793 14.9516 10.5819 15.0011 11.0387 15.1903C11.4956 15.3795 11.886 15.7 12.1607 16.1111C12.4354 16.5222 12.582 17.0055 12.582 17.5C12.5801 18.1624 12.316 18.7972 11.8476 19.2656C11.3792 19.734 10.7445 19.998 10.082 20ZM17.582 11.25H2.58203V5H17.582V11.25Z"
                            fill="#BBBBBB" />
                        </svg>
                        <span hidden>pt</span></li>
                    <li onclick="chooseTransportMode(this);">
                        <svg width="18" height="24" viewBox="0 0 18 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                            d="M16.1119 23.5294C15.2677 23.1777 15.0851 22.9022 15.0851 21.9814C15.0851 21.6783 15.0851 21.3745 15.0851 21.07H5.08093C5.08093 21.4784 5.07946 21.8673 5.08093 22.2568C5.08239 22.5664 5.01418 22.8702 4.78241 23.0744C4.57118 23.2612 4.29908 23.3804 4.05411 23.5294H2.33858C1.53473 23.2641 1.28243 22.6776 1.32643 21.8876C1.3565 21.3454 1.33743 20.8011 1.32717 20.2575C1.3257 20.1623 1.28389 20.0431 1.21788 19.9784C0.449234 19.2189 0.0832465 18.2981 0.082513 17.2304C0.0817796 13.1656 0.0817796 9.10071 0.0832465 5.03585C0.0832465 4.25384 0.202798 3.49509 0.587855 2.79811C1.14601 1.78498 2.06281 1.2181 3.11383 0.827091C4.34748 0.368495 5.64054 0.189708 6.9446 0.108309C9.33783 -0.0406804 11.7325 -0.0566694 14.1206 0.192615C15.3528 0.321254 16.5637 0.552369 17.6895 1.09818C18.4318 1.45793 19.0655 1.94487 19.4982 2.65857C19.9419 3.39043 20.0813 4.19715 20.082 5.03585C20.082 9.10071 20.082 13.1656 20.082 17.2312C20.082 18.3003 19.716 19.2189 18.9489 19.9784C18.8829 20.0438 18.841 20.163 18.8396 20.2575C18.83 20.9007 18.8352 21.5431 18.8344 22.1863C18.8337 22.7387 18.61 23.1617 18.0981 23.4131C18.0101 23.456 17.9184 23.4909 17.8282 23.5294H16.1119ZM2.59235 4.97699V11.1328H17.5744V4.97699H2.59235ZM4.46483 18.5713C5.49679 18.5684 6.33365 17.7348 6.32998 16.7137C6.32558 15.694 5.47625 14.8561 4.4553 14.8641C3.42701 14.872 2.57915 15.7166 2.58649 16.7246C2.59382 17.745 3.43801 18.575 4.46557 18.5713H4.46483ZM15.7034 18.5713C16.7302 18.5735 17.5751 17.7421 17.581 16.7231C17.5869 15.7137 16.739 14.8706 15.7114 14.8641C14.6898 14.8575 13.8404 15.6962 13.8375 16.7152C13.8338 17.7355 14.6722 18.5692 15.7034 18.5713Z"
                            fill="#BBBBBB" />
                        </svg>
                        <span hidden>bus</span></li>
                    <li onclick="chooseTransportMode(this);">
                        <svg width="24" height="20" viewBox="0 0 24 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                            d="M11.7746 4.46512C12.1923 4.46512 12.6005 4.33418 12.9478 4.08886C13.2951 3.84355 13.5658 3.49487 13.7256 3.08692C13.8855 2.67898 13.9273 2.23008 13.8458 1.79701C13.7643 1.36393 13.5632 0.966131 13.2678 0.653902C12.9725 0.341673 12.5962 0.129043 12.1866 0.042899C11.7769 -0.0432448 11.3523 0.000967325 10.9664 0.169944C10.5805 0.338921 10.2507 0.625074 10.0187 0.992216C9.78663 1.35936 9.66278 1.791 9.66278 2.23256C9.66445 2.82413 9.88748 3.39096 10.2832 3.80926C10.6788 4.22757 11.215 4.46335 11.7746 4.46512V4.46512ZM7.97334 19.9814L9.02924 15.0698L11.2466 17.3023V24H13.3584V15.6279L11.141 13.3954L11.7746 10.0465C12.4991 10.9217 13.3919 11.6234 14.3933 12.1046C15.3948 12.5859 16.4819 12.8356 17.582 12.8372V10.6047C16.6693 10.6193 15.769 10.3794 14.9719 9.90902C14.1748 9.43868 13.509 8.75456 13.0417 7.92558L11.9858 6.13954C11.7986 5.80975 11.5362 5.53479 11.2227 5.33979C10.9091 5.1448 10.5543 5.03597 10.1907 5.02326C9.87396 5.02326 9.66278 5.13488 9.34601 5.13488L3.85532 7.5907V12.8372H5.96712V9.04186L7.86774 8.26047L6.1783 17.3023L1.00439 16.186L0.582031 18.4186L7.97334 19.9814Z"
                            fill="#BBBBBB" />
                        </svg>
                        <span hidden>walk</span></li>
                    <li onclick="chooseTransportMode(this);">
                        <svg width="21" height="24" viewBox="0 0 21 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                            d="M15.4969 3.90244C15.8829 3.90244 16.2601 3.788 16.581 3.5736C16.9019 3.3592 17.152 3.05446 17.2996 2.69792C17.4473 2.34138 17.486 1.94906 17.4107 1.57056C17.3354 1.19206 17.1496 0.844382 16.8767 0.5715C16.6038 0.298617 16.2561 0.112781 15.8776 0.037493C15.4991 -0.0377952 15.1068 0.000845426 14.7502 0.148529C14.3937 0.296212 14.089 0.546304 13.8746 0.867181C13.6602 1.18806 13.5457 1.56531 13.5457 1.95122C13.5473 2.46824 13.7533 2.96364 14.1189 3.32923C14.4845 3.69483 14.9799 3.9009 15.4969 3.90244V3.90244ZM5.25305 10.2439C3.95931 10.2439 2.71856 10.7578 1.80375 11.6726C0.888936 12.5875 0.375 13.8282 0.375 15.1219C0.375 16.4157 0.888936 17.6564 1.80375 18.5712C2.71856 19.4861 3.95931 20 5.25305 20C6.54679 20 7.78754 19.4861 8.70235 18.5712C9.61716 17.6564 10.1311 16.4157 10.1311 15.1219C10.1311 13.8282 9.61716 12.5875 8.70235 11.6726C7.78754 10.7578 6.54679 10.2439 5.25305 10.2439ZM5.25305 18.5366C4.34743 18.5366 3.47891 18.1768 2.83854 17.5365C2.19817 16.8961 1.83841 16.0276 1.83841 15.1219C1.83841 14.2163 2.19817 13.3478 2.83854 12.7074C3.47891 12.0671 4.34743 11.7073 5.25305 11.7073C6.15866 11.7073 7.02719 12.0671 7.66756 12.7074C8.30793 13.3478 8.66768 14.2163 8.66768 15.1219C8.66768 16.0276 8.30793 16.8961 7.66756 17.5365C7.02719 18.1768 6.15866 18.5366 5.25305 18.5366ZM10.9116 8.78049L13.253 6.43902L14.0335 7.21951C14.6811 7.87989 15.456 8.40196 16.3112 8.75412C17.1665 9.10628 18.0843 9.2812 19.0091 9.26829V7.31707C18.3553 7.32268 17.707 7.19592 17.1034 6.94442C16.4998 6.69292 15.9534 6.32189 15.4969 5.85366L13.6433 4C13.21 3.62402 12.656 3.41627 12.0823 3.41463C11.8246 3.39755 11.5665 3.44168 11.3291 3.54341C11.0918 3.64515 10.8818 3.80161 10.7165 4L7.98475 6.73171C7.80159 6.90926 7.65552 7.12143 7.55503 7.3559C7.45454 7.59037 7.40164 7.84247 7.39939 8.09756C7.3823 8.35526 7.42643 8.61335 7.52817 8.85073C7.6299 9.08812 7.78636 9.29806 7.98475 9.46341L11.1067 12.1951V17.0732H13.0579V11.0244L10.9116 8.78049ZM18.9116 10.2439C17.9468 10.2439 17.0037 10.53 16.2015 11.066C15.3993 11.602 14.7741 12.3639 14.4049 13.2552C14.0356 14.1465 13.939 15.1274 14.1273 16.0736C14.3155 17.0199 14.7801 17.889 15.4623 18.5712C16.1445 19.2535 17.0137 19.718 17.9599 19.9063C18.9062 20.0945 19.887 19.9979 20.7783 19.6287C21.6697 19.2595 22.4315 18.6342 22.9675 17.832C23.5035 17.0299 23.7896 16.0867 23.7896 15.1219C23.796 14.4796 23.6742 13.8424 23.4313 13.2477C23.1884 12.653 22.8294 12.1127 22.3751 11.6584C21.9209 11.2042 21.3806 10.8451 20.7859 10.6022C20.1911 10.3593 19.554 10.2375 18.9116 10.2439V10.2439ZM18.9116 18.5366C18.2362 18.5366 17.576 18.3363 17.0145 17.9611C16.453 17.5859 16.0153 17.0526 15.7569 16.4287C15.4984 15.8047 15.4308 15.1182 15.5626 14.4558C15.6943 13.7934 16.0195 13.185 16.4971 12.7074C16.9746 12.2299 17.583 11.9047 18.2454 11.7729C18.9078 11.6412 19.5944 11.7088 20.2183 11.9672C20.8422 12.2257 21.3755 12.6633 21.7507 13.2249C22.1259 13.7864 22.3262 14.4466 22.3262 15.1219C22.3153 16.0242 21.9521 16.8864 21.3141 17.5244C20.676 18.1624 19.8138 18.5257 18.9116 18.5366V18.5366Z"
                            fill="#BBBBBB" />
                        </svg>
                        <span hidden>cycle</span></li>
                </ul>
            </li>`, "text/html").body.firstElementChild;

            datesDiv.insertBefore(cardDate, document.querySelector("#card-date-add"));
            checkDate.setDate(checkDate.getDate() + 1);  
        }

        datesDiv.querySelector(".card-date").classList.remove("inactivedate");
        datesDiv.querySelector(".card-date").classList.add("activedate");

        // Add days card
        var plansSec = new DOMParser().parseFromString(
            `<div class="planSection" style="display: none;">
                <section class="req-info" hidden>
                    <div class="time-left">Duration left: <span></span></div>
                </section>

                <div class="recommendation-listings plannertripitinerary" style="overflow-y: scroll;">
                    <div class="plannerend start" onclick="openSearch(this, 1);">
                        <div class="plannerendpoint">
                            <svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                d="M0.888672 15.5C0.888672 12.5333 1.76841 9.63319 3.41663 7.16645C5.06485 4.69972 7.40753 2.77713 10.1484 1.64181C12.8893 0.506499 15.9053 0.209449 18.815 0.788228C21.7247 1.36701 24.3975 2.79562 26.4953 4.8934C28.5931 6.99119 30.0217 9.66394 30.6004 12.5737C31.1792 15.4834 30.8822 18.4994 29.7469 21.2403C28.6115 23.9811 26.689 26.3238 24.2222 27.972C21.7555 29.6203 18.8554 30.5 15.8887 30.5C13.9188 30.5 11.9683 30.112 10.1484 29.3582C8.32853 28.6044 6.67495 27.4995 5.28207 26.1066C2.46902 23.2936 0.888672 19.4783 0.888672 15.5ZM15.8887 24.5C17.6687 24.5 19.4088 23.9722 20.8888 22.9832C22.3688 21.9943 23.5224 20.5887 24.2036 18.9442C24.8848 17.2996 25.063 15.49 24.7157 13.7442C24.3685 11.9984 23.5113 10.3947 22.2526 9.13604C20.994 7.87737 19.3903 7.0202 17.6445 6.67294C15.8987 6.32567 14.0891 6.5039 12.4445 7.18509C10.8 7.86628 9.39438 9.01983 8.40544 10.4999C7.41651 11.9799 6.88867 13.72 6.88867 15.5C6.88867 17.887 7.83688 20.1761 9.52471 21.864C11.2125 23.5518 13.5017 24.5 15.8887 24.5Z"
                                fill="#06A122" />
                            </svg>
                            <h2 class="inactiveinput">Add Start-Off Point</h2>
                        </div>
                
                        <!-- addlocation -->
                        <svg class="addlocation" width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="2.22656" y="2" width="26" height="26" rx="5" fill="white" />
                            <path
                            d="M26.8842 3.66314e-06H3.56402C2.67887 3.66314e-06 1.82997 0.351656 1.20408 0.977601C0.578186 1.60355 0.226563 2.45251 0.226562 3.33773V26.6647C0.226563 27.5499 0.578186 28.3989 1.20408 29.0248C1.82997 29.6508 2.67887 30.0024 3.56402 30.0024H26.8891C27.7743 30.0024 28.6231 29.6508 29.249 29.0248C29.8749 28.3989 30.2266 27.5499 30.2266 26.6647V3.33773C30.2266 2.899 30.1401 2.46457 29.972 2.05929C29.804 1.65402 29.5577 1.28585 29.2473 0.975851C28.9369 0.66585 28.5684 0.420098 28.1629 0.252652C27.7574 0.0852068 27.3229 -0.000646311 26.8842 3.66314e-06ZM23.5467 16.6627H16.8879V23.327H13.5504V16.6627H6.89034V13.3249H13.5541V6.66433H16.8916V13.3287H23.5517L23.5467 16.6627Z"
                            fill="#2B2B2B" />
                        </svg>
                    </div>
                </div>
            </div>`, "text/html").body.firstElementChild;
        var allSections = document.getElementsByClassName("planSection");
        for (var i=0; i<Math.abs(diff); i++) {
            if (diff > 0) {
                var clonedPlansSec = plansSec.cloneNode(true);
                clonedPlansSec.style.display = "none";
                clonedPlansSec.querySelector(".start").setAttribute("onclick", `openSearch(this, '${i+1}');`)
                plansDiv.appendChild(clonedPlansSec);
            }
            else if (diff < 0) {
                // TODO: Change query selector h5 change in the future
                if (startDate > new Date(dateCards[0].querySelector("h5").innerText)) {
                    allSections[i].remove();
                }
                else {
                    allSections[dateCards.length-1].remove();
                }
            }
        }

        $("#editplannertrip").show();
        plansDiv.querySelector(".planSection").style.display = "block";
        initAllowance();

        saveTrips();
    }

    function dateChangesAction(actionNum) {
        if (actionNum == 2) {
            var div = document.getElementsByClassName("recommendation-listings");
            for (i=0; i<div.length; i++) {
                div.innerHTML = 
                `<div class="planSection" style="display: none;">
                    <section class="req-info" hidden>
                        <div class="time-left">Duration left: <span></span></div>
                    </section>

                    <div class="recommendation-listings plannertripitinerary" style="overflow-y: scroll;">
                        <div class="plannerend start" onclick="openSearch(this, ${i+1});">
                            <div class="plannerendpoint">
                                <svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                    d="M0.888672 15.5C0.888672 12.5333 1.76841 9.63319 3.41663 7.16645C5.06485 4.69972 7.40753 2.77713 10.1484 1.64181C12.8893 0.506499 15.9053 0.209449 18.815 0.788228C21.7247 1.36701 24.3975 2.79562 26.4953 4.8934C28.5931 6.99119 30.0217 9.66394 30.6004 12.5737C31.1792 15.4834 30.8822 18.4994 29.7469 21.2403C28.6115 23.9811 26.689 26.3238 24.2222 27.972C21.7555 29.6203 18.8554 30.5 15.8887 30.5C13.9188 30.5 11.9683 30.112 10.1484 29.3582C8.32853 28.6044 6.67495 27.4995 5.28207 26.1066C2.46902 23.2936 0.888672 19.4783 0.888672 15.5ZM15.8887 24.5C17.6687 24.5 19.4088 23.9722 20.8888 22.9832C22.3688 21.9943 23.5224 20.5887 24.2036 18.9442C24.8848 17.2996 25.063 15.49 24.7157 13.7442C24.3685 11.9984 23.5113 10.3947 22.2526 9.13604C20.994 7.87737 19.3903 7.0202 17.6445 6.67294C15.8987 6.32567 14.0891 6.5039 12.4445 7.18509C10.8 7.86628 9.39438 9.01983 8.40544 10.4999C7.41651 11.9799 6.88867 13.72 6.88867 15.5C6.88867 17.887 7.83688 20.1761 9.52471 21.864C11.2125 23.5518 13.5017 24.5 15.8887 24.5Z"
                                    fill="#06A122" />
                                </svg>
                                <h2 class="inactiveinput">Add Start-Off Point</h2>
                            </div>
                    
                            <!-- addlocation -->
                            <svg class="addlocation" width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="2.22656" y="2" width="26" height="26" rx="5" fill="white" />
                                <path
                                d="M26.8842 3.66314e-06H3.56402C2.67887 3.66314e-06 1.82997 0.351656 1.20408 0.977601C0.578186 1.60355 0.226563 2.45251 0.226562 3.33773V26.6647C0.226563 27.5499 0.578186 28.3989 1.20408 29.0248C1.82997 29.6508 2.67887 30.0024 3.56402 30.0024H26.8891C27.7743 30.0024 28.6231 29.6508 29.249 29.0248C29.8749 28.3989 30.2266 27.5499 30.2266 26.6647V3.33773C30.2266 2.899 30.1401 2.46457 29.972 2.05929C29.804 1.65402 29.5577 1.28585 29.2473 0.975851C28.9369 0.66585 28.5684 0.420098 28.1629 0.252652C27.7574 0.0852068 27.3229 -0.000646311 26.8842 3.66314e-06ZM23.5467 16.6627H16.8879V23.327H13.5504V16.6627H6.89034V13.3249H13.5541V6.66433H16.8916V13.3287H23.5517L23.5467 16.6627Z"
                                fill="#2B2B2B" />
                            </svg>
                        </div>
                    </div>
                </div>`;
            }
        }

        saveTrips();
        $("#changesPopup").fadeOut(150);
    }

    function removeFirstBtn(btn) {
        btn.classList.add("btn-addPlan")
        btn.innerText = " +  ";
    }
    function removeUnset(btn) {
        btn.closest(".plan-unsetEnd").remove();
    }

    function nextRecommend(pageNum, order, cat, sectionNo, btn) {
        recommend(pageNum+1, order, cat, sectionNo, true);
        btn.remove();
    }

    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(showYourPosition, positioningError, {
                timeout: 500,
                enableHighAccuracy: true
            });
        }
    }

    // Choose transport mode
    function chooseTransportMode(btn) {
        var cardDate = btn.closest(".card-date");
        selectedField = cardDate.querySelector(".tm-selection").querySelector("a");
        newSelected = btn.querySelector("svg").querySelector("path").cloneNode(true);
        newSelected.setAttribute("style", "fill: white");

        selectedField.querySelector("svg").querySelector("path").replaceWith(newSelected);
        cardDate.querySelector(".tm-selection").querySelector("span").innerText = btn.querySelector("span").innerText;

        btn.closest(".tm-dropdown").classList.remove("show");

        saveTrips();
    }

    function openRecommendTab(order, btn) {
        // Pull screen up
        $("#recommendationTab").show();
        $("#recommendationTab").animate({
            top: "0",
            bottom: "0"
        }, 350);

        sectionIndex = [].slice.call(document.getElementsByClassName("recommendation-listings")).indexOf(btn.closest(".recommendation-listings"));
        document.getElementById("sectionIndex").innerText = sectionIndex;

        allCat = document.getElementById("categories").getElementsByTagName("li");
        for (var i=0; i<allCat.length; i++) {
            var li = allCat[i];
            li.setAttribute("onclick", `recommend(1, ${order}, '${li.querySelector("p").innerText}')`)
        }
        recommend(1, order, "Eateries");
    }
    function closeRecommendTab() {
        // Pull screen down
        $("#recommendationTab").animate({
            bottom: "-200vh"
        }, 350, function () {
            $("#recommendationTab").hide();
        });
    }
    // Order - the positional order of the button in DOM
    async function recommend(pageNum, order, cat, sectionNo=0, append=false) {
        // Stop pending ajax req
        if (requests.length > 0) {
            while (requests.length > 0) {
                try {
                    requests[0].abort();
                }
                catch (e) {}
                finally {
                    requests.pop(0);
                }
            }
        }

        var sectionIndex = parseInt(document.getElementById("sectionIndex").innerText);
        transportMde = document.getElementsByClassName("tm-selection")[sectionIndex].querySelector("span").innerText;

        div = document.getElementsByClassName("recommendation-listings")[sectionIndex];
        var allCards = div.getElementsByClassName("plan-selection");

        $("#reloadingbg").show();
        $("#selectedCat").text(cat);
        document.getElementById("recSearchBar").setAttribute("onkeyup", `recSearch(${order});`);
        
        // Get place before, after and registered places
        var registeredPlaces = [].slice.call(allCards).slice(1, allCards.length).map(x => x.querySelector(".plan-address").innerText);
        if (order - 2 > 0) {
            var placeBefore = allCards[order-1].querySelector(".plan-address").innerText;
            var latlng = allCards[order-1].querySelector(".plan-latlng").innerText.split(",");
        }
        else {
            var placeBefore = allCards[0].querySelector(".plan-latlng").innerText.split(",");;
            var latlng = allCards[0].querySelector(".plan-latlng").innerText.split(",");
        }
        
        placeA = allCards[order];
        var placeAfter;
        if (placeA) {
            placeAfter = allCards[order].querySelector(".plan-address").innerText;
        }

        if (cardEdit) {
            var tempAllowance = document.getElementsByClassName("time-left")[sectionIndex].innerText + parseInt(cardEdit.querySelector(".plan-total-duration").querySelector("span").innerText);
        }
        else {
            var tempAllowance = document.getElementsByClassName("time-left")[sectionIndex].innerText;
        }

        startTme = new Date();
        startTme = new Date(startTme.getFullYear(), startTme.getMonth(), startTme.getDate(), 8, 0, 0);
        // TODO
        for (var i=1; i<allCards.length-1; i++) {
            startTme.setTime(startTime.getTime() + parseInt(allCards[i].querySelector(".plan-total-duration").querySelector("span").innerText)*60000);
        }
        console.log("Here")
        var allowanceLeft = parseInt(div.closest(".planSection").querySelector(".time-left").querySelector("span").innerText);

        async function fetchDisplay(sectionNo) {
            request = await $.ajax({
                type: "POST",
                url: `/funcs/planner-recommend-places?page=${pageNum}`,
                data: {
                    date: currentTime.toISOString().slice(0, 10),
                    startTime: startTme.getHours() + ":" + startTme.getMinutes(),
                    timeLeft: allowanceLeft,
                    latitude: latlng[0],
                    longitude: latlng[1],
                    category: cat,
                    transportMode: transportMde,
                    skipped: JSON.stringify(skipped),
                    placesAdded: registeredPlaces,
                    abovePlace: placeBefore,
                    belowPlace: placeAfter,
                    section: sectionNo
                },
                success: function(result) {
                    cleanedResult = result.replaceAll("\\u", "").replaceAll("NaN", `""`);
                    result = JSON.parse(cleanedResult);

                    listingIndex = [document.getElementById("recommend-main"), document.getElementById("recommend-ratings"), document.getElementById("recommend-partners")]
                    pendingChooseList[sectionNo] = result;
                    listing = listingIndex[sectionNo-1]

                    if (!append)
                        listing.innerHTML = "";

                    if (result.list.length > 0) {
                        for (var i in result.list) {
                            var recommendCard = 
                            `<div class="maincard attractioncard plan-choice" onclick="viewPlace(this, ${sectionNo}, ${order}, ${i});">
                                <p class="info_json" hidden>${JSON.stringify(result.list[i])}</p>
                                <div class="cardimg" style="background-image: url('${result.list[i].Image_url}');">
                                </div>
                    
                                <div class="maincardinfo attractioncardinfo">
                                <h1 class="recentname">${result.list[i].Name}</h1>
                    
                                <div class="recenttype">
                                    <h3 class="recentcat">${result.list[i].Category.replace(/,/g, "•")}</h3>
                                    <div class="rating">`;

                            for (var j=0; j<Math.floor(parseFloat(result.list[i].Rating)); j++) {
                                recommendCard += 
                                    `<svg width="12" height="12" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="#E4002B" stroke-width="3" />
                                        <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="#E4002B" />
                                    </svg>`;
                            }
                            
                            ratingDeci = parseFloat(result.list[i].Rating) - Math.floor(parseFloat(result.list[i].Rating));
                            if (ratingDeci < 0.35 && ratingDeci > 0) {
                                recommendCard += 
                                    `<svg width="12" height="12" viewBox="0 0 41 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <rect x="2.05078" y="1.5" width="37" height="37" rx="3.5" stroke="#BBBBBB" stroke-width="3" />
                                        <rect x="8.01172" y="7.5" width="25.015" height="25" rx="2" fill="#BBBBBB" />
                                    </svg>`;
                            } 
                            else if (ratingDeci > 0.3 && ratingDeci < 0.7) {
                                recommendCard += 
                                    `<svg width="12" height="12" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="url(#paint0_linear_2171_1619)" stroke-width="3" />
                                        <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="url(#paint1_linear_2171_1619)" />
                                        <defs>
                                            <linearGradient id="paint0_linear_2171_1619" x1="0" y1="20" x2="40" y2="20" gradientUnits="userSpaceOnUse">
                                            <stop stop-color="#E4002B" />
                                            <stop offset="0.484375" stop-color="#E4002B" />
                                            <stop offset="0.515625" stop-color="#BBBBBB" />
                                            <stop offset="1" stop-color="#BBBBBB" />
                                            </linearGradient>
                                            <linearGradient id="paint1_linear_2171_1619" x1="7.46094" y1="20" x2="32.4759" y2="20" gradientUnits="userSpaceOnUse">
                                            <stop stop-color="#E4002B" />
                                            <stop offset="0.484375" stop-color="#E4002B" />
                                            <stop offset="0.515625" stop-color="#BBBBBB" />
                                            <stop offset="1" stop-color="#BBBBBB" />
                                            </linearGradient>
                                        </defs>
                                    </svg>`;
                            }
                            else if (ratingDeci > 0.7) {
                                recommendCard += 
                                    `<svg width="12" height="12" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="#E4002B" stroke-width="3" />
                                        <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="#E4002B" />
                                    </svg>`;
                            }
                            
                            for (var j=0; j<5 - (Math.ceil(parseFloat(result.list[i].Rating))); j++) {
                                recommendCard += 
                                    `<svg width="12" height="12" viewBox="0 0 41 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <rect x="2.05078" y="1.5" width="37" height="37" rx="3.5" stroke="#BBBBBB" stroke-width="3" />
                                        <rect x="8.01172" y="7.5" width="25.015" height="25" rx="2" fill="#BBBBBB" />
                                    </svg>`;
                            }
                            recommendCard +=
                                `       <p class="ratingvalue">${result.list[i].Review_no}</p>
                                    </div>
                                </div>
                    
                                </div>
                            </div>`;
                            listing.innerHTML += recommendCard;
                        }
                    }
                    else {
                        listing.innerHTML += `<div class="card">There isn't any available places to be added</div>`;
                        var allBtns = div.getElementsByClassName("btn-addPlan");
                        for (var i=0; i<allBtns.length; i++) {
                            allBtns[i].disabled = true;
                            allBtns[i].classList.remove("btn-addColor");
                        }
                    }

                    if (result.list.length == 10)
                        listing.innerHTML += `<p onclick="nextRecommend(${pageNum}, ${order}, '${cat}', ${sectionNo}, this);" class="list-load-more">Load more</p>`;

                    console.log(skipped);
                    
                },
                error: function(jq, status, errorMsg) {
                    div.innerHTML = 
                    `<div class="plan-choices-list">
                        Something went wrong. Try again
                    </div>`;
                },
                complete: function(result) {
                    $("#reloadingbg").hide();
                }
            });

            requests.push(request);
        }

        if (sectionNo == 0) {
            for (var i=1; i<4; i++) {
                fetchDisplay(i)
            }
        }
        else
            fetchDisplay(sectionNo)
    }

    var viewBtn;
    function viewPlace(btn, index, order, itemNo) {
        var card = document.getElementById("carddetails");
        console.log(card)
        var cardInfo = JSON.parse(btn.querySelector(".info_json").innerText);
        viewBtn = btn

        document.getElementById("addItineraryBtn").setAttribute("onclick", `choosePlace(${index}, ${order}, ${itemNo});`)
        document.querySelector("#view-name").innerText = cardInfo.Name;
        document.querySelector("#view-address").innerText = cardInfo.Address;
        document.querySelector("#view-category").innerText = cardInfo.Category;
        document.querySelector("#view-rating").innerText = cardInfo.Rating;
        document.querySelector("#view-reviewNo").innerText = cardInfo.Review_no;
        document.querySelector("#view-img").style.backgroundImage = `url("${cardInfo.Image_url}")`;
        // Phone no
        if (cardInfo.Phone_no.length > 0) {
            document.querySelector("#view-phone").innerText = cardInfo.Phone_no;
        }
        else {
            document.querySelector("#view-phone").parentElement.style.display = "none";
        }
        // Operating hours
        var operatingHrsJson = JSON.parse(cardInfo.Operating_hours)
        for (var day in operatingHrsJson) {
            if (operatingHrsJson[day].length > 0) {
                console.log(operatingHrsJson)
                operateSE = operatingHrsJson[day][0].split("-");
                document.querySelector("#view-operatingHours").innerText = `Opening ${operateSE[0]} to ${operateSE[1]}`;
            }
        }
        // Rating bars
        var ratingBarBg = document.querySelector("#view-ratingBars")
        var ratingBarSm = document.querySelector("#view-ratingBars-sm")
        ratingBarBg.innerHTML = "";
        ratingBarSm.innerHTML = "";
        for (var j=0; j<Math.floor(parseFloat(cardInfo.Rating)); j++) {
            ratingBarBg.innerHTML += 
                `<svg width="20" height="20" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="#E4002B" stroke-width="3" />
                  <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="#E4002B" />
                </svg>`;
            ratingBarSm.innerHTML += 
                `<svg width="12" height="12" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="#E4002B" stroke-width="3" />
                    <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="#E4002B" />
                </svg>`;
        }
        
        ratingDeci = parseFloat(cardInfo.Rating) - Math.floor(parseFloat(cardInfo.Rating));
        if (ratingDeci < 0.35 && ratingDeci > 0) {
            ratingBarBg.innerHTML += `<svg width="20" height="20" viewBox="0 0 41 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="2.05078" y="1.5" width="37" height="37" rx="3.5" stroke="#BBBBBB" stroke-width="3" />
                    <rect x="8.01172" y="7.5" width="25.015" height="25" rx="2" fill="#BBBBBB" />
                </svg>`;
            ratingBarSm.innerHTML += `<svg width="12" height="12" viewBox="0 0 41 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="2.05078" y="1.5" width="37" height="37" rx="3.5" stroke="#BBBBBB" stroke-width="3" />
                    <rect x="8.01172" y="7.5" width="25.015" height="25" rx="2" fill="#BBBBBB" />
                </svg>`;
        } 
        else if (ratingDeci > 0.3 && ratingDeci < 0.7) {
            ratingBarBg.innerHTML += `<svg width="20" height="20" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="url(#paint0_linear_2171_1619)" stroke-width="3" />
                    <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="url(#paint1_linear_2171_1619)" />
                    <defs>
                    <linearGradient id="paint0_linear_2171_1619" x1="0" y1="20" x2="40" y2="20" gradientUnits="userSpaceOnUse">
                        <stop stop-color="#E4002B" />
                        <stop offset="0.484375" stop-color="#E4002B" />
                        <stop offset="0.515625" stop-color="#BBBBBB" />
                        <stop offset="1" stop-color="#BBBBBB" />
                    </linearGradient>
                    <linearGradient id="paint1_linear_2171_1619" x1="7.46094" y1="20" x2="32.4759" y2="20" gradientUnits="userSpaceOnUse">
                        <stop stop-color="#E4002B" />
                        <stop offset="0.484375" stop-color="#E4002B" />
                        <stop offset="0.515625" stop-color="#BBBBBB" />
                        <stop offset="1" stop-color="#BBBBBB" />
                    </linearGradient>
                    </defs>
                </svg>`;
            ratingBarSm.innerHTML += `<svg width="12" height="12" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="url(#paint0_linear_2171_1619)" stroke-width="3" />
                    <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="url(#paint1_linear_2171_1619)" />
                    <defs>
                    <linearGradient id="paint0_linear_2171_1619" x1="0" y1="20" x2="40" y2="20" gradientUnits="userSpaceOnUse">
                        <stop stop-color="#E4002B" />
                        <stop offset="0.484375" stop-color="#E4002B" />
                        <stop offset="0.515625" stop-color="#BBBBBB" />
                        <stop offset="1" stop-color="#BBBBBB" />
                    </linearGradient>
                    <linearGradient id="paint1_linear_2171_1619" x1="7.46094" y1="20" x2="32.4759" y2="20" gradientUnits="userSpaceOnUse">
                        <stop stop-color="#E4002B" />
                        <stop offset="0.484375" stop-color="#E4002B" />
                        <stop offset="0.515625" stop-color="#BBBBBB" />
                        <stop offset="1" stop-color="#BBBBBB" />
                    </linearGradient>
                    </defs>
                </svg>`;
        }
        else if (ratingDeci > 0.7) {
            ratingBarBg.innerHTML += `<svg width="20" height="20" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="#E4002B" stroke-width="3" />
                    <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="#E4002B" />
                </svg>`;
            ratingBarSm.innerHTML += `<svg width="12" height="12" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="1.5" y="1.5" width="37" height="37" rx="3.5" stroke="#E4002B" stroke-width="3" />
                    <rect x="7.46094" y="7.5" width="25.015" height="25" rx="2" fill="#E4002B" />
                </svg>`;
        }
        
        for (var j=0; j<5 - (Math.ceil(parseFloat(cardInfo.Rating))); j++) {
            ratingBarBg.innerHTML += `<svg width="20" height="20" viewBox="0 0 41 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="2.05078" y="1.5" width="37" height="37" rx="3.5" stroke="#BBBBBB" stroke-width="3" />
                    <rect x="8.01172" y="7.5" width="25.015" height="25" rx="2" fill="#BBBBBB" />
                </svg>`;
            ratingBarSm.innerHTML += `<svg width="12" height="12" viewBox="0 0 41 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="2.05078" y="1.5" width="37" height="37" rx="3.5" stroke="#BBBBBB" stroke-width="3" />
                    <rect x="8.01172" y="7.5" width="25.015" height="25" rx="2" fill="#BBBBBB" />
                </svg>`;
        }
        ratingBarSm.innerHTML += `<p id="view-reviewNo-sm" class="ratingvalue">${cardInfo.Review_no}</p>`
        // Reviews
        var review = document.querySelector(".review").cloneNode(true);
        review.querySelector(".view-review-name").innerText = "Jia Min";
        review.querySelector(".view-review-desc").innerText = "The staff Mika, honey and monzi were really friendly and they kept us entertained the whole night. Really splendid night. Will keep coming back here.";
        document.querySelector("#view-bottomSection").appendChild(review);
        review = document.querySelector(".review").cloneNode(true);
        review.querySelector(".view-review-name").innerText = "Marius";
        review.querySelector(".view-review-desc").innerText = "Visited my family earlier this year for the first time since they moved to Singapore in 2020. They recommended I take the guided tour of Battlebox and I am so glad I did. The guide was extremely knowledgeable and very pleasant. The tour explains a lot about the British surrender to the Japanese and it was all the more interesting as you were in the very rooms where the decision to surrender was taken. One of the highlights of my trip.";
        document.querySelector("#view-bottomSection").appendChild(review);
        document.querySelector(".review").remove();

        // Pull screen up
        $("#carddetails").show();
        $("#carddetails").animate({
            top: "0",
            bottom: "0"
        }, 350);
    }
    function closeViewPlace() {
        // Pull screen down
        $("#carddetails").animate({
            bottom: "-200vh"
        }, 350, function () {
            $("#carddetails").hide();
        });
    }

    function choosePlace(index, order, itemNo) {
        sectionIndex = parseInt(document.getElementById("sectionIndex").innerText);
        div = document.getElementsByClassName("recommendation-listings")[sectionIndex];
        var info = pendingChooseList[index].list[itemNo];

        var newPlace = new DOMParser().parseFromString(`
            <div class="plan-selection">
                <hr>
                <!-- explorerdirections -->
                <div class="explorerdirections">
                    <div class="explorertransport">
                    </div>

                    <!-- explorertravelduration -->
                    <div class="explorertravelduration">
                    <h1><span class="plan-travel-duration">${Math.round(info.TravelDuration)}</span>min</h1>
                    <h2 onclick="showExpandedRoute">Details <svg width="9" height="5" viewBox="0 0 9 5" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M0.78125 0.657445C0.862652 0.406133 1.05557 0.252445 1.23283 0.0900984C1.37284 -0.0380473 1.60198 -0.0213795 1.74749 0.102437C1.78154 0.132408 1.81395 0.164424 1.84456 0.198329C2.79981 1.21383 3.75459 2.2299 4.70889 3.24655C4.73025 3.27304 4.74965 3.30127 4.76688 3.33097C4.80453 3.29266 4.82794 3.27079 4.84829 3.24785C5.81073 2.22441 6.7731 1.20098 7.7354 0.177549C7.90716 -0.00492803 8.11881 -0.0605592 8.29077 0.0760284C8.44962 0.204574 8.59127 0.355537 8.71182 0.524754C8.82497 0.681473 8.79159 0.89274 8.67112 1.04773C8.65301 1.0711 8.63367 1.09383 8.61352 1.11526L5.12668 4.82564C4.95309 5.0105 4.74959 5.05076 4.56134 4.93495C4.51708 4.90599 4.47652 4.87107 4.44067 4.83105C3.27391 3.59 2.1079 2.34859 0.942629 1.10682C0.874048 1.03322 0.834365 0.930405 0.78125 0.84014L0.78125 0.657445Z"
                            fill="#E4002B" />
                        </svg>
                    </h2>
                    </div>
                </div>
                <hr>

                <div class="plannerevent btn-addPlan" onclick="openRecommendTab(${order+1}, this)">
                    <div class="eventdetails">
                        <div class="eventinfo">
                        <h2 class="inactiveinput">Add an Itinerary</h2>
                        </div>
                    </div>
            
                    <div class="eventedit">
                    <!-- addlocation -->
                    <svg class="addlocation" width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg" >
                        <rect x="2.22656" y="2" width="26" height="26" rx="5" fill="white" />
                        <path
                        d="M26.8842 3.66314e-06H3.56402C2.67887 3.66314e-06 1.82997 0.351656 1.20408 0.977601C0.578186 1.60355 0.226563 2.45251 0.226562 3.33773V26.6647C0.226563 27.5499 0.578186 28.3989 1.20408 29.0248C1.82997 29.6508 2.67887 30.0024 3.56402 30.0024H26.8891C27.7743 30.0024 28.6231 29.6508 29.249 29.0248C29.8749 28.3989 30.2266 27.5499 30.2266 26.6647V3.33773C30.2266 2.899 30.1401 2.46457 29.972 2.05929C29.804 1.65402 29.5577 1.28585 29.2473 0.975851C28.9369 0.66585 28.5684 0.420098 28.1629 0.252652C27.7574 0.0852068 27.3229 -0.000646311 26.8842 3.66314e-06ZM23.5467 16.6627H16.8879V23.327H13.5504V16.6627H6.89034V13.3249H13.5541V6.66433H16.8916V13.3287H23.5517L23.5467 16.6627Z"
                        fill="#2B2B2B" />
                    </svg>
                    </div>
                </div>
                <hr>

                <div class="plannerevent">
                    <div class="eventdetails">
                        <div class="eventimg plan-img" style="background-image: url('${info.Image_url}');">
                            <span hidden>${info.Image_url}</span>
                        </div>
            
                        <div class="eventinfo">
                            <h1 class="eventname plan-name">${info.Name}</h1>
                            <h2 class="eventtype plan-category">${info.Category}</h2>
                            <p class="plan-address" hidden>${info.Address}</p>
                            <p class="plan-travel-duration" hidden>${Math.round(info.TravelDuration)}</p>
                            <p class="plan-activity-duration" hidden><span>${Math.round(info.ActivityDuration)}</span> min</p>
                            <p class="plan-total-duration" hidden><span>${Math.round(info.Duration)}</span> min</p>
                            <p class="plan-timing" hidden></p>
                            <p class="plan-latlng" hidden>${info.Latlng}</p>
                        </div>
                    </div>
            
                    <div class="eventedit">
                        <svg class="editevent plan-edit" width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg"
                        onclick="editCard(this, ${order});">
                        <path
                            d="M0.333984 16.3335V20.5H4.49963L16.7872 8.21241L12.6208 4.04593L0.333984 16.3335ZM20.0091 4.9905C20.1121 4.88775 20.1938 4.76571 20.2495 4.63135C20.3053 4.49699 20.334 4.35295 20.334 4.20748C20.334 4.06202 20.3053 3.91798 20.2495 3.78362C20.1938 3.64926 20.1121 3.52721 20.0091 3.42447L17.4095 0.82485C17.3068 0.721875 17.1847 0.640178 17.0504 0.584435C16.916 0.528693 16.772 0.5 16.6265 0.5C16.481 0.5 16.337 0.528693 16.2026 0.584435C16.0683 0.640178 15.9462 0.721875 15.8435 0.82485L13.8101 2.8574L17.9725 7.02387L20.0058 4.9905H20.0091Z"
                            fill="#2B2B2B" />
                        </svg>
            
                        <svg class="deleteevent plan-delete" width="17" height="21" viewBox="0 0 17 21" fill="none" xmlns="http://www.w3.org/2000/svg"
                        onclick="delCard(this, ${order});">
                        <path
                            d="M2.01977 18.2776C2.02236 18.8662 2.26154 19.43 2.68522 19.8462C3.1089 20.2625 3.68278 20.4974 4.28195 20.5H13.3297C13.9289 20.4974 14.5028 20.2625 14.9264 19.8462C15.3501 19.43 15.5893 18.8662 15.5919 18.2776V4.94391H2.01977V18.2776ZM16.722 1.61122H12.7637L11.6326 0.5H5.9781L4.84701 1.61122H0.888672V3.83366H16.722V1.61122Z"
                            fill="#E4002B" />
                        </svg>
                    </div>
                </div>

                <input type="text" class="addnote" value="" placeholder="Add Notes">
            </div>`, "text/html").body.firstElementChild;

        var allSelection = div.getElementsByClassName("plan-selection");
        if (cardEdit) {
            allowanceLeft += parseFloat(cardEdit.querySelector(".plan-total-duration").querySelector("span").innerText);
            cardEdit.replaceWith(newPlace);
            cardEdit = null;
        }
        else {
            if (div.querySelector(".end")) {
                div.insertBefore(newPlace, allSelection[order-1]);
            }
            else {
                div.insertBefore(newPlace, div.querySelector(".plan-unsetEnd"));
            }
        }

        var allowanceLeft = parseInt(document.getElementsByClassName("time-left")[sectionIndex].querySelector("span").innerText);
        allowanceLeft -= info.Duration;
        document.getElementsByClassName("time-left")[sectionIndex].querySelector("span").innerText = allowanceLeft;
        
        // Fill up info for autosaving data
        if (order != allSelection.length)
            reCal2Places(div, order);
        reAssignValues();
        saveTrips();
        
        closeViewPlace();
        closeRecommendTab();
    }

    // Edit/delete/rearrange
    async function editCard(btn, order) {
        var card = btn.closest(".plan-selection");
        reAssignValues();

        cardEdit = card;
        openRecommendTab(order-1, this);
    }

    function delCard(btn, order) {
        var card = btn.closest(".plan-selection");
        var div = btn.closest(".recommendation-listings");

        var timeLeft = div.closest(".planSection").querySelector(".time-left").querySelector("span");
        timeLeft.innerText = parseInt(timeLeft.innerText) + parseInt(card.querySelector(".plan-total-duration").querySelector("span").innerText);
        allowanceLeft = timeLeft.innerText;
        card.remove();

        reAssignValues();
        if (order-1 != div.getElementsByClassName("plan-selection").length)
            reCal2Places(div, order-1);
        else
            saveTrips();
    }

    // Recalculate route and travel time
    async function reCal2Places(div, order) {
        var cards = div.getElementsByClassName("plan-selection");
        var index = [].slice.call(document.getElementsByClassName("recommendation-listings")).indexOf(div);
        var aboveCard = cards[order-1];
        var belowCard = cards[order];
        
        var totalDuration = 0;
        for (var i=1; i<order-1; i++) {
            var duration = parseFloat(cards[i].querySelector(".plan-total-duration").querySelector("span").innerText);
            totalDuration += duration;
        }
        var divDate = new Date($("#startDate").val());
        divDate = new Date(divDate.setDate(divDate.getDate() + (order-1)));

        await $.ajax({
            type: "POST",
            url: `/funcs/reCalculate`,
            data: {
                latlngs: [aboveCard.querySelector(".plan-latlng").innerText, belowCard.querySelector(".plan-latlng").innerText],
                routeType: document.getElementsByClassName("tm-selection")[index].querySelector("span").innerText,
                date: divDate.toISOString().slice(0, 10),
                topDuration: totalDuration,
                startTime: aboveCard.querySelector(".plan-timing").innerText
            },
            success: function(result) {
                result = JSON.parse(result);

                var belowCardTDuration = belowCard.querySelector(".plan-total-duration").querySelector("span").innerText;
                var belowCardADuration = belowCard.querySelector(".plan-activity-duration");
                if (belowCardADuration) {
                    belowCardADuration = belowCardADuration.querySelector("span").innerText;
                }
                else {
                    belowCardADuration = 0;
                }

                var timeDiff = result[0] + parseInt(belowCardADuration.innerText) - parseInt(belowCardTDuration.innerText);
                belowCard.querySelector(".plan-travel-duration").innerText = Math.round(result[0] - belowCardADuration);
                div.parentElement.parentElement.querySelector(".time-left").querySelector("span").innerText = parseInt(div.parentElement.parentElement.querySelector(".time-left").querySelector("span").innerText) + timeDiff;
            }
        })

        saveTrips();
    }

    function reAssignValues() {
        var div = document.getElementsByClassName("recommendation-listings");

        for (var i=0; i<div.length; i++) {
            var btn = div[i].getElementsByClassName("btn-addPlan");
            for (var j=0; j<btn.length; j++) {
                btn[j].setAttribute("onclick", `openRecommendTab(${j+2}, this);`);
            }

            var plansCards = div[i].getElementsByClassName("plan-selection");

            var startTme = startTime;
            var currTime = startTme.toLocaleTimeString('en-SG', {hour12: false})
            if (plansCards.length > 0) {
                plansCards[0].querySelector(".plan-timing").innerText = currTime.substring(0, currTime.length-3);
                for (var j=1; j<plansCards.length-1; j++) {
                    startTme.setTime(startTme.getTime() + parseInt(plansCards[j].querySelector(".plan-total-duration").querySelector("span").innerText)*60000);

                    currTime = startTime.toLocaleTimeString('en-SG', {hour12: false})
                    plansCards[j].querySelector(".plan-timing").innerText = currTime.substring(0, currTime.length-3);
                }
            }

        }
    }

    async function saveTrips() {
        var div = document.getElementsByClassName("recommendation-listings");
        var cardDates = document.getElementsByClassName("card-date");
        var checkDate = new Date($("#startDate").val());
        console.log(checkDate)

        var plannerIdStr = document.querySelector("#planner-id").value; 
        if (plannerIdStr.trim().length == 0)
            plannerIdStr = ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c => (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16));
        document.querySelector("#planner-id").value = plannerIdStr;

        async function reset() {
            await $.ajax({
                type: "POST",
                url: `/funcs/clear-planner?id=${$("#planner-id").val()}`,
                data: {},
                success: function(result) {
                    console.log("System: Reset planner. Waiting for new planner ...");
                }
            });
        }
        async function save(index) {
            await $.ajax({
                type: "POST",
                url: `/funcs/save-trip`,
                data: {
                    tripType: "Planner",
                    tripName: "Hello",
                    date: checkDate.toISOString().slice(0, 10),
                    names: placesName,
                    addresses: placesAddress,
                    categories: placesCategory,
                    images: placesImg,
                    activityDuration: placesActivityDuration,
                    duration: placesDuration,
                    latlngs: placesLatlng,
                    description: $("#description").val(),
                    transportMode: cardDates[index].querySelector(".tm-selection").querySelector("span").innerText,
                    confirmed: false,
                    status: "Planning",
                    plannerId: plannerIdStr,
                    hasEnd: hasE
                },
                success: function(result) {
                    result = JSON.parse(result);
                    document.querySelector("#planner-id").value = result.plannerId;
                    console.log("System: Trip "+(index+1)+" saved.");
                }
            });
        }

        reset();
        for (var i=0; i<div.length; i++) {
            // Update db function
            var allPlacesDiv = div[i].getElementsByClassName("plan-selection");
            var placesName = [];
            var placesAddress = [];
            var placesActivityDuration = [];
            var placesCategory = [];
            var placesImg = [];
            var placesDuration = [];
            var placesLatlng = [];

            var hasE = false;
            if (allPlacesDiv.length > 0) {
                hasE = allPlacesDiv[allPlacesDiv.length-1].classList.contains("end")
            }

            for (var j=0; j<allPlacesDiv.length; j++) {
                placesName.push(allPlacesDiv[j].querySelector(".plan-name").innerText);
                placesAddress.push(allPlacesDiv[j].querySelector(".plan-address").innerText);
                if (j == 0 || (j == allPlacesDiv.length-1 && hasE)) {
                    placesCategory.push(null);
                    placesImg.push(null);
                    placesActivityDuration.push(null);
                    placesDuration.push(null);
                }
                else {
                    placesCategory.push(allPlacesDiv[j].querySelector(".plan-category").innerText);
                    placesImg.push(allPlacesDiv[j].querySelector(".plan-img").querySelector("span").innerText);
                    placesActivityDuration.push(parseInt(allPlacesDiv[j].querySelector(".plan-activity-duration").querySelector("span").innerText));
                    placesDuration.push(parseInt(allPlacesDiv[j].querySelector(".plan-total-duration").querySelector("span").innerText));
                }
                placesLatlng.push(allPlacesDiv[j].querySelector(".plan-latlng").innerText);
            }

            console.log()

            await save(i);

            checkDate.setDate(checkDate.getDate() + 1);
        }
    }

    var canSearch = true;
    var dropdownCooldown = false;

    // Searching - for adding start and end location
    function openSearch(btn, order) {
        // Pull screen up
        $("#searchTab").show();
        $("#searchTab").animate({
            top: "0",
            bottom: "0"
        }, 350, function () {
            document.querySelector("#searchBar").focus();
        });
        var btnClassList = btn.classList;
        var idClass;
        for (var i=0; i<btnClassList.length; i++) {
            if (btnClassList[i] == "start" || btnClassList[i] == "end") {
                idClass = btnClassList[i];
                break;
            }
        }

        $("#search-btnId").text(idClass);
        $("#search-divOrder").text(order);
    }
    function closeSearch() {
        // Pull screen down
        $("#searchTab").animate({
            bottom: "-200vh"
        }, 350, function() {
            $("#searchTab").hide();
        });
    }

    function pauseSearch() {
        canSearch = false;
        setTimeout(function() {
            canSearch = true;
            search();
        }, 350);
    }
    
    function search() {
        if (canSearch) {
            var dropdownMenu = document.querySelector("#search-results");
            const search = document.querySelector("#searchBar").value;
            const pageNum = $("#searchPage").val()

            if (!search.trim()) {
                dropdownMenu.innerHTML = "";
            }
            else {
                $.ajax({
                    url: `https://developers.onemap.sg/commonapi/search?searchVal=${search}&returnGeom=Y&getAddrDetails=Y&pageNum=${pageNum}`,
                    success: function(result) {
                        dropdownMenu.innerHTML = "";
                        if (result.results.length > 0) {
                            dropdownMenu.style.display = "block";
                            showLength = 10;
                            if (result.results.length < 10) {
                                showLength = result.results.length;
                            }

                            for (var i=0; i<showLength; i++) {
                                dropdownCooldown = true;
                                record = result.results[i]
                                dropdownMenu.innerHTML += `
                                <div class="dropdown-item" onclick="addSE(this);">
                                    <p style="font-size: 14px; margin-bottom: 3px; font-weight: bold;">${capitalize(record.SEARCHVAL)}</p>
                                    <p style="font-size: 11px; max-width: 100%; overflow: auto; margin-bottom: 3px;">${capitalize(record.ADDRESS)}</p>
                                    <p hidden>${record.LATITUDE},${record.LONGITUDE}</p>
                                </div>`;

                                setTimeout(function () { dropdownCooldown = false; }, 126)
                            }
                        }
                        else {
                            dropdownMenu.innerHTML = `<div class="dropdown-item">No results found</div>`; 
                        }
                    }
                });
            }

        }     
    }

    function recSearch(order){
        var dropdownMenu = document.querySelector("#recSearch-results-results");
        var recentMenu = document.querySelector("#recSearch-results-recent");
        const search = document.querySelector("#recSearchBar").value;
        var cat = document.querySelector("#selectedCat").innerText;

        if (search.trim().length == 0) {
            dropdownMenu.innerHTML = "";
        }
        else {
            $.ajax({
                dataType: "json",
                url: `/funcs/search?s=${search}&page=${1}&cat=${cat}`,
                success: function(result) {
                    dropdownMenu.innerHTML = "";
                    // Filter recent searches
                    var allRecent = recentMenu.children;
                    if (allRecent.length > 0) {
                        $(".recentheader").show();
                        for (var i=0; i<allRecent.length; i++) {
                            if (allRecent[i].querySelector(".recentname").innerText.toLowerCase.contains(search.toLowerCase)) {
                                allRecent[i].style.display = "block";
                            }
                            else {
                                allRecent[i].style.display = "none";
                            }
                        }
                    }
                    else {
                        $(".recentheader").hide();
                    }

                    if (result.length > 0) {
                        dropdownMenu.style.display = "block";
                        $(".resultsheader").show();
                        showLength = 10;
                        if (result.length < 10) {
                            showLength = result.length;
                        }
                        
                        for (var i=0; i<showLength; i++) {
                            dropdownCooldown = true;
                            record = result[i]
                            card = 
                            `<div class="recentcards searchcard" onclick="chooseSearchPlace(this, ${order});">
                                <div class="cardimg" style="background-image: url('${record["Image_url"]}')">
                                </div>
                        
                                <div class="cardinfo">
                                    <h1 class="recentname search-name">${record["Name"]}</h1>
                                    <p class="search-address" hidden>${record["Address"]}</p>
                                    <p class="search-address" hidden>${record["ActivityDuration"]}</p>
                                    <div class="recenttype">
                                        <h3 class="recentcat">${record['Category']}</h3>
                                        <div class="rating">`
                            for (var j=0; j<Math.round(parseFloat(record['Rating'])); j++) {
                                card += 
                                    `<svg width="12" height="12" fill="none">
                                        <rect x="0.5" y="0.5" width="11" height="11" rx="1.5" stroke="#E4002B" />
                                    </svg>`
                            }
                            for (var j=0; j<5- Math.round(parseFloat(record['Rating'])); j++) {
                                card += 
                                    `<svg width="12" height="12" fill="none">
                                        <rect x="0.5" y="0.5" width="11" height="11" rx="1.5" stroke="#C4C4C4" />
                                    </svg>`
                            }
                            card += `<p class="ratingvalue">${record["Review_no"]}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>`;
                            dropdownMenu.innerHTML += card;

                            setTimeout(function () { dropdownCooldown = false; }, 126)
                        }
                    }
                    else {
                        dropdownMenu.style.display = "none";
                        dropdownMenu.innerText = `No results found`; 
                    }
                }
            });

        }     
    }

    function searchNextPage() {
        $("#searchPage").text(parseInt($("#searchPage").text()) + 1)
    }

    function addSE(card) {
        var btnId = $("#search-btnId").text();
        var divOrder = parseInt($("#search-divOrder").text());
        var div = document.getElementsByClassName("recommendation-listings")[divOrder-1];

        var btn = div.querySelector(`.${btnId}`);
        
        var allP = card.getElementsByTagName("p");

        if (btnId == "start") {
            div.innerHTML = 
                `<div class="plan-selection start">
                    <div class="plannerstart">
                        <div class="plannerstartpoint">
                            <svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                d="M0.888672 15.5C0.888672 12.5333 1.76841 9.63319 3.41663 7.16645C5.06485 4.69972 7.40753 2.77713 10.1484 1.64181C12.8893 0.506499 15.9053 0.209449 18.815 0.788228C21.7247 1.36701 24.3975 2.79562 26.4953 4.8934C28.5931 6.99119 30.0217 9.66394 30.6004 12.5737C31.1792 15.4834 30.8822 18.4994 29.7469 21.2403C28.6115 23.9811 26.689 26.3238 24.2222 27.972C21.7555 29.6203 18.8554 30.5 15.8887 30.5C13.9188 30.5 11.9683 30.112 10.1484 29.3582C8.32853 28.6044 6.67495 27.4995 5.28207 26.1066C2.46902 23.2936 0.888672 19.4783 0.888672 15.5ZM15.8887 24.5C17.6687 24.5 19.4088 23.9722 20.8888 22.9832C22.3688 21.9943 23.5224 20.5887 24.2036 18.9442C24.8848 17.2996 25.063 15.49 24.7157 13.7442C24.3685 11.9984 23.5113 10.3947 22.2526 9.13604C20.994 7.87737 19.3903 7.0202 17.6445 6.67294C15.8987 6.32567 14.0891 6.5039 12.4445 7.18509C10.8 7.86628 9.39438 9.01983 8.40544 10.4999C7.41651 11.9799 6.88867 13.72 6.88867 15.5C6.88867 17.887 7.83688 20.1761 9.52471 21.864C11.2125 23.5518 13.5017 24.5 15.8887 24.5Z"
                                fill="#06A122" />
                            </svg>
                            <h1 class="plan-name">${allP[0].innerText}</h1>
                            <p class="plan-address" hidden>${allP[1].innerText}</p>
                            <p class="plan-latlng" hidden>${allP[2].innerText}</p>
                        </div>

                        <div class="plannerstarttime">
                            <h1 hidden class="plan-timing"></h1>
                        </div>
                    </div>
                </div>
                
                <div class="plan-unsetEnd">
                    <hr>
                    <div class="plannerevent btn-addPlan" onclick="openRecommendTab(2, this);">
                        <div class="eventdetails">
                            <div class="eventinfo">
                            <h2 class="inactiveinput">Add an Itinerary</h2>
                            </div>
                        </div>
                
                        <div class="eventedit">
                        <!-- addlocation -->
                        <svg class="addlocation" width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg" >
                            <rect x="2.22656" y="2" width="26" height="26" rx="5" fill="white" />
                            <path
                            d="M26.8842 3.66314e-06H3.56402C2.67887 3.66314e-06 1.82997 0.351656 1.20408 0.977601C0.578186 1.60355 0.226563 2.45251 0.226562 3.33773V26.6647C0.226563 27.5499 0.578186 28.3989 1.20408 29.0248C1.82997 29.6508 2.67887 30.0024 3.56402 30.0024H26.8891C27.7743 30.0024 28.6231 29.6508 29.249 29.0248C29.8749 28.3989 30.2266 27.5499 30.2266 26.6647V3.33773C30.2266 2.899 30.1401 2.46457 29.972 2.05929C29.804 1.65402 29.5577 1.28585 29.2473 0.975851C28.9369 0.66585 28.5684 0.420098 28.1629 0.252652C27.7574 0.0852068 27.3229 -0.000646311 26.8842 3.66314e-06ZM23.5467 16.6627H16.8879V23.327H13.5504V16.6627H6.89034V13.3249H13.5541V6.66433H16.8916V13.3287H23.5517L23.5467 16.6627Z"
                            fill="#2B2B2B" />
                        </svg>
                        </div>
                    </div>

                    <hr>

                    <div class="plannerend end" onclick="openSearch(this, '${divOrder}');removeUnset(this);">
                        <div class="plannerendpoint">
                            <svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M0.333984 15.9771C0.333984 13.0103 1.21372 10.1102 2.86194 7.6435C4.51016 5.17677 6.85284 3.25418 9.59373 2.11886C12.3346 0.98355 15.3506 0.6865 18.2603 1.26528C21.17 1.84406 23.8428 3.27267 25.9406 5.37046C28.0384 7.46824 29.467 10.141 30.0458 13.0507C30.6245 15.9604 30.3275 18.9764 29.1922 21.7173C28.0569 24.4582 26.1343 26.8009 23.6675 28.4491C21.2008 30.0973 18.3007 30.9771 15.334 30.9771C13.3642 30.9771 11.4136 30.5891 9.59373 29.8352C7.77385 29.0814 6.12026 27.9765 4.72738 26.5837C1.91434 23.7706 0.333984 19.9553 0.333984 15.9771ZM15.334 24.9771C17.114 24.9771 18.8541 24.4492 20.3341 23.4603C21.8142 22.4713 22.9677 21.0657 23.6489 19.4212C24.3301 17.7767 24.5083 15.9671 24.161 14.2212C23.8138 12.4754 22.9566 10.8718 21.6979 9.6131C20.4393 8.35442 18.8356 7.49726 17.0898 7.14999C15.344 6.80272 13.5344 6.98095 11.8898 7.66214C10.2453 8.34333 8.83969 9.49688 7.85076 10.9769C6.86182 12.457 6.33398 14.197 6.33398 15.9771C6.33398 18.364 7.28219 20.6532 8.97002 22.341C10.6578 24.0288 12.947 24.9771 15.334 24.9771Z"
                                fill="#E4002B" />
                            </svg>
                            <h2 class="inactiveinput">Add End-Off Point</h2>
                        </div>
                
                        <!-- addlocation -->
                        <svg class="addlocation" width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="2.22656" y="2" width="26" height="26" rx="5" fill="white" />
                            <path
                            d="M26.8842 3.66314e-06H3.56402C2.67887 3.66314e-06 1.82997 0.351656 1.20408 0.977601C0.578186 1.60355 0.226563 2.45251 0.226562 3.33773V26.6647C0.226563 27.5499 0.578186 28.3989 1.20408 29.0248C1.82997 29.6508 2.67887 30.0024 3.56402 30.0024H26.8891C27.7743 30.0024 28.6231 29.6508 29.249 29.0248C29.8749 28.3989 30.2266 27.5499 30.2266 26.6647V3.33773C30.2266 2.899 30.1401 2.46457 29.972 2.05929C29.804 1.65402 29.5577 1.28585 29.2473 0.975851C28.9369 0.66585 28.5684 0.420098 28.1629 0.252652C27.7574 0.0852068 27.3229 -0.000646311 26.8842 3.66314e-06ZM23.5467 16.6627H16.8879V23.327H13.5504V16.6627H6.89034V13.3249H13.5541V6.66433H16.8916V13.3287H23.5517L23.5467 16.6627Z"
                            fill="#2B2B2B" />
                        </svg>
                    </div>
                </div>`;
        }
        else {
            div.innerHTML += 
                `<div class="plan-selection end">
                    <hr>
                    <!-- explorerdirections -->
                    <div class="explorerdirections">
                        <div class="explorertransport">
                        </div>

                        <!-- explorertravelduration -->
                        <div class="explorertravelduration">
                        <h1><span class="plan-travel-duration"></span>min</h1>
                        <h2 onclick="showExpandedRoute">Details <svg width="9" height="5" viewBox="0 0 9 5" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M0.78125 0.657445C0.862652 0.406133 1.05557 0.252445 1.23283 0.0900984C1.37284 -0.0380473 1.60198 -0.0213795 1.74749 0.102437C1.78154 0.132408 1.81395 0.164424 1.84456 0.198329C2.79981 1.21383 3.75459 2.2299 4.70889 3.24655C4.73025 3.27304 4.74965 3.30127 4.76688 3.33097C4.80453 3.29266 4.82794 3.27079 4.84829 3.24785C5.81073 2.22441 6.7731 1.20098 7.7354 0.177549C7.90716 -0.00492803 8.11881 -0.0605592 8.29077 0.0760284C8.44962 0.204574 8.59127 0.355537 8.71182 0.524754C8.82497 0.681473 8.79159 0.89274 8.67112 1.04773C8.65301 1.0711 8.63367 1.09383 8.61352 1.11526L5.12668 4.82564C4.95309 5.0105 4.74959 5.05076 4.56134 4.93495C4.51708 4.90599 4.47652 4.87107 4.44067 4.83105C3.27391 3.59 2.1079 2.34859 0.942629 1.10682C0.874048 1.03322 0.834365 0.930405 0.78125 0.84014L0.78125 0.657445Z"
                                fill="#E4002B" />
                            </svg>
                        </h2>
                        </div>
                    </div>
                    <hr>
                    
                    <div class="plannerevent btn-addPlan" onclick="openRecommendTab(${div.getElementsByClassName("btn-addPlan").length + 2}, this);">
                        <div class="eventdetails">
                            <div class="eventinfo">
                            <h2 class="inactiveinput">Add an Itinerary</h2>
                            </div>
                        </div>
                
                        <div class="eventedit">
                        <!-- addlocation -->
                        <svg class="addlocation" width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg" >
                            <rect x="2.22656" y="2" width="26" height="26" rx="5" fill="white" />
                            <path
                            d="M26.8842 3.66314e-06H3.56402C2.67887 3.66314e-06 1.82997 0.351656 1.20408 0.977601C0.578186 1.60355 0.226563 2.45251 0.226562 3.33773V26.6647C0.226563 27.5499 0.578186 28.3989 1.20408 29.0248C1.82997 29.6508 2.67887 30.0024 3.56402 30.0024H26.8891C27.7743 30.0024 28.6231 29.6508 29.249 29.0248C29.8749 28.3989 30.2266 27.5499 30.2266 26.6647V3.33773C30.2266 2.899 30.1401 2.46457 29.972 2.05929C29.804 1.65402 29.5577 1.28585 29.2473 0.975851C28.9369 0.66585 28.5684 0.420098 28.1629 0.252652C27.7574 0.0852068 27.3229 -0.000646311 26.8842 3.66314e-06ZM23.5467 16.6627H16.8879V23.327H13.5504V16.6627H6.89034V13.3249H13.5541V6.66433H16.8916V13.3287H23.5517L23.5467 16.6627Z"
                            fill="#2B2B2B" />
                        </svg>
                        </div>
                    </div>
                    <hr>

                    <div class="explorerend">
                        <div class="explorerendpoint">
                            <svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                d="M0.333984 15.9771C0.333984 13.0103 1.21372 10.1102 2.86194 7.6435C4.51016 5.17677 6.85284 3.25418 9.59373 2.11886C12.3346 0.98355 15.3506 0.6865 18.2603 1.26528C21.17 1.84406 23.8428 3.27267 25.9406 5.37046C28.0384 7.46824 29.467 10.141 30.0458 13.0507C30.6245 15.9604 30.3275 18.9764 29.1922 21.7173C28.0569 24.4582 26.1343 26.8009 23.6675 28.4491C21.2008 30.0973 18.3007 30.9771 15.334 30.9771C13.3642 30.9771 11.4136 30.5891 9.59373 29.8352C7.77385 29.0814 6.12026 27.9765 4.72738 26.5837C1.91434 23.7706 0.333984 19.9553 0.333984 15.9771ZM15.334 24.9771C17.114 24.9771 18.8541 24.4492 20.3341 23.4603C21.8142 22.4713 22.9677 21.0657 23.6489 19.4212C24.3301 17.7767 24.5083 15.9671 24.161 14.2212C23.8138 12.4754 22.9566 10.8718 21.6979 9.6131C20.4393 8.35442 18.8356 7.49726 17.0898 7.14999C15.344 6.80272 13.5344 6.98095 11.8898 7.66214C10.2453 8.34333 8.83969 9.49688 7.85076 10.9769C6.86182 12.457 6.33398 14.197 6.33398 15.9771C6.33398 18.364 7.28219 20.6532 8.97002 22.341C10.6578 24.0288 12.947 24.9771 15.334 24.9771Z"
                                fill="#E4002B" />
                            </svg>
                            <h1 class="plan-name">${allP[0].innerText}</h1>
                            <p class="plan-address" hidden>${allP[1].innerText}}</p>
                            <p class="plan-latlng" hidden>${allP[2].innerText}</p>
                            <p class="plan-total-duration" hidden></p>
                        </div>
                        <div class="explorerendtime">
                            <h1 class="plan-timing" hidden></h1>
                        </div>
                    </div>
                </div>`;

            reAssignValues();
        }

        closeSearch();
        saveTrips();
    }

    function toggleDay(card) {
        var dateCards = document.getElementsByClassName("card-date");
        var index = card;
        if (!Number.isInteger(card))
            index = [].slice.call(dateCards).indexOf(card);
        var planSections = document.getElementsByClassName("planSection");

        for (var i=0; i<dateCards.length; i++) {
            if (i == index) {
                planSections[i].style.display = "block";
                dateCards[i].classList.remove("inactivedate");
                dateCards[i].classList.add("activedate");
            }
            else {
                planSections[i].style.display = "none";
                dateCards[i].classList.add("inactivedate");
                dateCards[i].classList.remove("activedate");
            }
        }

        
    }

    function displayRouteDetails() {
        var planSections = document.getElementsByClassName("planSection");
        var datesCards = document.getElementsByClassName("card-date");

        for (var j=0; j<planSections.length; j++) {
            var section = planSections[j]
            var allAddresses = section.getElementsByClassName("plan-address");
            var allLatlngs = section.getElementsByClassName("plan-latlng");
            var allRouteDiv = section.getElementsByClassName("explorertransport");
            var routeType = datesCards[j].querySelector(".tm-selection").querySelector("span").innerText;
            var checkTime = currentTime;
            var startTime = $("#start-time").val();

            function getAPIRoute(section, index) {
                var position1 = allLatlngs[index].innerText.split(",");
                var position2 = allLatlngs[index+1].innerText.split(",");
                var res = true;
                allRouteDiv[index].innerHTML = "";

                $.ajax({
                    dataType: "json",
                    url: `https://developers.onemap.sg/privateapi/routingsvc/route?start=${position1[0]},${position1[1]}&end=${position2[0]},${position2[1]}&routeType=${routeType}&token=${apiKey}&date=${String(checkTime.getFullYear())}-${String(checkTime.getMonth()+1)}-${String(checkTime.getDate())}&time=${startTime}:00&mode=TRANSIT`,
                    success: function(result) {
                        allRouteDiv = section.getElementsByClassName("explorertransport");
                        //Set result to a variable for writing
                        if (routeType == "pt")
                            var info = result.plan.itineraries[0];
                        else
                            var info = result.route_summary;

                        function addModeIcon(routeType, info) {
                            if (routeType == "walk") {
                                allRouteDiv[index].innerHTML += 
                                    `<div><svg width="14" height="20" viewBox="0 0 14 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                        d="M8.79073 3.72093C9.12694 3.72093 9.4556 3.61182 9.73514 3.40739C10.0147 3.20296 10.2326 2.91239 10.3612 2.57244C10.4899 2.23248 10.5236 1.8584 10.458 1.49751C10.3924 1.13661 10.2305 0.805109 9.99274 0.544918C9.75501 0.284728 9.45211 0.107536 9.12236 0.0357492C8.79262 -0.0360373 8.45082 0.000806104 8.14021 0.14162C7.82959 0.282435 7.5641 0.520895 7.37731 0.826847C7.19053 1.1328 7.09083 1.4925 7.09083 1.86047C7.09217 2.35344 7.2717 2.8258 7.5902 3.17439C7.90871 3.52297 8.3403 3.71946 8.79073 3.72093ZM5.73091 16.6512L6.58086 12.5581L8.36575 14.4186V20H10.0657V13.0233L8.28076 11.1628L8.79073 8.37209C9.3739 9.10142 10.0926 9.68613 10.8987 10.0872C11.7049 10.4882 12.5799 10.6964 13.4655 10.6977V8.83721C12.7307 8.84941 12.0061 8.64946 11.3644 8.25751C10.7228 7.86557 10.1869 7.29547 9.81067 6.60465L8.96072 5.11628C8.81006 4.84145 8.59888 4.61233 8.34647 4.44983C8.09407 4.28733 7.80848 4.19664 7.5158 4.18605C7.26082 4.18605 7.09083 4.27907 6.83584 4.27907L2.4161 6.32558V10.6977H4.116V7.53489L5.64591 6.88372L4.28599 14.4186L0.12123 13.4884L-0.21875 15.3488L5.73091 16.6512Z"
                                        fill="#707070" />
                                    </svg></div>`;
                            }
                            else if (routeType == "drive") {
                                allRouteDiv[index].innerHTML += 
                                    `<div><svg width="14" height="20" viewBox="0 0 14 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M17.7709 2.05692C17.6584 1.72085 17.4456 1.42933 17.1626 1.22344C16.8795 1.01754 16.5405 0.907635 16.1931 0.909196H3.97092C3.62382 0.908654 3.28521 1.01896 3.00236 1.22471C2.71951 1.43047 2.50653 1.72141 2.39314 2.05692L0.0820312 8.86373V17.9546C0.0820313 18.256 0.199094 18.5451 0.407468 18.7582C0.615842 18.9713 0.898457 19.091 1.19314 19.091H2.30425C2.59894 19.091 2.88155 18.9713 3.08993 18.7582C3.2983 18.5451 3.41536 18.256 3.41536 17.9546V16.8183H16.7487V17.9546C16.7487 18.256 16.8658 18.5451 17.0741 18.7582C17.2825 18.9713 17.5651 19.091 17.8598 19.091H18.9709C19.2656 19.091 19.5482 18.9713 19.7566 18.7582C19.965 18.5451 20.082 18.256 20.082 17.9546V8.86373L17.7709 2.05692ZM3.97092 13.4092C3.64128 13.4092 3.31905 13.3092 3.04497 13.1219C2.77089 12.9346 2.55727 12.6684 2.43112 12.3569C2.30497 12.0455 2.27197 11.7027 2.33628 11.3721C2.40059 11.0415 2.55932 10.7377 2.79241 10.4993C3.0255 10.261 3.32247 10.0986 3.64577 10.0328C3.96907 9.96708 4.30418 10.0008 4.60873 10.1298C4.91327 10.2589 5.17357 10.4773 5.3567 10.7576C5.53984 11.038 5.63759 11.3675 5.63759 11.7046C5.63759 12.1567 5.46199 12.5903 5.14943 12.9099C4.83687 13.2296 4.41295 13.4092 3.97092 13.4092ZM16.1931 13.4092C15.8635 13.4092 15.5413 13.3092 15.2672 13.1219C14.9931 12.9346 14.7795 12.6684 14.6533 12.3569C14.5272 12.0455 14.4942 11.7027 14.5585 11.3721C14.6228 11.0415 14.7815 10.7377 15.0146 10.4993C15.2477 10.261 15.5447 10.0986 15.868 10.0328C16.1913 9.96708 16.5264 10.0008 16.8309 10.1298C17.1355 10.2589 17.3958 10.4773 17.5789 10.7576C17.7621 11.038 17.8598 11.3675 17.8598 11.7046C17.8598 12.1567 17.6842 12.5903 17.3717 12.9099C17.0591 13.2296 16.6352 13.4092 16.1931 13.4092ZM2.30425 7.72737L3.97092 2.61374H16.1931L17.8598 7.72737H2.30425Z" 
                                        fill="#707070"/>
                                    </svg></div>`;
                            }
                            else if (routeType == "cycle") {
                                allRouteDiv[index].innerHTML += 
                                    `<div><svg width="14" height="20" viewBox="0 0 14 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M15.4969 3.90244C15.8829 3.90244 16.2601 3.788 16.581 3.5736C16.9019 3.3592 17.152 3.05446 17.2996 2.69792C17.4473 2.34138 17.486 1.94906 17.4107 1.57056C17.3354 1.19206 17.1496 0.844382 16.8767 0.5715C16.6038 0.298617 16.2561 0.112781 15.8776 0.037493C15.4991 -0.0377952 15.1068 0.000845426 14.7502 0.148529C14.3937 0.296212 14.089 0.546304 13.8746 0.867181C13.6602 1.18806 13.5457 1.56531 13.5457 1.95122C13.5473 2.46824 13.7533 2.96364 14.1189 3.32923C14.4845 3.69483 14.9799 3.9009 15.4969 3.90244V3.90244ZM5.25305 10.2439C3.95931 10.2439 2.71856 10.7578 1.80375 11.6726C0.888936 12.5875 0.375 13.8282 0.375 15.1219C0.375 16.4157 0.888936 17.6564 1.80375 18.5712C2.71856 19.4861 3.95931 20 5.25305 20C6.54679 20 7.78754 19.4861 8.70235 18.5712C9.61716 17.6564 10.1311 16.4157 10.1311 15.1219C10.1311 13.8282 9.61716 12.5875 8.70235 11.6726C7.78754 10.7578 6.54679 10.2439 5.25305 10.2439ZM5.25305 18.5366C4.34743 18.5366 3.47891 18.1768 2.83854 17.5365C2.19817 16.8961 1.83841 16.0276 1.83841 15.1219C1.83841 14.2163 2.19817 13.3478 2.83854 12.7074C3.47891 12.0671 4.34743 11.7073 5.25305 11.7073C6.15866 11.7073 7.02719 12.0671 7.66756 12.7074C8.30793 13.3478 8.66768 14.2163 8.66768 15.1219C8.66768 16.0276 8.30793 16.8961 7.66756 17.5365C7.02719 18.1768 6.15866 18.5366 5.25305 18.5366ZM10.9116 8.78049L13.253 6.43902L14.0335 7.21951C14.6811 7.87989 15.456 8.40196 16.3112 8.75412C17.1665 9.10628 18.0843 9.2812 19.0091 9.26829V7.31707C18.3553 7.32268 17.707 7.19592 17.1034 6.94442C16.4998 6.69292 15.9534 6.32189 15.4969 5.85366L13.6433 4C13.21 3.62402 12.656 3.41627 12.0823 3.41463C11.8246 3.39755 11.5665 3.44168 11.3291 3.54341C11.0918 3.64515 10.8818 3.80161 10.7165 4L7.98475 6.73171C7.80159 6.90926 7.65552 7.12143 7.55503 7.3559C7.45454 7.59037 7.40164 7.84247 7.39939 8.09756C7.3823 8.35526 7.42643 8.61335 7.52817 8.85073C7.6299 9.08812 7.78636 9.29806 7.98475 9.46341L11.1067 12.1951V17.0732H13.0579V11.0244L10.9116 8.78049ZM18.9116 10.2439C17.9468 10.2439 17.0037 10.53 16.2015 11.066C15.3993 11.602 14.7741 12.3639 14.4049 13.2552C14.0356 14.1465 13.939 15.1274 14.1273 16.0736C14.3155 17.0199 14.7801 17.889 15.4623 18.5712C16.1445 19.2535 17.0137 19.718 17.9599 19.9063C18.9062 20.0945 19.887 19.9979 20.7783 19.6287C21.6697 19.2595 22.4315 18.6342 22.9675 17.832C23.5035 17.0299 23.7896 16.0867 23.7896 15.1219C23.796 14.4796 23.6742 13.8424 23.4313 13.2477C23.1884 12.653 22.8294 12.1127 22.3751 11.6584C21.9209 11.2042 21.3806 10.8451 20.7859 10.6022C20.1911 10.3593 19.554 10.2375 18.9116 10.2439V10.2439ZM18.9116 18.5366C18.2362 18.5366 17.576 18.3363 17.0145 17.9611C16.453 17.5859 16.0153 17.0526 15.7569 16.4287C15.4984 15.8047 15.4308 15.1182 15.5626 14.4558C15.6943 13.7934 16.0195 13.185 16.4971 12.7074C16.9746 12.2299 17.583 11.9047 18.2454 11.7729C18.9078 11.6412 19.5944 11.7088 20.2183 11.9672C20.8422 12.2257 21.3755 12.6633 21.7507 13.2249C22.1259 13.7864 22.3262 14.4466 22.3262 15.1219C22.3153 16.0242 21.9521 16.8864 21.3141 17.5244C20.676 18.1624 19.8138 18.5257 18.9116 18.5366V18.5366Z"
                                        fill="#707070" />
                                    </svg></div>`;
                            }
                            else if (routeType == "bus") {
                                var routes = info.route.split("/")
                                for (var i=0; i<routes.length; i++) {
                                    allRouteDiv[index].innerHTML += 
                                        `<div class="transportation" style="background: ${routeTextures[routeType].color}">
                                            <h1>${routes[i]}</h1>
                                        </div>`;
                                }
                            }
                            else if (routeType == "tram") {
                                allRouteDiv[index].innerHTML += 
                                    `<div class="transportation" style="background: ${routeTextures[routeType].color}">
                                        <h1>${info.route}</h1>
                                    </div>`;
                            }
                            else if (routeType == "subway") {
                                console.log(info.route)
                                allRouteDiv[index].innerHTML += 
                                    `<div class="transportation" style="background: ${routeTextures.subway[info.route].color}">
                                        <h1>${info.route}</h1>
                                    </div>`;
                            }
                        }

                        if (routeType == "pt") {
                            for (var i=0; i<info.legs.length; i++) {
                                addModeIcon(info.legs[i].mode.toLowerCase(), info.legs[i]);
                                if (i != info.legs.length -1) {
                                    allRouteDiv[index].innerHTML += 
                                        `<div><svg width="8" height="13" viewBox="0 0 8 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path
                                            d="M1.54958 -1.36256e-06C1.75249 0.0669132 1.89922 0.212233 2.04594 0.362284C3.87674 2.23657 5.70952 4.10882 7.54098 5.98108C7.79676 6.24265 7.85162 6.54884 7.68969 6.83069C7.65466 6.89152 7.6084 6.9483 7.55882 6.99899C5.67846 8.92329 3.79611 10.8462 1.91442 12.7705C1.7201 12.9693 1.4934 13.0544 1.22572 12.9638C0.981174 12.8814 0.835107 12.7009 0.791485 12.4414C0.757777 12.2413 0.816601 12.0649 0.944162 11.9121C0.979192 11.8702 1.01753 11.8317 1.0552 11.7925C2.74389 10.0662 4.43193 8.33998 6.12195 6.6144C6.15632 6.57925 6.20324 6.55695 6.24422 6.52856L6.24422 6.47178C6.20324 6.4434 6.15632 6.42109 6.12195 6.38594C4.42069 4.64887 2.7201 2.91044 1.02017 1.17202C0.76042 0.906386 0.71085 0.592767 0.879389 0.310239C0.977868 0.145319 1.13319 0.0648857 1.30173 -1.34089e-06L1.54958 -1.36256e-06Z"
                                            fill="#707070" />
                                        </svg></div>`;
                                }
                            }
                        }
                        else {
                            addModeIcon(routeType, info);
                        }
                    },
                    error: function(jqXHR, textStatus, err) {
                        res = false;
                    }
                });

                return res;
            }

            for (var i=0; i<allAddresses.length-1; i++) {
                tries = 0;
                while (tries <= 5) {
                    tries++;
                    res = getAPIRoute(section, i);
                    if (res)
                        break;
                }
            }
        }
    }

    // Map settings
    // Map display init
    L.Icon.Default.imagePath = "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.4.0/images";
    var center = L.bounds([1.56073, 104.11475], [1.16, 103.502]).getCenter();
    var map = L.map('mapdiv').setView([center.x, center.y], 12);
    var yourMarker;
    var startMarker;
    var endMarker;

    var routeTextures = {
        WALK: {color: "black", dashArray: "10, 10"},
        SUBWAY: {
            NE: {color: "purple"},
            NS: {color: "red"},
            DT: {color: "blue"},
            EW: {color: "green"},
            CC: {color: "yellow"},
            TE: {color: "brown"},
            Default: {color: "grey"}
        },
        DRIVE: {color: "black"}
    }

    var basemap = L.tileLayer(`http://maps-{s}.onemap.sg/v2/Default/{z}/{x}/{y}.png`, {
        detectRetina: true,
        maxZoom: 18,
        minZoom: 12,
    });

    map.setMaxBounds([[1.56073, 104.1147], [1.16, 103.502]]);

    basemap.addTo(map);

    var updatePosition = false;
    var repeatedBuildings = {};

    function openMapView() {
        // Make toggle cards
        activeIndex = [].slice.call(document.getElementsByClassName("card-date")).indexOf(document.querySelector(".activedate"));
        var planCards = document.getElementsByClassName("recommendation-listings")[activeIndex].getElementsByClassName("plan-selection");
        var mapDiv = document.getElementById("map-selection");
        mapDiv.innerHTML = "";
        for (var i=1; i<planCards.length; i++) {
            mapDiv.innerHTML += 
            `<div class="mapdetails trip-place" onclick="showRoute(${activeIndex}, '${planCards[i-1].querySelector(".plan-latlng").innerText}', '${planCards[i].querySelector(".plan-latlng").innerText}')">
                <!-- explorerevent -->
                <div class="explorerevent">
                    <div class="eventdetails">
                    <div class="eventinfo">
                        <h1 class="eventname">${planCards[i-1].querySelector(".plan-name").innerText}</h1>
                    </div>
                    </div>

                    <div class="eventedit">
                        <h1>${planCards[i].querySelector(".plan-travel-duration").innerText} mins</h1>
                    </div>
                </div>

                <!-- explorerdirections -->
                <div class="mapdirections">
                    <div class="maptransport">
                    </div>

                    <!-- explorertravelduration -->
                    <div class="explorertravelduration">
                    <h2 onclick="showExpandedRoute">See Details</h2>
                    </div>
                </div>
            </div>`;

            routeIconsDiv = mapDiv.getElementsByClassName("maptransport");
            var routeType = document.getElementsByClassName("card-date")[activeIndex].querySelector('.tm-selection').querySelector("span").innerText;
            var checkTime = currentTime;

            function getAPIRoute(index) {
                var position1 = planCards[index-1].querySelector(".plan-latlng").innerText.split(",");
                var position2 = planCards[index].querySelector(".plan-latlng").innerText.split(",");
                var res = true;
                var startDate = document.getElementsByClassName("card-date")[activeIndex].querySelector("h1").querySelector("span").innerText;

                routeIconsDiv[index-1].innerHTML = "";

                $.ajax({
                    dataType: "json",
                    url: `https://developers.onemap.sg/privateapi/routingsvc/route?start=${position1[0]},${position1[1]}&end=${position2[0]},${position2[1]}&routeType=${routeType}&token=${apiKey}&date=${startDate}&time=12:00:00&mode=TRANSIT`,
                    success: function(result) {
                        //Set result to a variable for writing
                        if (routeType == "pt")
                            var info = result.plan.itineraries[0];
                        else
                            var info = result.route_summary;

                        function addModeIcon(routeType, info) {
                            if (routeType == "walk") {
                                routeIconsDiv[index-1].innerHTML += 
                                    `<svg width="14" height="20" viewBox="0 0 14 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                        d="M8.79073 3.72093C9.12694 3.72093 9.4556 3.61182 9.73514 3.40739C10.0147 3.20296 10.2326 2.91239 10.3612 2.57244C10.4899 2.23248 10.5236 1.8584 10.458 1.49751C10.3924 1.13661 10.2305 0.805109 9.99274 0.544918C9.75501 0.284728 9.45211 0.107536 9.12236 0.0357492C8.79262 -0.0360373 8.45082 0.000806104 8.14021 0.14162C7.82959 0.282435 7.5641 0.520895 7.37731 0.826847C7.19053 1.1328 7.09083 1.4925 7.09083 1.86047C7.09217 2.35344 7.2717 2.8258 7.5902 3.17439C7.90871 3.52297 8.3403 3.71946 8.79073 3.72093ZM5.73091 16.6512L6.58086 12.5581L8.36575 14.4186V20H10.0657V13.0233L8.28076 11.1628L8.79073 8.37209C9.3739 9.10142 10.0926 9.68613 10.8987 10.0872C11.7049 10.4882 12.5799 10.6964 13.4655 10.6977V8.83721C12.7307 8.84941 12.0061 8.64946 11.3644 8.25751C10.7228 7.86557 10.1869 7.29547 9.81067 6.60465L8.96072 5.11628C8.81006 4.84145 8.59888 4.61233 8.34647 4.44983C8.09407 4.28733 7.80848 4.19664 7.5158 4.18605C7.26082 4.18605 7.09083 4.27907 6.83584 4.27907L2.4161 6.32558V10.6977H4.116V7.53489L5.64591 6.88372L4.28599 14.4186L0.12123 13.4884L-0.21875 15.3488L5.73091 16.6512Z"
                                        fill="#707070" />
                                    </svg>`;
                            }
                            else if (routeType == "drive") {
                                routeIconsDiv[index-1].innerHTML += 
                                    `<svg width="8" height="13" viewBox="0 0 8 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                        d="M1.54958 -1.36256e-06C1.75249 0.0669132 1.89922 0.212233 2.04594 0.362284C3.87674 2.23657 5.70952 4.10882 7.54098 5.98108C7.79676 6.24265 7.85162 6.54884 7.68969 6.83069C7.65466 6.89152 7.6084 6.9483 7.55882 6.99899C5.67846 8.92329 3.79611 10.8462 1.91442 12.7705C1.7201 12.9693 1.4934 13.0544 1.22572 12.9638C0.981174 12.8814 0.835107 12.7009 0.791485 12.4414C0.757777 12.2413 0.816601 12.0649 0.944162 11.9121C0.979192 11.8702 1.01753 11.8317 1.0552 11.7925C2.74389 10.0662 4.43193 8.33998 6.12195 6.6144C6.15632 6.57925 6.20324 6.55695 6.24422 6.52856L6.24422 6.47178C6.20324 6.4434 6.15632 6.42109 6.12195 6.38594C4.42069 4.64887 2.7201 2.91044 1.02017 1.17202C0.76042 0.906386 0.71085 0.592767 0.879389 0.310239C0.977868 0.145319 1.13319 0.0648857 1.30173 -1.34089e-06L1.54958 -1.36256e-06Z"
                                        fill="#707070" />
                                    </svg>`;
                            }
                            else if (routeType == "cycle") {
                                routeIconsDiv[index-1].innerHTML += 
                                    `<div><svg width="14" height="20" viewBox="0 0 14 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                        d="M15.4969 3.90244C15.8829 3.90244 16.2601 3.788 16.581 3.5736C16.9019 3.3592 17.152 3.05446 17.2996 2.69792C17.4473 2.34138 17.486 1.94906 17.4107 1.57056C17.3354 1.19206 17.1496 0.844382 16.8767 0.5715C16.6038 0.298617 16.2561 0.112781 15.8776 0.037493C15.4991 -0.0377952 15.1068 0.000845426 14.7502 0.148529C14.3937 0.296212 14.089 0.546304 13.8746 0.867181C13.6602 1.18806 13.5457 1.56531 13.5457 1.95122C13.5473 2.46824 13.7533 2.96364 14.1189 3.32923C14.4845 3.69483 14.9799 3.9009 15.4969 3.90244V3.90244ZM5.25305 10.2439C3.95931 10.2439 2.71856 10.7578 1.80375 11.6726C0.888936 12.5875 0.375 13.8282 0.375 15.1219C0.375 16.4157 0.888936 17.6564 1.80375 18.5712C2.71856 19.4861 3.95931 20 5.25305 20C6.54679 20 7.78754 19.4861 8.70235 18.5712C9.61716 17.6564 10.1311 16.4157 10.1311 15.1219C10.1311 13.8282 9.61716 12.5875 8.70235 11.6726C7.78754 10.7578 6.54679 10.2439 5.25305 10.2439ZM5.25305 18.5366C4.34743 18.5366 3.47891 18.1768 2.83854 17.5365C2.19817 16.8961 1.83841 16.0276 1.83841 15.1219C1.83841 14.2163 2.19817 13.3478 2.83854 12.7074C3.47891 12.0671 4.34743 11.7073 5.25305 11.7073C6.15866 11.7073 7.02719 12.0671 7.66756 12.7074C8.30793 13.3478 8.66768 14.2163 8.66768 15.1219C8.66768 16.0276 8.30793 16.8961 7.66756 17.5365C7.02719 18.1768 6.15866 18.5366 5.25305 18.5366ZM10.9116 8.78049L13.253 6.43902L14.0335 7.21951C14.6811 7.87989 15.456 8.40196 16.3112 8.75412C17.1665 9.10628 18.0843 9.2812 19.0091 9.26829V7.31707C18.3553 7.32268 17.707 7.19592 17.1034 6.94442C16.4998 6.69292 15.9534 6.32189 15.4969 5.85366L13.6433 4C13.21 3.62402 12.656 3.41627 12.0823 3.41463C11.8246 3.39755 11.5665 3.44168 11.3291 3.54341C11.0918 3.64515 10.8818 3.80161 10.7165 4L7.98475 6.73171C7.80159 6.90926 7.65552 7.12143 7.55503 7.3559C7.45454 7.59037 7.40164 7.84247 7.39939 8.09756C7.3823 8.35526 7.42643 8.61335 7.52817 8.85073C7.6299 9.08812 7.78636 9.29806 7.98475 9.46341L11.1067 12.1951V17.0732H13.0579V11.0244L10.9116 8.78049ZM18.9116 10.2439C17.9468 10.2439 17.0037 10.53 16.2015 11.066C15.3993 11.602 14.7741 12.3639 14.4049 13.2552C14.0356 14.1465 13.939 15.1274 14.1273 16.0736C14.3155 17.0199 14.7801 17.889 15.4623 18.5712C16.1445 19.2535 17.0137 19.718 17.9599 19.9063C18.9062 20.0945 19.887 19.9979 20.7783 19.6287C21.6697 19.2595 22.4315 18.6342 22.9675 17.832C23.5035 17.0299 23.7896 16.0867 23.7896 15.1219C23.796 14.4796 23.6742 13.8424 23.4313 13.2477C23.1884 12.653 22.8294 12.1127 22.3751 11.6584C21.9209 11.2042 21.3806 10.8451 20.7859 10.6022C20.1911 10.3593 19.554 10.2375 18.9116 10.2439V10.2439ZM18.9116 18.5366C18.2362 18.5366 17.576 18.3363 17.0145 17.9611C16.453 17.5859 16.0153 17.0526 15.7569 16.4287C15.4984 15.8047 15.4308 15.1182 15.5626 14.4558C15.6943 13.7934 16.0195 13.185 16.4971 12.7074C16.9746 12.2299 17.583 11.9047 18.2454 11.7729C18.9078 11.6412 19.5944 11.7088 20.2183 11.9672C20.8422 12.2257 21.3755 12.6633 21.7507 13.2249C22.1259 13.7864 22.3262 14.4466 22.3262 15.1219C22.3153 16.0242 21.9521 16.8864 21.3141 17.5244C20.676 18.1624 19.8138 18.5257 18.9116 18.5366V18.5366Z"
                                        fill="#707070" />
                                    </svg></div>`;
                            }
                            else if (routeType == "bus") {
                                var routes = info.route.split("/")
                                for (var i=0; i<routes.length; i++) {
                                    routeIconsDiv[index-1].innerHTML += 
                                        `<div class="transportation" style="background: ${routeTextures[routeType].color}">
                                            <h1>${routes[i]}</h1>
                                        </div>`;
                                }
                            }
                            else if (routeType == "tram") {
                                routeIconsDiv[index-1].innerHTML += 
                                    `<div class="transportation" style="background: ${routeTextures[routeType].color}">
                                        <h1>${info.route}</h1>
                                    </div>`;
                            }
                            else if (routeType == "subway") {
                                console.log(info.route)
                                routeIconsDiv[index-1].innerHTML += 
                                    `<div class="transportation" style="background: ${routeTextures.subway[info.route].color}">
                                        <h1>${info.route}</h1>
                                    </div>`;
                            }
                        }

                        if (routeType == "pt") {
                            for (var i=0; i<info.legs.length; i++) {
                                addModeIcon(info.legs[i].mode.toLowerCase(), info.legs[i]);
                                if (i != info.legs.length -1) {
                                    routeIconsDiv[index-1].innerHTML += 
                                        `<div><svg width="8" height="13" viewBox="0 0 8 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path
                                            d="M1.54958 -1.36256e-06C1.75249 0.0669132 1.89922 0.212233 2.04594 0.362284C3.87674 2.23657 5.70952 4.10882 7.54098 5.98108C7.79676 6.24265 7.85162 6.54884 7.68969 6.83069C7.65466 6.89152 7.6084 6.9483 7.55882 6.99899C5.67846 8.92329 3.79611 10.8462 1.91442 12.7705C1.7201 12.9693 1.4934 13.0544 1.22572 12.9638C0.981174 12.8814 0.835107 12.7009 0.791485 12.4414C0.757777 12.2413 0.816601 12.0649 0.944162 11.9121C0.979192 11.8702 1.01753 11.8317 1.0552 11.7925C2.74389 10.0662 4.43193 8.33998 6.12195 6.6144C6.15632 6.57925 6.20324 6.55695 6.24422 6.52856L6.24422 6.47178C6.20324 6.4434 6.15632 6.42109 6.12195 6.38594C4.42069 4.64887 2.7201 2.91044 1.02017 1.17202C0.76042 0.906386 0.71085 0.592767 0.879389 0.310239C0.977868 0.145319 1.13319 0.0648857 1.30173 -1.34089e-06L1.54958 -1.36256e-06Z"
                                            fill="#707070" />
                                        </svg></div>`;
                                }
                            }
                        }
                        else {
                            addModeIcon(routeType, info);
                        }
                    },
                    error: function(jqXHR, textStatus, err) {
                        res = false;
                    }
                });

                return res;
            }

            tries = 0;
            while (tries <= 3) {
                tries++;
                res = getAPIRoute(i);
                if (res)
                    break;
            }
        }

        // Default show 1st part trip
        var firstCard = document.querySelector(".trip-place")
        if (firstCard) {
            if (typeof firstCard.onclick == "function")
                firstCard.onclick.apply(firstCard);
        }

        // Pull plan page down
        $("#editplannertrip").animate({
            top: "0",
            bottom: "-200vh"
        }, 350, function () {
            $("#editplannertrip").hide();
            $("#mapView").show();
        });
    }

    function dismissMapView() {
        // Pull plan page up
        $("#editplannertrip").show();
        $("#editplannertrip").animate({
            top: "0",
            bottom: "0"
        }, 350), function() {
            $("#mapView").hide();
        };
    }

    function showYourPosition(position) {  
        updatePosition = true;  
        // Mark marker
        if (yourMarker) {
            map.removeLayer(yourMarker);
        }
        
        yourMarker = new L.Marker([position.coords.latitude, position.coords.longitude], {bounceOnAdd: false, customId: "YouMarker"}).addTo(map); 

        latLngStr = position.coords.latitude + "," + position.coords.longitude;
        document.getElementById("start-latlng").innerText = latLngStr;
    }

    function positioningError(error) {

    }

    function showRoute(index, position1, position2) {
        // Routing display
        var today = new Date();
        var routeType = document.getElementsByClassName("tm-selection")[index].querySelector("span").innerText;
        if (routeType == "Public Transport") {
            routeType = "pt";
        }

        var position1 = position1.split(",");
        var position2 = position2.split(",");

        function decodeGeo(encodedRoute) {
            if (encodedRoute !== undefined || encodedRoute !== '' || encodedRoute != null ) {
                var routeGeo = L.Polyline.fromEncoded(encodedRoute, {
                    precision: 6
                });

                return routeGeo;
            }
        }

        $.ajax({
            url: `https://developers.onemap.sg/privateapi/routingsvc/route?start=${position1[0]},${position1[1]}&end=${position2[0]},${position2[1]}&routeType=${routeType}&token=${apiKey}&date=${String(today.getFullYear())}-${String(today.getMonth()+1)}-${String(today.getDate())}&time=${String(today.getHours())}:${String(today.getMinutes())}:${String(today.getSeconds())}&mode=TRANSIT`,
            success: function(result) {
                //Set result to a variable for writing
                var encodedRoute;
                var modes = [];

                // Remove previous markings and route paths
                if (startMarker) {
                    map.removeLayer(startMarker);
                }
                if (endMarker) {
                    map.removeLayer(endMarker);
                }
                pathPieces = [].slice.call(document.getElementsByTagName("path")).map(x => x.parentElement);
                for (var i=0; i<pathPieces.length; i++) {
                    pathPieces[i].remove();
                }

                startMarker = new L.Marker([position1[0], position1[1]], {bounceOnAdd: true}).addTo(map);
                endMarker = new L.Marker([position2[0], position2[1]], {bounceOnAdd: true}).addTo(map);
                 
                if (routeType == "pt") {
                    var allRoutes = result.plan.itineraries;
                    for (var i in allRoutes) {
                        var transportMeans = allRoutes[i].legs;
                        for (var j in transportMeans) {
                            var details = transportMeans[j];
                            var mode = details.mode;

                            encodedRoute = details.legGeometry.points
                            var routeGeo = decodeGeo(encodedRoute);
                            modes = {endpoints: routeGeo._latlngs, mode: mode};

                            if (mode == "SUBWAY") {
                                var subwayLine = details.route;
                                L.polyline(modes.endpoints, routeTextures.SUBWAY[subwayLine]).addTo(map);
                            }
                            else {
                                L.polyline(modes.endpoints, routeTextures[modes.mode]).addTo(map);
                            }
                        }

                        // Remove for the next time, only take 1st route
                        break
                    }
                }
                else {
                    encodedRoute = result.route_geometry;
                    var routeGeo = decodeGeo(encodedRoute);
                    modes = {endpoints: routeGeo._latlngs, mode: routeType.toUpperCase()};

                    L.polyline(modes.endpoints, routeTextures[modes.mode]).addTo(map);
                }
            }
        });
    }

    window.addEventListener('load', function () {
        /*document.addEventListener('click', function (event) {
            const allTabs = document.getElementsById;
            const endInp = document.getElementById("end");
            const startInp = document.getElementById("start");

            if (![].slice.call(allTabs).find(x => x === event.target) && event.target != endInp && event.target != startInp) {
                if (!dropdownCooldown) {
                    for (var i in allTabs) {
                        allTabs.item(i).style.display = "none";
                    }
                }
            }
        });*/

        initFunctions();
    });

</script>
{% endblock %}
